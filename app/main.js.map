{"version":3,"file":null,"sources":["C:/Users/Candlelight/app-public/source/main.js"],"sourcesContent":["const electron = require('electron');\r\nconst { Menu, ipcMain, dialog } = require('electron');\r\n// Module to control application life.\r\nconst app = electron.app;\r\n// Module to create native browser window.\r\nconst BrowserWindow = electron.BrowserWindow;\r\n\r\nconst path = require('path');\r\nconst url = require('url');\r\nconst fs = require('fs');\r\nconst request = require('request-promise-native');\r\nconst fix = require('fix-path');\r\nconst fetch = require('node-fetch');\r\nconst WebSocket = require('ws');\r\nconst environment = require('./environment.json');\r\n\r\nfix();\r\n\r\nlet currentInstrument;\r\n\r\nconst configPath = path.join(\r\n  __dirname.replace('app.asar', 'app.asar.unpacked'),\r\n  '/config.json'\r\n);\r\nlet config = JSON.parse(fs.readFileSync(configPath));\r\n\r\nlet windows = {};\r\n\r\nipcMain.on('addInstrument', addInstrument);\r\nipcMain.on('editInstrument', editInstrument);\r\nipcMain.on('removeInstrument', removeInstrument);\r\nipcMain.on('loadInstrument', loadInstrument);\r\n\r\nipcMain.on('editInfluxDB', editInfluxDB);\r\nipcMain.on('updateInfluxDB', updateInfluxDB);\r\nipcMain.on('downloadData', downloadData);\r\nipcMain.on('htmlReport', htmlReport);\r\n\r\nipcMain.on('configChannel', configChannel);\r\nipcMain.on('configChannels', configChannels);\r\nipcMain.on('mppt', openMPPT);\r\nipcMain.on('bugReport', openBugReport);\r\nipcMain.on('calibratePD', openCalibratePD);\r\nipcMain.on('calibratePyranometer', openCalibratePyranometer);\r\nipcMain.on('scheduleLight', openScheduleLight);\r\n\r\nipcMain.on('reportError', reportError);\r\n\r\nfunction makeInstrumentMenu() {\r\n  return {\r\n    label: 'Instrument',\r\n    submenu: [\r\n      {\r\n        label: 'Add a new instrument',\r\n        click() {\r\n          addInstrument();\r\n        }\r\n      },\r\n      {\r\n        label: 'Edit instrument',\r\n        click() {\r\n          editInstrument(currentInstrument);\r\n        }\r\n      },\r\n      {\r\n        label: 'Edit database config',\r\n        click() {\r\n          editInfluxDB();\r\n        }\r\n      },\r\n      {\r\n        label: 'Show all measurements',\r\n        click() {\r\n          showAllMeasurements(currentInstrument);\r\n        }\r\n      },\r\n      { type: 'separator' },\r\n      { label: 'Cut', accelerator: 'CmdOrCtrl+X', selector: 'cut:' },\r\n      { label: 'Copy', accelerator: 'CmdOrCtrl+C', selector: 'copy:' },\r\n      { label: 'Paste', accelerator: 'CmdOrCtrl+V', selector: 'paste:' },\r\n\r\n      ...config.instruments.map(instrument => {\r\n        return {\r\n          label: instrument.trackerName,\r\n          checked: currentInstrument == instrument.trackerHost,\r\n          click(event) {\r\n            loadInstrument(event, instrument.trackerHost);\r\n          }\r\n        };\r\n      })\r\n    ]\r\n  };\r\n}\r\n\r\nfunction openSocket(instrumentConfig) {\r\n  const ws = new WebSocket(\r\n    'ws://' +\r\n      instrumentConfig.trackerHost +\r\n      ':' +\r\n      instrumentConfig.trackerPortWS\r\n  );\r\n\r\n  ws.on('open', function open() {\r\n    console.log('Socket is open');\r\n  });\r\n\r\n  ws.on('close', function open() {\r\n    console.log('Socket is closed');\r\n    setTimeout(() => openSocket(instrumentConfig), 1000);\r\n  });\r\n\r\n  ws.on('error', function error(err) {\r\n    console.log('Socket is in error state: ' + error.code);\r\n  });\r\n\r\n  ws.removeAllListeners('message');\r\n  ws.on('message', wsIncoming);\r\n\r\n  ws.isAlive = true;\r\n  ws.on('pong', () => (ws.isAlive = true));\r\n\r\n  var socketTimeout = () => {\r\n    let interval = setInterval(() => {\r\n      if (!ws.isAlive) {\r\n        ws.terminate();\r\n      }\r\n\r\n      if (ws.readyState == WebSocket.CLOSED) {\r\n        clearInterval(interval);\r\n      }\r\n\r\n      ws.isAlive = false;\r\n      ws.ping(() => {});\r\n    }, 30000);\r\n  };\r\n\r\n  socketTimeout();\r\n}\r\n\r\nfunction wsIncoming(data) {\r\n  data = JSON.parse(data);\r\n\r\n  if (!data.instrumentId && windows['instrumentMain']) {\r\n    windows['instrumentMain'].webContents.send(`instrument.log`, data.log);\r\n  }\r\n\r\n  if (data.instrumentId && windows['instrumentMain']) {\r\n    if (data.chanId) {\r\n      windows['instrumentMain'].webContents.send(\r\n        `channel.update.${data.instrumentId}.${data.chanId}`,\r\n        data\r\n      );\r\n    }\r\n\r\n    if (data.groupName) {\r\n      windows['instrumentMain'].webContents.send(\r\n        `group.update.${data.instrumentId}.${data.groupName}`,\r\n        data\r\n      );\r\n    }\r\n\r\n    if (data.log) {\r\n      data.log.time = Date.now();\r\n      windows['instrumentMain'].webContents.send(\r\n        `instrument.log.${data.instrumentId}`,\r\n        data.log\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction doMenu() {\r\n  //require(\"./menu\");\r\n  const template = [];\r\n\r\n  if (environment.ageing) {\r\n    template.push(makeInstrumentMenu());\r\n  }\r\n\r\n  //if (process.platform === 'darwin') {\r\n  template.unshift({\r\n    label: app.getName(),\r\n    submenu: [\r\n      { role: 'about' },\r\n      { type: 'separator' },\r\n      { role: 'services', submenu: [] },\r\n      { type: 'separator' },\r\n      { role: 'hide' },\r\n      { role: 'hideothers' },\r\n      { role: 'unhide' },\r\n      { type: 'separator' },\r\n      { role: 'quit' }\r\n    ]\r\n  });\r\n\r\n  if (process.env.NODE_ENV == 'development') {\r\n    template[0].submenu.push({ role: 'toggledevtools' });\r\n  }\r\n  //}\r\n\r\n  const menu = Menu.buildFromTemplate(template);\r\n  Menu.setApplicationMenu(menu);\r\n}\r\n\r\nfunction saveConfig() {\r\n  return new Promise((resolver, rejecter) => {\r\n    fs.writeFile(configPath, JSON.stringify(config, undefined, '\\t'), error => {\r\n      if (error) {\r\n        reportError(error);\r\n        rejecter(error);\r\n      } else {\r\n        config = JSON.parse(fs.readFileSync(configPath));\r\n        resolver();\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n// Keep a global reference of the window object, if you don't, the window will\r\n// be closed automatically when the JavaScript object is garbage collected.\r\n\r\nfunction createMainWindow() {\r\n  // Create the browser window.\r\n  windows['instrumentList'] = new BrowserWindow({\r\n    width: 800,\r\n    height: 700,\r\n    resizable: false\r\n  });\r\n\r\n  windows['instrumentList'].webContents.once('dom-ready', () => {\r\n    windows['instrumentList'].webContents.send(\r\n      'dbInformation',\r\n      config.database\r\n    );\r\n  });\r\n\r\n  // and load the index.html of the app.\r\n  windows['instrumentList'].loadURL(\r\n    url.format({\r\n      pathname: path.join(__dirname, 'app/instrumentlist.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    })\r\n  );\r\n\r\n  // Open the DevTools.\r\n  // windows[ 'instrumentList' ].webContents.openDevTools()\r\n\r\n  // Emitted when the window is closed.\r\n  windows['instrumentList'].on('closed', function() {\r\n    // Dereference the window object, usually you would store windows\r\n    // in an array if your app supports multi windows, this is the time\r\n    // when you should delete the corresponding element.\r\n    windows['instrumentList'] = null;\r\n  });\r\n\r\n  doMenu();\r\n}\r\n\r\n// This method will be called when Electron has finished\r\n// initialization and is ready to create browser windows.\r\n// Some APIs can only be used after this event occurs.\r\napp.on('ready', createMainWindow);\r\n\r\n// Quit when all windows are closed.\r\napp.on('window-all-closed', function() {\r\n  // On OS X it is common for applications and their menu bar\r\n  // to stay active until the user quits explicitly with Cmd + Q\r\n  if (process.platform !== 'darwin') {\r\n    app.quit();\r\n  }\r\n});\r\n\r\napp.on('activate', function() {\r\n  // On OS X it's common to re-create a window in the app when the\r\n  // dock icon is clicked and there are no other windows open.\r\n  if (windows['instrumentList'] === null) {\r\n    createMainWindow();\r\n  }\r\n});\r\n\r\nasync function downloadData(\r\n  event,\r\n  tracker,\r\n  measurementName,\r\n  chanId,\r\n  instrumentId\r\n) {\r\n  let json = await fetch(\r\n    `http://${tracker.trackerHost}:${\r\n      tracker.trackerPort\r\n    }/getMeasurement?measurementName=${measurementName}`,\r\n    {\r\n      method: 'GET'\r\n    }\r\n  )\r\n    .then(response => response.json())\r\n    .catch(() => {\r\n      throw new Error(\r\n        `Error while connecting to the instrument. Check that you are online and that the instrument is available on your network.`\r\n      );\r\n    });\r\n\r\n  openForm(\r\n    null,\r\n    'downloadform',\r\n    {\r\n      measurementName: measurementName,\r\n      db: config.database,\r\n      cellInfo: json.cellInfo,\r\n      chanId: chanId,\r\n      instrumentId: instrumentId\r\n    },\r\n    {\r\n      width: 850,\r\n      height: 800,\r\n      resizable: false\r\n    }\r\n  )\r\n    .then(async result => {\r\n      config.instruments.push(result);\r\n      await saveConfig();\r\n      reloadInstruments();\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction htmlReport(event, cellInfo, chanId, measurementName, instrumentId) {\r\n  let listenerConfig, listenerSavePDF /*, listenerPrintPDF*/;\r\n\r\n  ipcMain.on(\r\n    'htmlReport.config',\r\n    (listenerConfig = (event, data) => {\r\n      if (!windows['htmlReport']) {\r\n        return;\r\n      }\r\n\r\n      windows['htmlReport'].webContents.send('config', data);\r\n    })\r\n  );\r\n\r\n  ipcMain.on(\r\n    'htmlReport.savePDF',\r\n    (listenerSavePDF = (event, data) => {\r\n      if (!windows['htmlReport']) {\r\n        return;\r\n      }\r\n\r\n      dialog.showSaveDialog(\r\n        {\r\n          message: 'Save the report for device ' + data.cellName,\r\n          defaultPath: '~/' + data.cellName + '.pdf'\r\n        },\r\n        fileName => {\r\n          if (!fileName) {\r\n            return;\r\n          }\r\n\r\n          windows['htmlReport'].webContents.printToPDF(\r\n            {\r\n              marginsType: 1,\r\n              pageSize: 'A4',\r\n              landscape: true\r\n            },\r\n            (err, data) => {\r\n              fs.writeFile(fileName, data, error => {\r\n                console.log(err);\r\n              });\r\n            }\r\n          );\r\n        }\r\n      );\r\n\r\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\r\n    })\r\n  );\r\n\r\n  /*\r\n\r\n    ipcMain.on(\"htmlReport.printPDF\", ( listenerPrintPDF = ( event, data ) => {\r\n\r\n      if( ! windows[ 'htmlReport' ] ) {\r\n        return;\r\n      }\r\n\r\n        windows[ 'htmlReport' ].webContents.print( {\r\n          marginsType: 1,\r\n          pageSize: 'A4',\r\n          landscape: true\r\n        }, ( err, data ) => {\r\n\r\n          fs.writeFile( fileName, data, ( error ) => {\r\n            console.log( err );\r\n          } );\r\n        } );\r\n\r\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\r\n    } ) );\r\n*/\r\n  openForm(\r\n    null,\r\n    'htmlreport_control',\r\n    {\r\n      measurementName: measurementName,\r\n      db: config.database,\r\n      cellInfo: cellInfo,\r\n      chanId: chanId\r\n    },\r\n    {\r\n      width: 400,\r\n      height: 595,\r\n      x: 50,\r\n      y: 100,\r\n      center: false,\r\n      resizable: false\r\n    },\r\n    () => {\r\n      ipcMain.removeListener('htmlReport.config', listenerConfig);\r\n      ipcMain.removeListener('htmlReport.savePDF', listenerSavePDF);\r\n      //     ipcMain.removeListener( \"htmlReport.printPDF\", listenerPrintPDF );\r\n    }\r\n  );\r\n\r\n  windows['htmlReport'] = new BrowserWindow({\r\n    width: 1122,\r\n    height: 795,\r\n    x: 500,\r\n    y: 100,\r\n    center: false,\r\n    resizable: false\r\n  });\r\n\r\n  windows['htmlReport'].webContents.once('dom-ready', () => {\r\n    windows['htmlReport'].webContents.send('loadData', {\r\n      measurementName: measurementName,\r\n      db: config.database,\r\n      cellInfo: cellInfo,\r\n      chanId: chanId,\r\n      instrumentId: instrumentId\r\n    });\r\n  });\r\n  // and load the index.html of the app.\r\n  windows['htmlReport'].loadURL(\r\n    url.format({\r\n      pathname: path.join(__dirname, 'app/htmlreport.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    })\r\n  );\r\n}\r\n\r\nfunction openBugReport(event) {\r\n  openForm(\r\n    null,\r\n    'bugreport',\r\n    {},\r\n    {\r\n      width: 540,\r\n      height: 600,\r\n      resizable: false\r\n    }\r\n  );\r\n}\r\n\r\nfunction openMPPT(keithleyModel) {\r\n  windows['mppt'] = new BrowserWindow({\r\n    width: 1400,\r\n    height: 1024,\r\n    center: true,\r\n    resizable: false\r\n  });\r\n  // and load the index.html of the app.\r\n  windows['mppt'].loadURL(\r\n    url.format({\r\n      pathname: path.join(__dirname, 'app/mppt.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    })\r\n  );\r\n}\r\n\r\nasync function openCalibratePD(event, data) {\r\n  openForm(\r\n    null,\r\n    'calibratepd',\r\n    {\r\n      instrumentId: data.instrumentId,\r\n      groupName: data.groupName,\r\n      config: data.config\r\n    },\r\n    {\r\n      width: 800,\r\n      height: 600,\r\n      resizable: false\r\n    },\r\n    async () => {\r\n      var channelConfig = await fetch(\r\n        'http://' +\r\n          data.config.trackerHost +\r\n          ':' +\r\n          data.config.trackerPort +\r\n          '/resetAllChannels?instrumentId=' +\r\n          data.instrumentId +\r\n          '&groupName=' +\r\n          data.groupName,\r\n        { method: 'GET' }\r\n      ).then(response => response.json());\r\n    }\r\n  );\r\n}\r\n\r\nasync function openCalibratePyranometer(event, data) {\r\n  openForm(\r\n    null,\r\n    'calibratepyranometer',\r\n    {\r\n      instrumentId: data.instrumentId,\r\n      groupName: data.groupName,\r\n      config: data.config\r\n    },\r\n    {\r\n      width: 800,\r\n      height: 600,\r\n      resizable: false\r\n    },\r\n    async () => {\r\n      //var channelConfig = await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/resetAllChannels?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\r\n    }\r\n  );\r\n}\r\n\r\nasync function openScheduleLight(event, data) {\r\n  //await fetch( \"http://\" + data.config.trackerHost + \":\" +   data.config.trackerPort + \"/light.pause?instrumentId=\" + data.instrumentId, { method: 'GET' } );\r\n\r\n  // Once the light has been updated, send the information to the main window for update\r\n  let listener;\r\n  ipcMain.on(\r\n    'light.updated',\r\n    (listener = () => {\r\n      windows['instrumentMain'].webContents.send('light.updated');\r\n    })\r\n  );\r\n\r\n  openForm(\r\n    null,\r\n    'scheduleLight',\r\n    {\r\n      instrumentId: data.instrumentId,\r\n      groupName: data.groupName,\r\n      config: data.config\r\n    },\r\n    {\r\n      width: 800,\r\n      height: 600,\r\n      resizable: false\r\n    },\r\n    function() {\r\n      // After the window is closed, remove the listener\r\n      ipcMain.removeListener('light.updated', listener);\r\n      //  await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/light.resume?instrumentId=\" + data.instrumentId, { method: 'GET' } );\r\n    }\r\n  );\r\n}\r\n\r\n// In this file you can include the rest of your app's specific main process\r\n// code. You can also put them in separate files and require them here.\r\n\r\nfunction removeInstrument(event, trackerHost) {\r\n  dialog.showMessageBox(\r\n    {\r\n      type: 'question',\r\n      message: 'Are you sure that you want to remove this instrument ?',\r\n      cancelId: 0,\r\n      defaultId: 0,\r\n      title: 'Remove the instrument',\r\n      buttons: ['Cancel', 'Yes']\r\n    },\r\n    async index => {\r\n      if (index == 1) {\r\n        config.instruments.forEach((instrument, index) => {\r\n          if (instrument.trackerHost == trackerHost) {\r\n            config.instruments.splice(index, 1);\r\n          }\r\n        });\r\n\r\n        await saveConfig();\r\n        reloadInstruments();\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\nfunction reportError(e) {\r\n  console.log('Error reporting !');\r\n  dialog.showMessageBox(\r\n    {\r\n      type: 'error',\r\n      message: 'An error has happened: ' + e.toString(),\r\n      cancelId: 0,\r\n      defaultId: 0,\r\n      title: 'Error',\r\n      buttons: ['Ok']\r\n    },\r\n    index => {}\r\n  );\r\n}\r\n\r\nfunction reloadInstruments() {\r\n  windows['instrumentList'].webContents.send('reloadInstruments');\r\n  doMenu();\r\n}\r\n\r\nfunction addInstrument() {\r\n  openForm(\r\n    null,\r\n    'instrumentform',\r\n    {},\r\n    {\r\n      width: 850,\r\n      height: 800,\r\n      resizable: false\r\n    }\r\n  )\r\n    .then(async result => {\r\n      try {\r\n        config.instruments.push(result);\r\n        await saveConfig();\r\n        reloadInstruments();\r\n      } catch (e) {\r\n        reportError(e);\r\n      }\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction loadInstrument(event, tracker) {\r\n  const trackerHost = tracker.host;\r\n  const mode = tracker.mode;\r\n\r\n  if (!windows['instrumentMain']) {\r\n    // Create the browser window.\r\n    windows['instrumentMain'] = new BrowserWindow({\r\n      width: 1400,\r\n      height: 1024,\r\n      center: true,\r\n      resizable: true\r\n    });\r\n  }\r\n\r\n  switch (mode) {\r\n    case 'ageing':\r\n      windows['instrumentMain'].loadURL(\r\n        url.format({\r\n          pathname: path.join(__dirname, 'app/instrument.html'),\r\n          protocol: 'file:',\r\n          slashes: true\r\n        })\r\n      );\r\n      break;\r\n\r\n    case 'measurement':\r\n      windows['instrumentMain'].loadURL(\r\n        url.format({\r\n          pathname: path.join(__dirname, 'app/ivmeasurements/index.html'),\r\n          protocol: 'file:',\r\n          slashes: true\r\n        })\r\n      );\r\n\r\n      break;\r\n  }\r\n\r\n  if (windows['instrumentList']) {\r\n    windows['instrumentList'].close();\r\n  }\r\n\r\n  let instrumentConfig;\r\n\r\n  config.instruments.forEach((instrument, index) => {\r\n    if (instrument.trackerHost == trackerHost) {\r\n      instrumentConfig = instrument;\r\n      currentInstrument = instrument;\r\n    }\r\n  });\r\n\r\n  // Global\r\n\r\n  if (windows['instrumentMain'].webContents.isLoading()) {\r\n    windows['instrumentMain'].webContents.once('dom-ready', () => {\r\n      windows['instrumentMain'].webContents.send('loadInstrument', {\r\n        tracker: instrumentConfig,\r\n        db: config.database\r\n      });\r\n    });\r\n  } else {\r\n    windows['instrumentMain'].webContents.send('loadInstrument', {\r\n      tracker: instrumentConfig,\r\n      db: config.database\r\n    });\r\n  }\r\n\r\n  windows['instrumentMain'].once('close', () => {\r\n    windows['instrumentMain'] = null;\r\n  });\r\n\r\n  doMenu();\r\n\r\n  openSocket(instrumentConfig);\r\n}\r\n\r\nfunction editInstrument(event, trackerHost) {\r\n  let data;\r\n\r\n  config.instruments.forEach((instrument, index) => {\r\n    if (instrument.trackerHost == trackerHost) {\r\n      data = instrument;\r\n    }\r\n  });\r\n\r\n  if (!data) {\r\n    throw 'Could not find the data corresponding to this instrument';\r\n  }\r\n\r\n  openForm(null, 'instrumentform', data, {\r\n    width: 600,\r\n    height: 800,\r\n    resizable: false\r\n  })\r\n    .then(async results => {\r\n      Object.assign(data, results);\r\n      await saveConfig();\r\n\r\n      if (windows['instrumentMain']) {\r\n        windows['instrumentMain'].webContents.send('loadInstrument', {\r\n          tracker: data,\r\n          db: config.database\r\n        });\r\n      }\r\n\r\n      if (windows['instrumentList']) {\r\n        windows['instrumentList'].webContents.send('instrumentUpdated');\r\n      }\r\n\r\n      reloadInstruments();\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction editInfluxDB(event) {\r\n  let data;\r\n  let influxConfig = config.database;\r\n\r\n  openForm(null, 'influxdbform', influxConfig, {\r\n    width: 600,\r\n    height: 700,\r\n    resizable: false\r\n  })\r\n    .then(async results => {\r\n      config.database = results;\r\n      saveConfig();\r\n\r\n      windows['form'].webContents.send('uploading', {\r\n        status: 'progress',\r\n        host: config.instruments.map(i => i.trackerHost).join(', ')\r\n      });\r\n\r\n      updateInfluxDB()\r\n        .then(() => {\r\n          windows['form'].webContents.send('uploading', { status: 'done' });\r\n        })\r\n        .catch(err => {\r\n          windows['form'].webContents.send('uploading', {\r\n            status: 'error',\r\n            error: err,\r\n            host: err.options.host\r\n          });\r\n        });\r\n\r\n      if (windows['instrumentMain']) {\r\n        windows['instrumentMain'].webContents.send('reloadDB', {\r\n          db: config.database\r\n        });\r\n\r\n        if (windows['instrumentList']) {\r\n          windows['instrumentList'].webContents.send(\r\n            'dbInformation',\r\n            config.database\r\n          );\r\n        }\r\n      }\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction showAllMeasurements(instrument) {\r\n  console.log(instrument);\r\n  openForm(\r\n    null,\r\n    'showallmeasurements',\r\n    { config: instrument, configDB: config.database },\r\n    { width: 600, height: 700, resizable: false }\r\n  )\r\n    .then(results => {})\r\n    .catch(() => {});\r\n}\r\n\r\nfunction updateInfluxDB() {\r\n  return Promise.all(\r\n    config.instruments.map(instrument => {\r\n      return request.post({\r\n        url:\r\n          'http://' +\r\n          instrument.trackerHost +\r\n          ':' +\r\n          instrument.trackerPort +\r\n          '/setInfluxDB',\r\n        host: instrument.trackerHost,\r\n        form: config.database,\r\n        timeout: 1000\r\n      });\r\n    })\r\n  );\r\n}\r\n\r\nasync function configChannel(event, data) {\r\n  let influxConfig = config.database;\r\n\r\n  var channelConfig = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getChannelConfig?instrumentId=' +\r\n      data.instrumentId +\r\n      '&chanId=' +\r\n      data.chanId,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n\r\n  var instrumentConfig = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getInstrumentConfig?instrumentId=' +\r\n      data.instrumentId,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n\r\n  var channelState = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getStatus?instrumentId=' +\r\n      data.instrumentId +\r\n      '&chanId=' +\r\n      data.chanId,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n\r\n  //var externalConnection = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getChannelConfig?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var externalConnection = false;\r\n\r\n  instrumentConfig.instrumentId = data.instrumentId;\r\n\r\n  return openForm(\r\n    null,\r\n    'cellform',\r\n    {\r\n      instrumentConfig: instrumentConfig,\r\n      groupName: data.groupName,\r\n      channelConfig: channelConfig,\r\n      channelState: channelState[data.groupName].channels[data.chanId]\r\n    },\r\n    { width: 600, height: 800 }\r\n  )\r\n    .then(results => {\r\n      event.sender.send('channelConfigured', results);\r\n      return results;\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nasync function configChannels(event, data) {\r\n  let influxConfig = config.database;\r\n\r\n  var channelsState = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getStatus?instrumentId=' +\r\n      data.instrumentId +\r\n      '&groupName=' +\r\n      data.groupName,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n  var instrumentConfig = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getInstrumentConfig?instrumentId=' +\r\n      data.instrumentId,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n  var channelState = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getStatus?instrumentId=' +\r\n      data.instrumentId +\r\n      '&chanId=' +\r\n      data.chanIds[0],\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n\r\n  instrumentConfig.instrumentId = data.instrumentId;\r\n\r\n  return openForm(\r\n    null,\r\n    'cellformall',\r\n    {\r\n      channelState: channelState[data.groupName].channels[data.chanIds[0]],\r\n      channelsState: channelsState[data.groupName].channels,\r\n      groupName: data.groupName,\r\n      instrumentConfig: instrumentConfig,\r\n      channelIds: data.chanIds\r\n    },\r\n    { width: 600, height: 800 }\r\n  )\r\n    .then(results => {\r\n      event.sender.send('channelsConfigured', results);\r\n      return results;\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nlet windowForm;\r\n\r\nfunction openForm(\r\n  windowName,\r\n  pageName,\r\n  formData,\r\n  options = { width: 300, height: 420 },\r\n  onClose\r\n) {\r\n  if (windowForm) {\r\n    windowForm._rejecter && windowForm._rejecter();\r\n    windowForm.close();\r\n  }\r\n  // Create the browser window.\r\n  windowForm = new BrowserWindow(options);\r\n\r\n  // and load the index.html of the app.\r\n  windowForm.loadURL(\r\n    url.format({\r\n      pathname: path.join(__dirname, 'app/' + pageName + '.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    })\r\n  );\r\n\r\n  windows['form'] = windowForm;\r\n\r\n  windowForm.once('closed', () => {\r\n    windows['form'] = null;\r\n    windowForm && windowForm._rejecter && windowForm._rejecter();\r\n    windowForm = null;\r\n\r\n    if (typeof onClose == 'function') {\r\n      onClose();\r\n    }\r\n  });\r\n  return new Promise((resolver, rejecter) => {\r\n    ipcMain.once('validateForm', (event, data) => {\r\n      resolver(data);\r\n    });\r\n\r\n    ipcMain.once('closeForm', (event, data) => {\r\n      if (windowForm) {\r\n        windowForm.close();\r\n        windowForm = null;\r\n      }\r\n    });\r\n\r\n    windowForm.webContents.once('dom-ready', () => {\r\n      windowForm.webContents.send('loadForm', formData);\r\n    });\r\n\r\n    windowForm._rejecter = rejecter;\r\n  });\r\n}\r\n"],"names":["require","Menu","ipcMain","dialog","app","electron","BrowserWindow","path","url","fs","request","fix","fetch","WebSocket","environment","join","__dirname","replace","JSON","parse","readFileSync","configPath","windows","on","addInstrument","editInstrument","removeInstrument","loadInstrument","editInfluxDB","updateInfluxDB","downloadData","htmlReport","configChannel","configChannels","openMPPT","openBugReport","openCalibratePD","openCalibratePyranometer","openScheduleLight","reportError","label","submenu","click","currentInstrument","showAllMeasurements","type","accelerator","selector","config","instruments","map","instrument","trackerName","checked","trackerHost","event","instrumentConfig","trackerPortWS","ws","console","log","setTimeout","openSocket","error","code","removeAllListeners","wsIncoming","isAlive","setInterval","terminate","readyState","CLOSED","clearInterval","interval","ping","data","instrumentId","webContents","send","chanId","groupName","time","Date","now","ageing","template","push","makeInstrumentMenu","unshift","getName","role","buildFromTemplate","setApplicationMenu","menu","resolver","rejecter","writeFile","stringify","width","height","resizable","once","database","loadURL","format","pathname","protocol","slashes","doMenu","createMainWindow","platform","quit","tracker","measurementName","trackerPort","method","then","response","json","catch","openForm","db","cellInfo","result","reloadInstruments","listenerSavePDF","listenerConfig","showSaveDialog","message","cellName","defaultPath","fileName","printToPDF","marginsType","pageSize","landscape","err","x","y","center","removeListener","listener","showMessageBox","cancelId","defaultId","title","buttons","forEach","index","splice","e","toString","host","mode","close","isLoading","Object","assign","results","influxConfig","saveConfig","status","i","options","configDB","all","post","form","timeout","channelState","channelConfig","channels","sender","chanIds","channelsState","channelIds","windowName","pageName","formData","onClose","windowForm","_rejecter"],"mappings":"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"}