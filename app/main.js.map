{"version":3,"file":null,"sources":["D:/Documents/Candlelight/code/app_public2/source/main.js"],"sourcesContent":["const electron = require('electron');\r\nconst { Menu, ipcMain, dialog } = require('electron');\r\n// Module to control application life.\r\nconst app = electron.app;\r\n// Module to create native browser window.\r\nconst BrowserWindow = electron.BrowserWindow;\r\n\r\nconst path = require('path');\r\nconst url = require('url');\r\nconst fs = require('fs');\r\nconst request = require('request-promise-native');\r\nconst fix = require('fix-path');\r\nconst fetch = require('node-fetch');\r\nconst WebSocket = require('ws');\r\nconst environment = require('./environment.json');\r\nconst diagnostics = require('./app/scripts/diagnostics');\r\nconst { openForm, sendToForm } = require('./app/util/windows');\r\nfix();\r\n\r\nlet currentInstrument;\r\nconst { reportError } = require('./app/scripts/errorhandling');\r\n\r\nconst {\r\n  config,\r\n  saveConfig,\r\n  getPreference,\r\n  setPreference\r\n} = require('./app/scripts/config');\r\n\r\nlet windows = {};\r\n\r\nipcMain.on('addInstrument', addInstrument);\r\nipcMain.on('editInstrument', editInstrument);\r\nipcMain.on('removeInstrument', removeInstrument);\r\nipcMain.on('loadInstrument', loadInstrument);\r\n\r\nipcMain.on('editInfluxDB', editInfluxDB);\r\nipcMain.on('updateInfluxDB', updateInfluxDB);\r\nipcMain.on('downloadData', downloadData);\r\nipcMain.on('htmlReport', htmlReport);\r\n\r\nipcMain.on('configChannel', configChannel);\r\nipcMain.on('configChannels', configChannels);\r\nipcMain.on('mppt', openMPPT);\r\nipcMain.on('bugReport', openBugReport);\r\nipcMain.on('calibratePD', openCalibratePD);\r\nipcMain.on('calibratePyranometer', openCalibratePyranometer);\r\nipcMain.on('scheduleLight', openScheduleLight);\r\n\r\nipcMain.on('reportError', reportError);\r\n\r\nipcMain.on('get-config', (event, arg) => {\r\n  event.sender.send('get-config', config);\r\n});\r\n\r\nipcMain.on('set-preference', (event, arg) => {\r\n  setPreference(arg.name, arg.value);\r\n});\r\n\r\nipcMain.on('save-config', () => {\r\n  saveConfig();\r\n});\r\n\r\nfunction makeInstrumentMenu() {\r\n  return {\r\n    label: 'Instrument',\r\n    submenu: [\r\n      {\r\n        label: 'Diagnostics',\r\n        click() {\r\n          diagnostics.openDiagnostics(currentInstrument);\r\n        }\r\n      },\r\n      {\r\n        label: 'Add a new instrument',\r\n        click() {\r\n          addInstrument();\r\n        }\r\n      },\r\n      {\r\n        label: 'Edit instrument',\r\n        click() {\r\n          editInstrument(currentInstrument);\r\n        }\r\n      },\r\n      {\r\n        label: 'Edit database config',\r\n        click() {\r\n          editInfluxDB();\r\n        }\r\n      },\r\n      {\r\n        label: 'Show all measurements',\r\n        click() {\r\n          showAllMeasurements(currentInstrument);\r\n        }\r\n      },\r\n      { type: 'separator' },\r\n      { label: 'Cut', accelerator: 'CmdOrCtrl+X', selector: 'cut:' },\r\n      { label: 'Copy', accelerator: 'CmdOrCtrl+C', selector: 'copy:' },\r\n      { label: 'Paste', accelerator: 'CmdOrCtrl+V', selector: 'paste:' },\r\n\r\n      ...config.instruments.map(instrument => {\r\n        return {\r\n          label: instrument.trackerName,\r\n          checked: currentInstrument == instrument.trackerHost,\r\n          click(event) {\r\n            loadInstrument(event, instrument.trackerHost);\r\n          }\r\n        };\r\n      })\r\n    ]\r\n  };\r\n}\r\n\r\nfunction openSocket(instrumentConfig) {\r\n  const ws = new WebSocket(\r\n    'ws://' +\r\n      instrumentConfig.trackerHost +\r\n      ':' +\r\n      instrumentConfig.trackerPortWS\r\n  );\r\n\r\n  ws.on('open', function open() {\r\n    console.log('Socket is open');\r\n  });\r\n\r\n  ws.on('close', function open() {\r\n    console.log('Socket is closed');\r\n    setTimeout(() => openSocket(instrumentConfig), 1000);\r\n  });\r\n\r\n  ws.on('error', function error(err) {\r\n    console.log('Socket is in error state: ' + error.code);\r\n  });\r\n\r\n  ws.removeAllListeners('message');\r\n  ws.on('message', wsIncoming);\r\n\r\n  ws.isAlive = true;\r\n  ws.on('pong', () => (ws.isAlive = true));\r\n\r\n  var socketTimeout = () => {\r\n    let interval = setInterval(() => {\r\n      if (!ws.isAlive) {\r\n        ws.terminate();\r\n      }\r\n\r\n      if (ws.readyState == WebSocket.CLOSED) {\r\n        clearInterval(interval);\r\n      }\r\n\r\n      ws.isAlive = false;\r\n      ws.ping(() => {});\r\n    }, 30000);\r\n  };\r\n\r\n  socketTimeout();\r\n}\r\n\r\nfunction wsIncoming(data) {\r\n  data = JSON.parse(data);\r\n\r\n  if (!data.instrumentId && windows['instrumentMain']) {\r\n    windows['instrumentMain'].webContents.send(`instrument.log`, data.log);\r\n  }\r\n\r\n  if (data.instrumentId && windows['instrumentMain']) {\r\n    if (data.chanId) {\r\n      windows['instrumentMain'].webContents.send(\r\n        `channel.update.${data.instrumentId}.${data.chanId}`,\r\n        data\r\n      );\r\n    }\r\n\r\n    if (data.groupName) {\r\n      windows['instrumentMain'].webContents.send(\r\n        `group.update.${data.instrumentId}.${data.groupName}`,\r\n        data\r\n      );\r\n    }\r\n\r\n    if (data.log) {\r\n      data.log.time = Date.now();\r\n      windows['instrumentMain'].webContents.send(\r\n        `instrument.log.${data.instrumentId}`,\r\n        data.log\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction doMenu() {\r\n  //require(\"./menu\");\r\n  const template = [];\r\n\r\n  if (environment.ageing) {\r\n    template.push(makeInstrumentMenu());\r\n  }\r\n\r\n  //if (process.platform === 'darwin') {\r\n  template.unshift({\r\n    label: app.getName(),\r\n    submenu: [\r\n      { role: 'about' },\r\n      { type: 'separator' },\r\n      { role: 'services', submenu: [] },\r\n      { type: 'separator' },\r\n      { role: 'hide' },\r\n      { role: 'hideothers' },\r\n      { role: 'unhide' },\r\n      { type: 'separator' },\r\n      { role: 'quit' }\r\n    ]\r\n  });\r\n\r\n  if (process.env.NODE_ENV == 'development') {\r\n    template[0].submenu.push({ role: 'toggledevtools' });\r\n  }\r\n  //}\r\n\r\n  const menu = Menu.buildFromTemplate(template);\r\n  Menu.setApplicationMenu(menu);\r\n}\r\n\r\n// Keep a global reference of the window object, if you don't, the window will\r\n// be closed automatically when the JavaScript object is garbage collected.\r\n\r\nfunction createMainWindow() {\r\n  // Create the browser window.\r\n  windows['instrumentList'] = new BrowserWindow({\r\n    width: 800,\r\n    height: 700,\r\n    resizable: false\r\n  });\r\n\r\n  windows['instrumentList'].webContents.once('dom-ready', () => {\r\n    windows['instrumentList'].webContents.send(\r\n      'dbInformation',\r\n      config.database\r\n    );\r\n  });\r\n\r\n  // and load the index.html of the app.\r\n  windows['instrumentList'].loadURL(\r\n    url.format({\r\n      pathname: path.join(__dirname, 'app/instrumentlist.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    })\r\n  );\r\n\r\n  // Open the DevTools.\r\n  // windows[ 'instrumentList' ].webContents.openDevTools()\r\n\r\n  // Emitted when the window is closed.\r\n  windows['instrumentList'].on('closed', function() {\r\n    // Dereference the window object, usually you would store windows\r\n    // in an array if your app supports multi windows, this is the time\r\n    // when you should delete the corresponding element.\r\n    windows['instrumentList'] = null;\r\n  });\r\n\r\n  doMenu();\r\n}\r\n\r\n// This method will be called when Electron has finished\r\n// initialization and is ready to create browser windows.\r\n// Some APIs can only be used after this event occurs.\r\napp.on('ready', createMainWindow);\r\n\r\n// Quit when all windows are closed.\r\napp.on('window-all-closed', function() {\r\n  // On OS X it is common for applications and their menu bar\r\n  // to stay active until the user quits explicitly with Cmd + Q\r\n  if (process.platform !== 'darwin') {\r\n    app.quit();\r\n  }\r\n});\r\n\r\napp.on('activate', function() {\r\n  // On OS X it's common to re-create a window in the app when the\r\n  // dock icon is clicked and there are no other windows open.\r\n  if (windows['instrumentList'] === null) {\r\n    createMainWindow();\r\n  }\r\n});\r\n\r\nasync function downloadData(\r\n  event,\r\n  tracker,\r\n  measurementName,\r\n  chanId,\r\n  instrumentId\r\n) {\r\n  let json = await fetch(\r\n    `http://${tracker.trackerHost}:${\r\n      tracker.trackerPort\r\n    }/getMeasurement?measurementName=${measurementName}`,\r\n    {\r\n      method: 'GET'\r\n    }\r\n  )\r\n    .then(response => response.json())\r\n    .catch(() => {\r\n      throw new Error(\r\n        `Error while connecting to the instrument. Check that you are online and that the instrument is available on your network.`\r\n      );\r\n    });\r\n\r\n  openForm(\r\n    null,\r\n    'downloadform',\r\n    {\r\n      measurementName: measurementName,\r\n      db: config.database,\r\n      cellInfo: json.cellInfo,\r\n      chanId: chanId,\r\n      instrumentId: instrumentId,\r\n      defaultPath: getPreference('defaultSavePath')\r\n    },\r\n    {\r\n      width: 850,\r\n      height: 800,\r\n      resizable: false\r\n    }\r\n  )\r\n    .then(async result => {\r\n      config.instruments.push(result);\r\n      await saveConfig();\r\n      reloadInstruments();\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction htmlReport(event, cellInfo, chanId, measurementName, instrumentId) {\r\n  let listenerConfig, listenerSavePDF /*, listenerPrintPDF*/;\r\n\r\n  ipcMain.on(\r\n    'htmlReport.config',\r\n    (listenerConfig = (event, data) => {\r\n      if (!windows['htmlReport']) {\r\n        return;\r\n      }\r\n\r\n      windows['htmlReport'].webContents.send('config', data);\r\n    })\r\n  );\r\n\r\n  ipcMain.on(\r\n    'htmlReport.savePDF',\r\n    (listenerSavePDF = (event, data) => {\r\n      if (!windows['htmlReport']) {\r\n        return;\r\n      }\r\n\r\n      dialog.showSaveDialog(\r\n        {\r\n          message: 'Save the report for device ' + data.cellName,\r\n          defaultPath:\r\n            (getPreference('defaultSavePathPDF') || '.') +\r\n            '/' +\r\n            data.cellName +\r\n            '.pdf'\r\n        },\r\n        fileName => {\r\n          if (!fileName) {\r\n            return;\r\n          }\r\n\r\n          const filePath = path.parse(fileName);\r\n          setPreference('defaultSavePathPDF', filePath.dir);\r\n\r\n          windows['htmlReport'].webContents.printToPDF(\r\n            {\r\n              marginsType: 1,\r\n              pageSize: 'A4',\r\n              landscape: true\r\n            },\r\n            (err, data) => {\r\n              fs.writeFile(fileName, data, error => {\r\n                console.log(err);\r\n              });\r\n            }\r\n          );\r\n        }\r\n      );\r\n\r\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\r\n    })\r\n  );\r\n\r\n  /*\r\n\r\n    ipcMain.on(\"htmlReport.printPDF\", ( listenerPrintPDF = ( event, data ) => {\r\n\r\n      if( ! windows[ 'htmlReport' ] ) {\r\n        return;\r\n      }\r\n\r\n        windows[ 'htmlReport' ].webContents.print( {\r\n          marginsType: 1,\r\n          pageSize: 'A4',\r\n          landscape: true\r\n        }, ( err, data ) => {\r\n\r\n          fs.writeFile( fileName, data, ( error ) => {\r\n            console.log( err );\r\n          } );\r\n        } );\r\n\r\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\r\n    } ) );\r\n*/\r\n  openForm(\r\n    null,\r\n    'htmlreport_control',\r\n    {\r\n      measurementName: measurementName,\r\n      db: config.database,\r\n      cellInfo: cellInfo,\r\n      chanId: chanId\r\n    },\r\n    {\r\n      width: 400,\r\n      height: 595,\r\n      x: 50,\r\n      y: 100,\r\n      center: false,\r\n      resizable: false\r\n    },\r\n    () => {\r\n      ipcMain.removeListener('htmlReport.config', listenerConfig);\r\n      ipcMain.removeListener('htmlReport.savePDF', listenerSavePDF);\r\n      //     ipcMain.removeListener( \"htmlReport.printPDF\", listenerPrintPDF );\r\n    }\r\n  );\r\n\r\n  windows['htmlReport'] = new BrowserWindow({\r\n    width: 1122,\r\n    height: 795,\r\n    x: 500,\r\n    y: 100,\r\n    center: false,\r\n    resizable: false\r\n  });\r\n\r\n  windows['htmlReport'].webContents.once('dom-ready', () => {\r\n    windows['htmlReport'].webContents.send('loadData', {\r\n      measurementName: measurementName,\r\n      db: config.database,\r\n      cellInfo: cellInfo,\r\n      chanId: chanId,\r\n      instrumentId: instrumentId\r\n    });\r\n  });\r\n  // and load the index.html of the app.\r\n  windows['htmlReport'].loadURL(\r\n    url.format({\r\n      pathname: path.join(__dirname, 'app/htmlreport.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    })\r\n  );\r\n}\r\n\r\nfunction openBugReport(event) {\r\n  openForm(\r\n    null,\r\n    'bugreport',\r\n    {},\r\n    {\r\n      width: 540,\r\n      height: 600,\r\n      resizable: false\r\n    }\r\n  );\r\n}\r\n\r\nfunction openMPPT(keithleyModel) {\r\n  windows['mppt'] = new BrowserWindow({\r\n    width: 1400,\r\n    height: 1024,\r\n    center: true,\r\n    resizable: false\r\n  });\r\n  // and load the index.html of the app.\r\n  windows['mppt'].loadURL(\r\n    url.format({\r\n      pathname: path.join(__dirname, 'app/mppt.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    })\r\n  );\r\n}\r\n\r\nasync function openCalibratePD(event, data) {\r\n  openForm(\r\n    null,\r\n    'calibratepd',\r\n    {\r\n      instrumentId: data.instrumentId,\r\n      groupName: data.groupName,\r\n      config: data.config\r\n    },\r\n    {\r\n      width: 800,\r\n      height: 600,\r\n      resizable: false\r\n    },\r\n    async () => {\r\n      var channelConfig = await fetch(\r\n        'http://' +\r\n          data.config.trackerHost +\r\n          ':' +\r\n          data.config.trackerPort +\r\n          '/resetAllChannels?instrumentId=' +\r\n          data.instrumentId +\r\n          '&groupName=' +\r\n          data.groupName,\r\n        { method: 'GET' }\r\n      ).then(response => response.json());\r\n    }\r\n  );\r\n}\r\n\r\nasync function openCalibratePyranometer(event, data) {\r\n  openForm(\r\n    null,\r\n    'calibratepyranometer',\r\n    {\r\n      instrumentId: data.instrumentId,\r\n      groupName: data.groupName,\r\n      config: data.config\r\n    },\r\n    {\r\n      width: 800,\r\n      height: 600,\r\n      resizable: false\r\n    },\r\n    async () => {\r\n      //var channelConfig = await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/resetAllChannels?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\r\n    }\r\n  );\r\n}\r\n\r\nasync function openScheduleLight(event, data) {\r\n  //await fetch( \"http://\" + data.config.trackerHost + \":\" +   data.config.trackerPort + \"/light.pause?instrumentId=\" + data.instrumentId, { method: 'GET' } );\r\n\r\n  // Once the light has been updated, send the information to the main window for update\r\n  let listener;\r\n  ipcMain.on(\r\n    'light.updated',\r\n    (listener = () => {\r\n      windows['instrumentMain'].webContents.send('light.updated');\r\n    })\r\n  );\r\n\r\n  openForm(\r\n    null,\r\n    'scheduleLight',\r\n    {\r\n      instrumentId: data.instrumentId,\r\n      groupName: data.groupName,\r\n      config: data.config\r\n    },\r\n    {\r\n      width: 800,\r\n      height: 600,\r\n      resizable: false\r\n    },\r\n    function() {\r\n      // After the window is closed, remove the listener\r\n      ipcMain.removeListener('light.updated', listener);\r\n      //  await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/light.resume?instrumentId=\" + data.instrumentId, { method: 'GET' } );\r\n    }\r\n  );\r\n}\r\n\r\n// In this file you can include the rest of your app's specific main process\r\n// code. You can also put them in separate files and require them here.\r\n\r\nfunction removeInstrument(event, trackerHost) {\r\n  dialog.showMessageBox(\r\n    {\r\n      type: 'question',\r\n      message: 'Are you sure that you want to remove this instrument ?',\r\n      cancelId: 0,\r\n      defaultId: 0,\r\n      title: 'Remove the instrument',\r\n      buttons: ['Cancel', 'Yes']\r\n    },\r\n    async index => {\r\n      if (index == 1) {\r\n        config.instruments.forEach((instrument, index) => {\r\n          if (instrument.trackerHost == trackerHost) {\r\n            config.instruments.splice(index, 1);\r\n          }\r\n        });\r\n\r\n        await saveConfig();\r\n        reloadInstruments();\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\nfunction reloadInstruments() {\r\n  windows['instrumentList'].webContents.send('reloadInstruments');\r\n  doMenu();\r\n}\r\n\r\nfunction addInstrument() {\r\n  openForm(\r\n    null,\r\n    'instrumentform',\r\n    {},\r\n    {\r\n      width: 850,\r\n      height: 800,\r\n      resizable: false\r\n    }\r\n  )\r\n    .then(async result => {\r\n      try {\r\n        config.instruments.push(result);\r\n        await saveConfig();\r\n        reloadInstruments();\r\n      } catch (e) {\r\n        reportError(e);\r\n      }\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction loadInstrument(event, tracker) {\r\n  const trackerHost = tracker.host;\r\n  const mode = tracker.mode;\r\n\r\n  if (!windows['instrumentMain']) {\r\n    // Create the browser window.\r\n    windows['instrumentMain'] = new BrowserWindow({\r\n      width: 1400,\r\n      height: 1024,\r\n      center: true,\r\n      resizable: true\r\n    });\r\n  }\r\n\r\n  switch (mode) {\r\n    case 'ageing':\r\n      windows['instrumentMain'].loadURL(\r\n        url.format({\r\n          pathname: path.join(__dirname, 'app/instrument.html'),\r\n          protocol: 'file:',\r\n          slashes: true\r\n        })\r\n      );\r\n      break;\r\n\r\n    case 'measurement':\r\n      windows['instrumentMain'].loadURL(\r\n        url.format({\r\n          pathname: path.join(__dirname, 'app/ivmeasurements/index.html'),\r\n          protocol: 'file:',\r\n          slashes: true\r\n        })\r\n      );\r\n\r\n      break;\r\n  }\r\n\r\n  if (windows['instrumentList']) {\r\n    windows['instrumentList'].close();\r\n  }\r\n\r\n  let instrumentConfig;\r\n\r\n  config.instruments.forEach((instrument, index) => {\r\n    if (instrument.trackerHost == trackerHost) {\r\n      instrumentConfig = instrument;\r\n      currentInstrument = instrument;\r\n    }\r\n  });\r\n\r\n  // Global\r\n\r\n  if (windows['instrumentMain'].webContents.isLoading()) {\r\n    windows['instrumentMain'].webContents.once('dom-ready', () => {\r\n      windows['instrumentMain'].webContents.send('loadInstrument', {\r\n        tracker: instrumentConfig,\r\n        db: config.database\r\n      });\r\n    });\r\n  } else {\r\n    windows['instrumentMain'].webContents.send('loadInstrument', {\r\n      tracker: instrumentConfig,\r\n      db: config.database\r\n    });\r\n  }\r\n\r\n  windows['instrumentMain'].once('close', () => {\r\n    windows['instrumentMain'] = null;\r\n  });\r\n\r\n  doMenu();\r\n\r\n  openSocket(instrumentConfig);\r\n}\r\n\r\nfunction editInstrument(event, trackerHost) {\r\n  let data;\r\n\r\n  config.instruments.forEach((instrument, index) => {\r\n    if (instrument.trackerHost == trackerHost) {\r\n      data = instrument;\r\n    }\r\n  });\r\n\r\n  if (!data) {\r\n    throw 'Could not find the data corresponding to this instrument';\r\n  }\r\n\r\n  openForm(null, 'instrumentform', data, {\r\n    width: 600,\r\n    height: 800,\r\n    resizable: false\r\n  })\r\n    .then(async results => {\r\n      Object.assign(data, results);\r\n      await saveConfig();\r\n\r\n      if (windows['instrumentMain']) {\r\n        windows['instrumentMain'].webContents.send('loadInstrument', {\r\n          tracker: data,\r\n          db: config.database\r\n        });\r\n      }\r\n\r\n      if (windows['instrumentList']) {\r\n        windows['instrumentList'].webContents.send('instrumentUpdated');\r\n      }\r\n\r\n      reloadInstruments();\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction editInfluxDB(event) {\r\n  let data;\r\n  let influxConfig = config.database;\r\n\r\n  openForm(null, 'influxdbform', influxConfig, {\r\n    width: 600,\r\n    height: 700,\r\n    resizable: false\r\n  })\r\n    .then(async results => {\r\n      config.database = results;\r\n\r\n      await saveConfig();\r\n\r\n      sendToForm('uploading', {\r\n        status: 'progress',\r\n        host: config.instruments.map(i => i.trackerHost).join(', ')\r\n      });\r\n\r\n      updateInfluxDB()\r\n        .then(() => {\r\n          sendToForm('uploading', { status: 'done' });\r\n        })\r\n        .catch(err => {\r\n          sendToForm('uploading', {\r\n            status: 'error',\r\n            error: err,\r\n            host: err.options.host\r\n          });\r\n        });\r\n\r\n      if (windows['instrumentMain']) {\r\n        windows['instrumentMain'].webContents.send('reloadDB', {\r\n          db: config.database\r\n        });\r\n      }\r\n\r\n      if (windows['instrumentList']) {\r\n        windows['instrumentList'].webContents.send(\r\n          'dbInformation',\r\n          config.database\r\n        );\r\n      }\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction showAllMeasurements(instrument) {\r\n  console.log(instrument);\r\n  openForm(\r\n    null,\r\n    'showallmeasurements',\r\n    { config: instrument, configDB: config.database },\r\n    { width: 600, height: 700, resizable: false }\r\n  )\r\n    .then(results => {})\r\n    .catch(() => {});\r\n}\r\n\r\nfunction updateInfluxDB() {\r\n  return Promise.all(\r\n    config.instruments.map(instrument => {\r\n      return request.post({\r\n        url:\r\n          'http://' +\r\n          instrument.trackerHost +\r\n          ':' +\r\n          instrument.trackerPort +\r\n          '/setInfluxDB',\r\n        host: instrument.trackerHost,\r\n        form: config.database,\r\n        timeout: 1000\r\n      });\r\n    })\r\n  );\r\n}\r\n\r\nasync function configChannel(event, data) {\r\n  let influxConfig = config.database;\r\n\r\n  var channelConfig = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getChannelConfig?instrumentId=' +\r\n      data.instrumentId +\r\n      '&chanId=' +\r\n      data.chanId,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n\r\n  var instrumentConfig = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getInstrumentConfig?instrumentId=' +\r\n      data.instrumentId,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n\r\n  var channelState = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getStatus?instrumentId=' +\r\n      data.instrumentId +\r\n      '&chanId=' +\r\n      data.chanId,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n\r\n  //var externalConnection = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getChannelConfig?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var externalConnection = false;\r\n\r\n  instrumentConfig.instrumentId = data.instrumentId;\r\n\r\n  return openForm(\r\n    null,\r\n    'cellform',\r\n    {\r\n      tracker: data,\r\n      instrumentConfig: instrumentConfig,\r\n      groupName: data.groupName,\r\n      channelConfig: channelConfig,\r\n      channelState: channelState[data.groupName].channels[data.chanId]\r\n    },\r\n    { width: 600, height: 800 }\r\n  )\r\n    .then(results => {\r\n      event.sender.send('channelConfigured', results);\r\n      return results;\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nasync function configChannels(event, data) {\r\n  let influxConfig = config.database;\r\n\r\n  var channelsState = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getStatus?instrumentId=' +\r\n      data.instrumentId +\r\n      '&groupName=' +\r\n      data.groupName,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n  var instrumentConfig = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getInstrumentConfig?instrumentId=' +\r\n      data.instrumentId,\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n  var channelState = await fetch(\r\n    'http://' +\r\n      data.trackerHost +\r\n      ':' +\r\n      data.trackerPort +\r\n      '/getStatus?instrumentId=' +\r\n      data.instrumentId +\r\n      '&chanId=' +\r\n      data.chanIds[0],\r\n    { method: 'GET' }\r\n  ).then(response => response.json());\r\n\r\n  instrumentConfig.instrumentId = data.instrumentId;\r\n\r\n  return openForm(\r\n    null,\r\n    'cellformall',\r\n    {\r\n      tracker: data,\r\n      channelState: channelState[data.groupName].channels[data.chanIds[0]],\r\n      channelsState: channelsState[data.groupName].channels,\r\n      groupName: data.groupName,\r\n      instrumentConfig: instrumentConfig,\r\n      channelIds: data.chanIds\r\n    },\r\n    { width: 600, height: 800 }\r\n  )\r\n    .then(results => {\r\n      event.sender.send('channelsConfigured', results);\r\n      return results;\r\n    })\r\n    .catch(() => {});\r\n}\r\n"],"names":["require","Menu","ipcMain","dialog","app","electron","BrowserWindow","path","url","fs","request","fix","fetch","WebSocket","environment","diagnostics","openForm","sendToForm","reportError","config","saveConfig","getPreference","setPreference","on","addInstrument","editInstrument","removeInstrument","loadInstrument","editInfluxDB","updateInfluxDB","downloadData","htmlReport","configChannel","configChannels","openMPPT","openBugReport","openCalibratePD","openCalibratePyranometer","openScheduleLight","event","sender","send","arg","name","value","label","submenu","click","openDiagnostics","currentInstrument","showAllMeasurements","type","accelerator","selector","instruments","map","instrument","trackerName","checked","trackerHost","instrumentConfig","trackerPortWS","ws","console","log","setTimeout","openSocket","error","code","removeAllListeners","wsIncoming","isAlive","setInterval","terminate","readyState","CLOSED","clearInterval","interval","ping","data","JSON","parse","instrumentId","windows","webContents","chanId","groupName","time","Date","now","ageing","template","push","makeInstrumentMenu","unshift","getName","role","buildFromTemplate","setApplicationMenu","menu","width","height","resizable","once","database","loadURL","format","pathname","join","__dirname","protocol","slashes","doMenu","createMainWindow","platform","quit","tracker","measurementName","trackerPort","method","then","response","json","catch","db","cellInfo","defaultPath","result","reloadInstruments","listenerSavePDF","listenerConfig","showSaveDialog","message","cellName","fileName","filePath","dir","printToPDF","marginsType","pageSize","landscape","err","writeFile","x","y","center","removeListener","listener","showMessageBox","cancelId","defaultId","title","buttons","forEach","index","splice","e","host","mode","close","isLoading","Object","assign","results","influxConfig","status","i","options","configDB","all","post","form","timeout","channelState","channelConfig","channels","chanIds","channelsState","channelIds"],"mappings":"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"}