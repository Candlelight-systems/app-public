<<<<<<< HEAD
{"version":3,"file":null,"sources":["/Users/normanpellet/Documents/Candlelight/code/app_public/source/main.js"],"sourcesContent":["const electron = require('electron')\nconst {Menu,ipcMain,dialog} = require('electron')\n// Module to control application life.\nconst app = electron.app\n// Module to create native browser window.\nconst BrowserWindow = electron.BrowserWindow\n\nconst path = require('path')\nconst url = require('url')\nconst fs = require('fs');\nconst request = require('request-promise-native');\nconst fix = require( 'fix-path' );\nconst fetch = require( 'node-fetch' );\nconst WebSocket = require( 'ws' );\nconst environment = require(\"./environment.json\");\n\nfix();\n\nlet currentInstrument;\n\nconst configPath = path.join( __dirname.replace(\"app.asar\", \"app.asar.unpacked\" ), '/config.json' );\nlet config = JSON.parse( fs.readFileSync( configPath ) );\n\nlet windows = {};\n\nipcMain.on(\"addInstrument\", addInstrument );\nipcMain.on(\"editInstrument\", editInstrument );\nipcMain.on(\"removeInstrument\", removeInstrument );\nipcMain.on(\"loadInstrument\", loadInstrument );\n\nipcMain.on(\"editInfluxDB\", editInfluxDB );\nipcMain.on(\"updateInfluxDB\", updateInfluxDB );\nipcMain.on(\"downloadData\", downloadData );\nipcMain.on(\"htmlReport\", htmlReport );\n\nipcMain.on(\"configChannel\", configChannel );\nipcMain.on(\"configChannels\", configChannels );\nipcMain.on(\"mppt\", openMPPT );\nipcMain.on(\"bugReport\", openBugReport );\nipcMain.on(\"calibratePD\", openCalibratePD );\nipcMain.on(\"calibratePyranometer\", openCalibratePyranometer );\nipcMain.on(\"scheduleLight\", openScheduleLight );\n\nipcMain.on(\"reportError\", reportError );\n\n\nfunction makeInstrumentMenu() {\n  return {\n    label: 'Instrument',\n    submenu: [\n      { label: 'Add a new instrument', click() { addInstrument(); } },\n      { label: 'Edit instrument', click() { editInstrument( currentInstrument ); } },\n      { label: 'Edit database config', click() { editInfluxDB( ); } },\n      { label: 'Show all measurements', click() { showAllMeasurements( currentInstrument ); } },\n      { type: 'separator' },\n      { label: \"Cut\", accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" },\n      { label: \"Copy\", accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" },\n      { label: \"Paste\", accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" },\n\n      ...config.instruments.map( (instrument) => {\n        return { label: instrument.trackerName, checked: currentInstrument == instrument.trackerHost, click( event ) { loadInstrument( event, instrument.trackerHost ) } }\n      } )\n    ]\n  };\n}\n\nfunction openSocket( instrumentConfig ) {\n\n  const ws = new WebSocket('ws://' + instrumentConfig.trackerHost + ':' + instrumentConfig.trackerPortWS );\n  \n  ws.on('open', function open() {\n    console.log(\"Socket is open\");\n  });\n\n  ws.on('close', function open() {\n    console.log(\"Socket is closed\");\n    setTimeout( () => openSocket( instrumentConfig ), 1000 );\n  });\n\n  ws.on('error', function error( err ) {\n    console.log(\"Socket is in error state: \" + error.code );\n  });\n\n  ws.on('message', wsIncoming );\n\n  ws.isAlive = true;\n  ws.on('pong', () => ws.isAlive = true );\n\n  var socketTimeout = () => {\n\n    let interval = setInterval( () => {\n\n      if( !ws.isAlive ) {\n        ws.terminate();\n      }\n\n      if( ws.readyState == WebSocket.CLOSED ) {\n        clearInterval( interval );\n      }\n\n      ws.isAlive = false;\n      ws.ping( () => {} );\n\n    }, 30000 );\n  }\n\n  socketTimeout();\n}\n\n\n\nfunction wsIncoming( data ) {\n\n  data = JSON.parse( data );\n\n  if( data.instrumentId && windows[ 'instrumentMain' ]) {\n\n    if( data.chanId ) {\n      windows[ 'instrumentMain' ].webContents.send( `channel.update.${ data.instrumentId }.${ data.chanId}`, data ); \n    }\n\n    if( data.groupName ) {\n      windows[ 'instrumentMain' ].webContents.send( `group.update.${ data.instrumentId }.${ data.groupName }`, data ); \n    }\n\n    if( data.log ) {\n      data.log.time = Date.now();\n      windows[ 'instrumentMain' ].webContents.send( `instrument.log.${ data.instrumentId }`, data.log );  \n    }\n  }\n}\n\n\n\nfunction doMenu() {\n  //require(\"./menu\");\n  const template = [\n  ];\n\n  if( environment.ageing ) {\n    template.push( makeInstrumentMenu() );\n  }\n\n  //if (process.platform === 'darwin') {\n    template.unshift({\n      label: app.getName(),\n      submenu: [\n        {role: 'about'},\n        {type: 'separator'},\n        {role: 'services', submenu: []},\n        {type: 'separator'},\n        {role: 'hide'},\n        {role: 'hideothers'},\n        {role: 'unhide'},\n        {type: 'separator'},\n        {role: 'quit'},\n      ]\n    });\n\n    if( process.env.NODE_ENV == 'development' ) {\n      template[ 0 ].submenu.push( {role: 'toggledevtools'} )\n    }\n  //}\n\n  const menu = Menu.buildFromTemplate(template);\n  Menu.setApplicationMenu(menu);\n}\n\nfunction saveConfig( ) {\n  \n  return new Promise( ( resolver, rejecter ) => {\n\n    fs.writeFile( configPath, JSON.stringify( config, undefined, \"\\t\" ), ( error ) => {\n\n      if( error ) {\n        reportError( error );\n        rejecter( error );\n      } else {\n        config = JSON.parse( fs.readFileSync( configPath ) );    \n        resolver( );\n      }\n      \n    });  \n  })  \n   \n}\n\n// Keep a global reference of the window object, if you don't, the window will\n// be closed automatically when the JavaScript object is garbage collected.\n\nfunction createMainWindow() {\n  // Create the browser window.\n  windows[ 'instrumentList' ] = new BrowserWindow({ width: 800, height: 700, resizable: false })\n\n  windows[ 'instrumentList' ].webContents.once(\"dom-ready\", () => {\n    windows[ 'instrumentList' ].webContents.send(\"dbInformation\", config.database );\n  });\n\n  // and load the index.html of the app.\n  windows[ 'instrumentList' ].loadURL(url.format({\n    pathname: path.join(__dirname, 'app/instrumentlist.html'),\n    protocol: 'file:',\n    slashes: true\n  }))\n\n  // Open the DevTools.\n  // windows[ 'instrumentList' ].webContents.openDevTools()\n\n  // Emitted when the window is closed.\n  windows[ 'instrumentList' ].on('closed', function () {\n    // Dereference the window object, usually you would store windows\n    // in an array if your app supports multi windows, this is the time\n    // when you should delete the corresponding element.\n    windows[ 'instrumentList' ] = null\n  });\n\n\n\n  doMenu();\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', createMainWindow )\n\n// Quit when all windows are closed.\napp.on('window-all-closed', function () {\n  // On OS X it is common for applications and their menu bar\n  // to stay active until the user quits explicitly with Cmd + Q\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n\napp.on('activate', function () {\n  // On OS X it's common to re-create a window in the app when the\n  // dock icon is clicked and there are no other windows open.\n  if (windows[ 'instrumentList' ] === null) {\n    createMainWindow()\n  }\n})\n\nasync function downloadData( event, tracker, measurementName, chanId, instrumentId ) {\n\n    let json = await fetch( `http://${ tracker.trackerHost }:${ tracker.trackerPort }/getMeasurement?measurementName=${ measurementName }`, {\n      method: 'GET'\n    })\n    .then( ( response ) => response.json() )\n    .catch( () => {\n\n      throw new Error(`Error while connecting to the instrument. Check that you are online and that the instrument is available on your network.`);\n    });\n\n    openForm( null, \"downloadform\", { \n    \n      measurementName: measurementName, \n      db: config.database, \n      cellInfo: json.cellInfo, \n      chanId: chanId,\n      instrumentId: instrumentId\n    \n    }, {\n        width: 850,\n        height: 800,\n        resizable: false\n\n      } ).then( async ( result ) => {\n      \n        config.instruments.push( result );\n        await saveConfig();\n        reloadInstruments();\n\n      } ).catch( () => {} );\n}\n\n\n\nfunction htmlReport( event, cellInfo, chanId, measurementName, instrumentId ) {\n\n    let listenerConfig, listenerSavePDF/*, listenerPrintPDF*/;\n\n    ipcMain.on(\"htmlReport.config\", ( listenerConfig = ( event, data ) => {\n      \n      if( ! windows[ 'htmlReport' ] ) {\n        return;\n      }\n\n      windows[ \"htmlReport\"].webContents.send( \"config\", data );\n    } ) );\n\n    ipcMain.on(\"htmlReport.savePDF\", ( listenerSavePDF = ( event, data ) => {\n      \n      if( ! windows[ 'htmlReport' ] ) {\n        return;\n      }\n\n\n      dialog.showSaveDialog( {\n\n        message: \"Save the report for device \" + data.cellName,\n        defaultPath: \"~/\" + data.cellName + \".pdf\"\n\n      }, ( fileName ) => {\n\n        windows[ 'htmlReport' ].webContents.printToPDF( {\n          marginsType: 1,\n          pageSize: 'A4',\n          landscape: true\n        }, ( err, data ) => {\n\n          fs.writeFile( fileName, data, ( error ) => {\n            console.log( err );  \n          } );\n        } );\n\n      } );\n        \n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\n    } ) );\n\n/*\n\n    ipcMain.on(\"htmlReport.printPDF\", ( listenerPrintPDF = ( event, data ) => {\n      \n      if( ! windows[ 'htmlReport' ] ) {\n        return;\n      }\n\n        windows[ 'htmlReport' ].webContents.print( {\n          marginsType: 1,\n          pageSize: 'A4',\n          landscape: true\n        }, ( err, data ) => {\n\n          fs.writeFile( fileName, data, ( error ) => {\n            console.log( err );  \n          } );\n        } );\n        \n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\n    } ) );\n*/\n    openForm( null, \"htmlreport_control\", { \n      measurementName: measurementName, \n      db: config.database, \n      cellInfo: cellInfo, \n      chanId: chanId \n    },   {\n      \n      width: 400,\n      height: 595,\n      x: 50,\n      y: 100,\n      center: false,\n      resizable: false\n\n    }, () => {\n\n        ipcMain.removeListener( \"htmlReport.config\", listenerConfig );\n        ipcMain.removeListener( \"htmlReport.savePDF\", listenerSavePDF );\n   //     ipcMain.removeListener( \"htmlReport.printPDF\", listenerPrintPDF );\n    } );\n\n    windows[ 'htmlReport' ] = new BrowserWindow( {\n      width: 1122, \n      height: 795, \n      x: 500, \n      y: 100, \n      center: false,\n      resizable: false\n    } )\n  \n\n    windows[ 'htmlReport' ].webContents.once(\"dom-ready\", () => {\n      windows[ 'htmlReport' ].webContents.send(\"loadData\", { measurementName: measurementName, db: config.database, cellInfo: cellInfo, chanId: chanId, instrumentId: instrumentId } );\n    });     \n      // and load the index.html of the app.\n    windows[ 'htmlReport' ].loadURL( url.format({\n      pathname: path.join(__dirname, 'app/htmlreport.html'),\n      protocol: 'file:',\n      slashes: true\n    }) );\n}\n\n\n\n\n\nfunction openBugReport( event ) {\n\n    openForm( null, \"bugreport\", {  },   {\n      width: 540,\n      height: 600,\n      resizable: false\n\n    } );\n}\n\n\nfunction openMPPT( keithleyModel ) {\n\n    windows[ 'mppt' ] = new BrowserWindow({width: 1400, height: 1024, center: true, resizable: false })\n      // and load the index.html of the app.\n    windows[ 'mppt' ].loadURL(url.format({\n      pathname: path.join(__dirname, 'app/mppt.html'),\n      protocol: 'file:',\n      slashes: true\n    }));\n}\n\n\nasync function openCalibratePD( event, data ) {\n\n  openForm( null, \"calibratepd\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\n    width: 800,\n    height: 600,\n    resizable: false\n  }, async () => {\n\n    var channelConfig = await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/resetAllChannels?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\n  } );\n}\n\n\nasync function openCalibratePyranometer( event, data ) {\n\n  openForm( null, \"calibratepyranometer\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\n    width: 800,\n    height: 600,\n    resizable: false\n  }, async () => {\n\n    //var channelConfig = await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/resetAllChannels?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\n  } );\n}\n\n\nasync function openScheduleLight( event, data ) {\n\n\n  //await fetch( \"http://\" + data.config.trackerHost + \":\" +   data.config.trackerPort + \"/light.pause?instrumentId=\" + data.instrumentId, { method: 'GET' } );\n  \n\n  // Once the light has been updated, send the information to the main window for update\n  let listener;\n  ipcMain.on(\"light.updated\", (  listener = () => {\n    windows[ \"instrumentMain\"].webContents.send( \"light.updated\" );\n  } ) );\n\n  openForm( null, \"scheduleLight\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\n    width: 800,\n    height: 600,\n    resizable: false\n  }, function() {\n\n    // After the window is closed, remove the listener\n    ipcMain.removeListener( \"light.updated\", listener );\n//  await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/light.resume?instrumentId=\" + data.instrumentId, { method: 'GET' } );\n\n  } );\n}\n\n\n\n\n// In this file you can include the rest of your app's specific main process\n// code. You can also put them in separate files and require them here.\n\nfunction removeInstrument( event, trackerHost ) {\n\n  dialog.showMessageBox( {\n    type: 'question',\n    message: 'Are you sure that you want to remove this instrument ?',\n    cancelId: 0,\n    defaultId: 0,\n    title: \"Remove the instrument\",\n    buttons: [ \"Cancel\", \"Yes\" ]    \n  }, async ( index ) => {\n\n    if( index == 1 ) {\n\n      config.instruments.forEach( ( instrument, index ) => {\n\n        if( instrument.trackerHost == trackerHost ) {\n          config.instruments.splice( index, 1 );\n        }\n\n      } );\n\n      await saveConfig();\n      reloadInstruments();\n    }\n\n  } );\n}\n\nfunction reportError( e ) {\n\n  console.log('Error reporting !');\n  dialog.showMessageBox( {\n    type: 'error',\n    message: 'An error has happened: ' + e.toString(),\n    cancelId: 0,\n    defaultId: 0,\n    title: \"Error\",\n    buttons: [ \"Ok\" ]    \n  }, ( index ) => {\n\n  } );\n}\n\nfunction reloadInstruments() {\n  windows[ 'instrumentList' ].webContents.send(\"reloadInstruments\");\n  doMenu();\n}\n\nfunction addInstrument() {\n\n  openForm( null, \"instrumentform\", {},   {\n    width: 850,\n    height: 800,\n    resizable: false\n\n  } ).then( async ( result ) => {\n    \n    try {\n      config.instruments.push( result );\n      await saveConfig();\n      reloadInstruments();\n    } catch( e ) {\n      reportError( e );\n    }\n\n\n  }).catch( () => {} );\n\n}\n\nfunction loadInstrument( event, tracker ) {\n\n  const trackerHost = tracker.host;\n  const mode = tracker.mode;\n\n\n  if( ! windows[ 'instrumentMain' ] ) {\n    // Create the browser window.\n    windows[ 'instrumentMain' ] = new BrowserWindow({width: 1400, height: 1024, center: true, resizable: false})\n\n\n  }\n\n  switch( mode ) {\n\n    case 'ageing':\n\n       windows[ 'instrumentMain' ].loadURL(url.format({\n        pathname: path.join(__dirname, 'app/instrument.html'),\n        protocol: 'file:',\n        slashes: true\n      }));\n    break;\n\n    case 'measurement':\n\n      windows[ 'instrumentMain' ].loadURL(url.format({\n        pathname: path.join(__dirname, 'app/instrument.html'),\n        protocol: 'file:',\n        slashes: true\n      } ) );\n\n    break;\n  }\n  \n  if( windows[ 'instrumentList' ] ) {\n    windows[ 'instrumentList' ].close();\n  }\n\n  let instrumentConfig;\n\n  config.instruments.forEach( ( instrument, index ) => {\n\n    if( instrument.trackerHost == trackerHost ) {\n      instrumentConfig = instrument;\n      currentInstrument = instrument;\n    }\n  });\n\n  // Global\n  \n\n\n  if( windows[ 'instrumentMain' ].webContents.isLoading() ) {\n\n    windows[ 'instrumentMain' ].webContents.once(\"dom-ready\", () => {  \n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: instrumentConfig, db: config.database } );  \n    });\n    \n  } else {\n\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: instrumentConfig, db: config.database } );  \n  }\n  \n  windows[ 'instrumentMain' ].once(\"close\", () => {\n    windows[ 'instrumentMain' ] = null;\n  });\n\n  doMenu();\n  \n  openSocket( instrumentConfig );\n}\n\nfunction editInstrument( event, trackerHost ) {\n\n  let data;\n\n  config.instruments.forEach( ( instrument, index ) => {\n\n    if( instrument.trackerHost == trackerHost ) {\n      data = instrument;\n    }\n\n  } );\n\n  if( ! data ) {\n    throw \"Could not find the data corresponding to this instrument\";\n  }\n\n  openForm( null, \"instrumentform\", data, {\n    width: 600,\n    height: 800,\n    resizable: false\n\n  }  ).then( async ( results ) => {\n\n    Object.assign( data, results );\n    await saveConfig();\n\n    if( windows[ 'instrumentMain' ] ) {\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: data, db: config.database } ); \n    }\n    \n    if( windows[ 'instrumentList' ] ) {\n      windows[ 'instrumentList' ].webContents.send( \"instrumentUpdated\" ); \n    }\n    \n    reloadInstruments();\n\n  } ).catch( () => {} );\n}\n\n\n\n\nfunction editInfluxDB( event ) {\n\n  let data;\n  let influxConfig = config.database;\n\n  openForm( null, \"influxdbform\", influxConfig, { width: 600, height: 700, resizable: false } ).then( async ( results ) => {\n\n    config.database = results;\n    saveConfig();\n\n    windows[ 'form' ].webContents.send(\"uploading\", { status: 'progress', host: config.instruments.map( ( i ) => i.trackerHost ).join(', ') } );\n\n    updateInfluxDB( ).then( () => {\n      windows[ 'form' ].webContents.send(\"uploading\", { status: 'done' } );\n    } ).catch( err => {\n      windows[ 'form' ].webContents.send(\"uploading\", { status: 'error', error: err, host: err.options.host } );\n    });\n\n    if( windows[ 'instrumentMain' ] ) {\n      windows[ 'instrumentMain' ].webContents.send( \"reloadDB\", { db: config.database } ); \n    }\n    \n  } ).catch( () => {} );\n}\n\nfunction showAllMeasurements( instrument ) {\n  \n  openForm( null, \"showallmeasurements\", { config: instrument, configDB: config.database }, { width: 600, height: 700, resizable: false } ).then( ( results ) => {\n\n  } ).catch( () => {} );\n}\n\n\nfunction updateInfluxDB( ) {\n\n  return Promise.all( config.instruments.map( ( instrument ) => {\n       return request.post( { url: \"http://\" + instrument.trackerHost + \":\" + instrument.trackerPort + \"/setInfluxDB\", host: instrument.trackerHost, form: config.database, timeout: 1000 } );\n  }  ) );\n}\n\n\nasync function configChannel( event, data ) {\n\n  let influxConfig = config.database;\n\n  var channelConfig = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getChannelConfig?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\n\n  var instrumentConfig = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getInstrumentConfig?instrumentId=\" + data.instrumentId, { method: 'GET' } ).then( ( response ) => response.json() );\n\n  var channelState = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\n\n  //var externalConnection = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getChannelConfig?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\n  var externalConnection = false;\n\n  instrumentConfig.instrumentId = data.instrumentId;\n\n  return openForm( null, \"cellform\", { \n    instrumentConfig: instrumentConfig, \n    groupName: data.groupName,\n    channelConfig: channelConfig, \n    channelState: channelState[ data.groupName ].channels[ data.chanId ],\n  }, { width: 600, height: 800 } ).then( ( results ) => {\n    \n    event.sender.send( \"channelConfigured\", results );\n    return results;    \n\n  } ).catch( () => {} );\n}\n\n\n\nasync function configChannels( event, data ) {\n\n  let influxConfig = config.database;\n\n  var channelsState = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\n  var instrumentConfig = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getInstrumentConfig?instrumentId=\" + data.instrumentId, { method: 'GET' } ).then( ( response ) => response.json() );\n  var channelState = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanIds[ 0 ], { method: 'GET' } ).then( ( response ) => response.json() );\n  \n    instrumentConfig.instrumentId = data.instrumentId;\n\n\n  return openForm( null, \"cellformall\", { \n\n    channelState: channelState[ data.groupName ].channels[ data.chanIds[ 0 ] ], \n    channelsState: channelsState[ data.groupName ].channels, \n    groupName: data.groupName,\n    instrumentConfig: instrumentConfig,\n    channelIds: data.chanIds\n\n  }, { width: 600, height: 800 } ).then( ( results ) => {\n  \n    event.sender.send( \"channelsConfigured\", results );\n    return results;    \n    \n  } ).catch( () => {} );\n}\n\n\n\n\n\nlet windowForm;\n\nfunction openForm( windowName, pageName, formData, options = { width: 300, height: 420 }, onClose ) {\n\n  if( windowForm ) {\n    ( windowForm._rejecter && windowForm._rejecter() );\n    windowForm.close();\n  }\n  // Create the browser window.\n  windowForm = new BrowserWindow( options );\n\n  // and load the index.html of the app.\n  windowForm.loadURL( url.format({\n    pathname: path.join(__dirname, 'app/' + pageName + '.html'),\n    protocol: 'file:',\n    slashes: true\n  }) );\n\n  windows[ \"form\" ] = windowForm;\n\n  windowForm.once(\"closed\", () => {\n    windows[ \"form\" ] = null;\n    ( windowForm && windowForm._rejecter && windowForm._rejecter() );\n    windowForm = null;\n\n    if( typeof onClose == \"function\" ) {\n      onClose();\n    }\n\n  })\n  return new Promise( ( resolver, rejecter ) => {\n    \n    ipcMain.once(\"validateForm\", ( event, data ) => {\n\n      resolver( data );\n    });\n\n    ipcMain.once(\"closeForm\", ( event, data ) => {\n\n      if( windowForm ) {\n        windowForm.close();\n        windowForm = null;\n      }\n    });\n\n    windowForm.webContents.once(\"dom-ready\", () => {\n      windowForm.webContents.send(\"loadForm\", formData );\n    });\n     \n\n    windowForm._rejecter = rejecter;\n  });\n}\n"],"names":["require","Menu","ipcMain","dialog","app","electron","BrowserWindow","path","url","fs","request","fix","fetch","WebSocket","environment","join","__dirname","replace","JSON","parse","readFileSync","configPath","windows","on","addInstrument","editInstrument","removeInstrument","loadInstrument","editInfluxDB","updateInfluxDB","downloadData","htmlReport","configChannel","configChannels","openMPPT","openBugReport","openCalibratePD","openCalibratePyranometer","openScheduleLight","reportError","label","submenu","click","currentInstrument","showAllMeasurements","type","accelerator","selector","config","instruments","map","instrument","trackerName","checked","trackerHost","event","instrumentConfig","trackerPortWS","ws","console","log","setTimeout","openSocket","error","code","wsIncoming","isAlive","setInterval","terminate","readyState","CLOSED","clearInterval","interval","ping","data","instrumentId","chanId","webContents","send","groupName","time","Date","now","ageing","template","push","makeInstrumentMenu","unshift","getName","role","buildFromTemplate","setApplicationMenu","menu","resolver","rejecter","writeFile","stringify","width","height","resizable","once","database","loadURL","format","pathname","protocol","slashes","doMenu","createMainWindow","platform","quit","tracker","measurementName","trackerPort","method","then","response","json","catch","openForm","db","cellInfo","result","reloadInstruments","listenerSavePDF","listenerConfig","showSaveDialog","message","cellName","defaultPath","fileName","printToPDF","marginsType","pageSize","landscape","err","x","y","center","removeListener","listener","showMessageBox","cancelId","defaultId","title","buttons","forEach","index","splice","e","toString","host","mode","close","isLoading","Object","assign","results","influxConfig","saveConfig","status","i","options","configDB","all","post","form","timeout","channelState","channelConfig","channels","sender","chanIds","channelsState","channelIds","windowName","pageName","formData","onClose","windowForm","_rejecter"],"mappings":"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"}
=======
{"version":3,"file":null,"sources":["C:/Users/Candlelight/app-public/source/main.js"],"sourcesContent":["const electron = require('electron')\r\nconst {Menu,ipcMain,dialog} = require('electron')\r\n// Module to control application life.\r\nconst app = electron.app\r\n// Module to create native browser window.\r\nconst BrowserWindow = electron.BrowserWindow\r\n\r\nconst path = require('path')\r\nconst url = require('url')\r\nconst fs = require('fs');\r\nconst request = require('request-promise-native');\r\nconst fix = require( 'fix-path' );\r\nconst fetch = require( 'node-fetch' );\r\nconst WebSocket = require( 'ws' );\r\nconst environment = require(\"./environment.json\");\r\n\r\nfix();\r\n\r\nlet currentInstrument;\r\n\r\nconst configPath = path.join( __dirname.replace(\"app.asar\", \"app.asar.unpacked\" ), '/config.json' );\r\nlet config = JSON.parse( fs.readFileSync( configPath ) );\r\n\r\nlet windows = {};\r\n\r\nipcMain.on(\"addInstrument\", addInstrument );\r\nipcMain.on(\"editInstrument\", editInstrument );\r\nipcMain.on(\"removeInstrument\", removeInstrument );\r\nipcMain.on(\"loadInstrument\", loadInstrument );\r\n\r\nipcMain.on(\"editInfluxDB\", editInfluxDB );\r\nipcMain.on(\"updateInfluxDB\", updateInfluxDB );\r\nipcMain.on(\"downloadData\", downloadData );\r\nipcMain.on(\"htmlReport\", htmlReport );\r\n\r\nipcMain.on(\"configChannel\", configChannel );\r\nipcMain.on(\"configChannels\", configChannels );\r\nipcMain.on(\"mppt\", openMPPT );\r\nipcMain.on(\"bugReport\", openBugReport );\r\nipcMain.on(\"calibratePD\", openCalibratePD );\r\nipcMain.on(\"calibratePyranometer\", openCalibratePyranometer );\r\nipcMain.on(\"scheduleLight\", openScheduleLight );\r\n\r\nipcMain.on(\"reportError\", reportError );\r\n\r\n\r\nfunction makeInstrumentMenu() {\r\n  return {\r\n    label: 'Instrument',\r\n    submenu: [\r\n      { label: 'Add a new instrument', click() { addInstrument(); } },\r\n      { label: 'Edit instrument', click() { editInstrument( currentInstrument ); } },\r\n      { label: 'Edit database config', click() { editInfluxDB( ); } },\r\n      { label: 'Show all measurements', click() { showAllMeasurements( currentInstrument ); } },\r\n      { type: 'separator' },\r\n      { label: \"Cut\", accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" },\r\n      { label: \"Copy\", accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" },\r\n      { label: \"Paste\", accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" },\r\n\r\n      ...config.instruments.map( (instrument) => {\r\n        return { label: instrument.trackerName, checked: currentInstrument == instrument.trackerHost, click( event ) { loadInstrument( event, instrument.trackerHost ) } }\r\n      } )\r\n    ]\r\n  };\r\n}\r\n\r\nfunction openSocket( instrumentConfig ) {\r\n\r\n  const ws = new WebSocket('ws://' + instrumentConfig.trackerHost + ':' + instrumentConfig.trackerPortWS );\r\n  \r\n  ws.on('open', function open() {\r\n    console.log(\"Socket is open\");\r\n  });\r\n\r\n  ws.on('close', function open() {\r\n    console.log(\"Socket is closed\");\r\n    setTimeout( () => openSocket( instrumentConfig ), 1000 );\r\n  });\r\n\r\n  ws.on('error', function error( err ) {\r\n    console.log(\"Socket is in error state: \" + error.code );\r\n  });\r\n\r\n  ws.on('message', wsIncoming );\r\n\r\n  ws.isAlive = true;\r\n  ws.on('pong', () => ws.isAlive = true );\r\n\r\n  var socketTimeout = () => {\r\n\r\n    let interval = setInterval( () => {\r\n\r\n      if( !ws.isAlive ) {\r\n        ws.terminate();\r\n      }\r\n\r\n      if( ws.readyState == WebSocket.CLOSED ) {\r\n        clearInterval( interval );\r\n      }\r\n\r\n      ws.isAlive = false;\r\n      ws.ping( '', false, true );\r\n\r\n    }, 30000 );\r\n  }\r\n\r\n  socketTimeout();\r\n}\r\n\r\n\r\n\r\nfunction wsIncoming( data ) {\r\n\r\n  data = JSON.parse( data );\r\n\r\n  if( data.instrumentId && windows[ 'instrumentMain' ]) {\r\n\r\n    if( data.chanId ) {\r\n      windows[ 'instrumentMain' ].webContents.send( `channel.update.${ data.instrumentId }.${ data.chanId}`, data ); \r\n    }\r\n\r\n    if( data.groupName ) {\r\n      windows[ 'instrumentMain' ].webContents.send( `group.update.${ data.instrumentId }.${ data.groupName }`, data ); \r\n    }\r\n\r\n    if( data.log ) {\r\n      data.log.time = Date.now();\r\n      windows[ 'instrumentMain' ].webContents.send( `instrument.log.${ data.instrumentId }`, data.log );  \r\n    }\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction doMenu() {\r\n  //require(\"./menu\");\r\n  const template = [\r\n  ];\r\n\r\n  if( environment.ageing ) {\r\n    template.push( makeInstrumentMenu() );\r\n  }\r\n\r\n  //if (process.platform === 'darwin') {\r\n    template.unshift({\r\n      label: app.getName(),\r\n      submenu: [\r\n        {role: 'about'},\r\n        {type: 'separator'},\r\n        {role: 'services', submenu: []},\r\n        {type: 'separator'},\r\n        {role: 'hide'},\r\n        {role: 'hideothers'},\r\n        {role: 'unhide'},\r\n        {type: 'separator'},\r\n        {role: 'quit'},\r\n      ]\r\n    });\r\n\r\n    if( process.env.NODE_ENV == 'development' ) {\r\n      template[ 0 ].submenu.push( {role: 'toggledevtools'} )\r\n    }\r\n  //}\r\n\r\n  const menu = Menu.buildFromTemplate(template);\r\n  Menu.setApplicationMenu(menu);\r\n}\r\n\r\nfunction saveConfig( ) {\r\n  \r\n  return new Promise( ( resolver, rejecter ) => {\r\n\r\n    fs.writeFile( configPath, JSON.stringify( config, undefined, \"\\t\" ), ( error ) => {\r\n\r\n      if( error ) {\r\n        reportError( error );\r\n        rejecter( error );\r\n      } else {\r\n        config = JSON.parse( fs.readFileSync( configPath ) );    \r\n        resolver( );\r\n      }\r\n      \r\n    });  \r\n  })  \r\n   \r\n}\r\n\r\n// Keep a global reference of the window object, if you don't, the window will\r\n// be closed automatically when the JavaScript object is garbage collected.\r\n\r\nfunction createMainWindow() {\r\n  // Create the browser window.\r\n  windows[ 'instrumentList' ] = new BrowserWindow({ width: 800, height: 700, resizable: false })\r\n\r\n  windows[ 'instrumentList' ].webContents.once(\"dom-ready\", () => {\r\n    windows[ 'instrumentList' ].webContents.send(\"dbInformation\", config.database );\r\n  });\r\n\r\n  // and load the index.html of the app.\r\n  windows[ 'instrumentList' ].loadURL(url.format({\r\n    pathname: path.join(__dirname, 'app/instrumentlist.html'),\r\n    protocol: 'file:',\r\n    slashes: true\r\n  }))\r\n\r\n  // Open the DevTools.\r\n  // windows[ 'instrumentList' ].webContents.openDevTools()\r\n\r\n  // Emitted when the window is closed.\r\n  windows[ 'instrumentList' ].on('closed', function () {\r\n    // Dereference the window object, usually you would store windows\r\n    // in an array if your app supports multi windows, this is the time\r\n    // when you should delete the corresponding element.\r\n    windows[ 'instrumentList' ] = null\r\n  });\r\n\r\n\r\n\r\n  doMenu();\r\n}\r\n\r\n// This method will be called when Electron has finished\r\n// initialization and is ready to create browser windows.\r\n// Some APIs can only be used after this event occurs.\r\napp.on('ready', createMainWindow )\r\n\r\n// Quit when all windows are closed.\r\napp.on('window-all-closed', function () {\r\n  // On OS X it is common for applications and their menu bar\r\n  // to stay active until the user quits explicitly with Cmd + Q\r\n  if (process.platform !== 'darwin') {\r\n    app.quit()\r\n  }\r\n})\r\n\r\napp.on('activate', function () {\r\n  // On OS X it's common to re-create a window in the app when the\r\n  // dock icon is clicked and there are no other windows open.\r\n  if (windows[ 'instrumentList' ] === null) {\r\n    createMainWindow()\r\n  }\r\n})\r\n\r\nasync function downloadData( event, tracker, measurementName, chanId, instrumentId ) {\r\n\r\n    let json = await fetch( `http://${ tracker.trackerHost }:${ tracker.trackerPort }/getMeasurement?measurementName=${ measurementName }`, {\r\n      method: 'GET'\r\n    })\r\n    .then( ( response ) => response.json() )\r\n    .catch( () => {\r\n\r\n      throw new Error(`Error while connecting to the instrument. Check that you are online and that the instrument is available on your network.`);\r\n    });\r\n\r\n    openForm( null, \"downloadform\", { \r\n    \r\n      measurementName: measurementName, \r\n      db: config.database, \r\n      cellInfo: json.cellInfo, \r\n      chanId: chanId,\r\n      instrumentId: instrumentId\r\n    \r\n    }, {\r\n        width: 850,\r\n        height: 800,\r\n        resizable: false\r\n\r\n      } ).then( async ( result ) => {\r\n      \r\n        config.instruments.push( result );\r\n        await saveConfig();\r\n        reloadInstruments();\r\n\r\n      } ).catch( () => {} );\r\n}\r\n\r\n\r\n\r\nfunction htmlReport( event, cellInfo, chanId, measurementName, instrumentId ) {\r\n\r\n    let listenerConfig, listenerSavePDF/*, listenerPrintPDF*/;\r\n\r\n    ipcMain.on(\"htmlReport.config\", ( listenerConfig = ( event, data ) => {\r\n      \r\n      if( ! windows[ 'htmlReport' ] ) {\r\n        return;\r\n      }\r\n\r\n      windows[ \"htmlReport\"].webContents.send( \"config\", data );\r\n    } ) );\r\n\r\n    ipcMain.on(\"htmlReport.savePDF\", ( listenerSavePDF = ( event, data ) => {\r\n      \r\n      if( ! windows[ 'htmlReport' ] ) {\r\n        return;\r\n      }\r\n\r\n\r\n      dialog.showSaveDialog( {\r\n\r\n        message: \"Save the report for device \" + data.cellName,\r\n        defaultPath: \"~/\" + data.cellName + \".pdf\"\r\n\r\n      }, ( fileName ) => {\r\n\r\n        windows[ 'htmlReport' ].webContents.printToPDF( {\r\n          marginsType: 1,\r\n          pageSize: 'A4',\r\n          landscape: true\r\n        }, ( err, data ) => {\r\n\r\n          fs.writeFile( fileName, data, ( error ) => {\r\n            console.log( err );  \r\n          } );\r\n        } );\r\n\r\n      } );\r\n        \r\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\r\n    } ) );\r\n\r\n/*\r\n\r\n    ipcMain.on(\"htmlReport.printPDF\", ( listenerPrintPDF = ( event, data ) => {\r\n      \r\n      if( ! windows[ 'htmlReport' ] ) {\r\n        return;\r\n      }\r\n\r\n        windows[ 'htmlReport' ].webContents.print( {\r\n          marginsType: 1,\r\n          pageSize: 'A4',\r\n          landscape: true\r\n        }, ( err, data ) => {\r\n\r\n          fs.writeFile( fileName, data, ( error ) => {\r\n            console.log( err );  \r\n          } );\r\n        } );\r\n        \r\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\r\n    } ) );\r\n*/\r\n    openForm( null, \"htmlreport_control\", { \r\n      measurementName: measurementName, \r\n      db: config.database, \r\n      cellInfo: cellInfo, \r\n      chanId: chanId \r\n    },   {\r\n      \r\n      width: 400,\r\n      height: 595,\r\n      x: 50,\r\n      y: 100,\r\n      center: false,\r\n      resizable: false\r\n\r\n    }, () => {\r\n\r\n        ipcMain.removeListener( \"htmlReport.config\", listenerConfig );\r\n        ipcMain.removeListener( \"htmlReport.savePDF\", listenerSavePDF );\r\n   //     ipcMain.removeListener( \"htmlReport.printPDF\", listenerPrintPDF );\r\n    } );\r\n\r\n    windows[ 'htmlReport' ] = new BrowserWindow( {\r\n      width: 1122, \r\n      height: 795, \r\n      x: 500, \r\n      y: 100, \r\n      center: false,\r\n      resizable: false\r\n    } )\r\n  \r\n\r\n    windows[ 'htmlReport' ].webContents.once(\"dom-ready\", () => {\r\n      windows[ 'htmlReport' ].webContents.send(\"loadData\", { measurementName: measurementName, db: config.database, cellInfo: cellInfo, chanId: chanId, instrumentId: instrumentId } );\r\n    });     \r\n      // and load the index.html of the app.\r\n    windows[ 'htmlReport' ].loadURL( url.format({\r\n      pathname: path.join(__dirname, 'app/htmlreport.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    }) );\r\n}\r\n\r\n\r\n\r\n\r\n\r\nfunction openBugReport( event ) {\r\n\r\n    openForm( null, \"bugreport\", {  },   {\r\n      width: 540,\r\n      height: 600,\r\n      resizable: false\r\n\r\n    } );\r\n}\r\n\r\n\r\nfunction openMPPT( keithleyModel ) {\r\n\r\n    windows[ 'mppt' ] = new BrowserWindow({width: 1400, height: 1024, center: true, resizable: false })\r\n      // and load the index.html of the app.\r\n    windows[ 'mppt' ].loadURL(url.format({\r\n      pathname: path.join(__dirname, 'app/mppt.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    }));\r\n}\r\n\r\n\r\nasync function openCalibratePD( event, data ) {\r\n\r\n  openForm( null, \"calibratepd\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\r\n    width: 800,\r\n    height: 600,\r\n    resizable: false\r\n  }, async () => {\r\n\r\n    var channelConfig = await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/resetAllChannels?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  } );\r\n}\r\n\r\n\r\nasync function openCalibratePyranometer( event, data ) {\r\n\r\n  openForm( null, \"calibratepyranometer\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\r\n    width: 800,\r\n    height: 600,\r\n    resizable: false\r\n  }, async () => {\r\n\r\n    //var channelConfig = await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/resetAllChannels?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  } );\r\n}\r\n\r\n\r\nasync function openScheduleLight( event, data ) {\r\n\r\n\r\n  //await fetch( \"http://\" + data.config.trackerHost + \":\" +   data.config.trackerPort + \"/light.pause?instrumentId=\" + data.instrumentId, { method: 'GET' } );\r\n  \r\n\r\n  // Once the light has been updated, send the information to the main window for update\r\n  let listener;\r\n  ipcMain.on(\"light.updated\", (  listener = () => {\r\n    windows[ \"instrumentMain\"].webContents.send( \"light.updated\" );\r\n  } ) );\r\n\r\n  openForm( null, \"scheduleLight\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\r\n    width: 800,\r\n    height: 600,\r\n    resizable: false\r\n  }, function() {\r\n\r\n    // After the window is closed, remove the listener\r\n    ipcMain.removeListener( \"light.updated\", listener );\r\n//  await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/light.resume?instrumentId=\" + data.instrumentId, { method: 'GET' } );\r\n\r\n  } );\r\n}\r\n\r\n\r\n\r\n\r\n// In this file you can include the rest of your app's specific main process\r\n// code. You can also put them in separate files and require them here.\r\n\r\nfunction removeInstrument( event, trackerHost ) {\r\n\r\n  dialog.showMessageBox( {\r\n    type: 'question',\r\n    message: 'Are you sure that you want to remove this instrument ?',\r\n    cancelId: 0,\r\n    defaultId: 0,\r\n    title: \"Remove the instrument\",\r\n    buttons: [ \"Cancel\", \"Yes\" ]    \r\n  }, async ( index ) => {\r\n\r\n    if( index == 1 ) {\r\n\r\n      config.instruments.forEach( ( instrument, index ) => {\r\n\r\n        if( instrument.trackerHost == trackerHost ) {\r\n          config.instruments.splice( index, 1 );\r\n        }\r\n\r\n      } );\r\n\r\n      await saveConfig();\r\n      reloadInstruments();\r\n    }\r\n\r\n  } );\r\n}\r\n\r\nfunction reportError( e ) {\r\n\r\n  console.log('Error reporting !');\r\n  dialog.showMessageBox( {\r\n    type: 'error',\r\n    message: 'An error has happened: ' + e.toString(),\r\n    cancelId: 0,\r\n    defaultId: 0,\r\n    title: \"Error\",\r\n    buttons: [ \"Ok\" ]    \r\n  }, ( index ) => {\r\n\r\n  } );\r\n}\r\n\r\nfunction reloadInstruments() {\r\n  windows[ 'instrumentList' ].webContents.send(\"reloadInstruments\");\r\n  doMenu();\r\n}\r\n\r\nfunction addInstrument() {\r\n\r\n  openForm( null, \"instrumentform\", {},   {\r\n    width: 850,\r\n    height: 800,\r\n    resizable: false\r\n\r\n  } ).then( async ( result ) => {\r\n    \r\n    try {\r\n      config.instruments.push( result );\r\n      await saveConfig();\r\n      reloadInstruments();\r\n    } catch( e ) {\r\n      reportError( e );\r\n    }\r\n\r\n\r\n  }).catch( () => {} );\r\n\r\n}\r\n\r\nfunction loadInstrument( event, tracker ) {\r\n\r\n  const trackerHost = tracker.host;\r\n  const mode = tracker.mode;\r\n\r\n\r\n  if( ! windows[ 'instrumentMain' ] ) {\r\n    // Create the browser window.\r\n    windows[ 'instrumentMain' ] = new BrowserWindow({width: 1400, height: 1024, center: true, resizable: false})\r\n\r\n\r\n  }\r\n\r\n  switch( mode ) {\r\n\r\n    case 'ageing':\r\n\r\n       windows[ 'instrumentMain' ].loadURL(url.format({\r\n        pathname: path.join(__dirname, 'app/instrument.html'),\r\n        protocol: 'file:',\r\n        slashes: true\r\n      }));\r\n    break;\r\n\r\n    case 'measurement':\r\n\r\n      windows[ 'instrumentMain' ].loadURL(url.format({\r\n        pathname: path.join(__dirname, 'app/instrument.html'),\r\n        protocol: 'file:',\r\n        slashes: true\r\n      } ) );\r\n\r\n    break;\r\n  }\r\n  \r\n  if( windows[ 'instrumentList' ] ) {\r\n    windows[ 'instrumentList' ].close();\r\n  }\r\n\r\n  let instrumentConfig;\r\n\r\n  config.instruments.forEach( ( instrument, index ) => {\r\n\r\n    if( instrument.trackerHost == trackerHost ) {\r\n      instrumentConfig = instrument;\r\n      currentInstrument = instrument;\r\n    }\r\n  });\r\n\r\n  // Global\r\n  \r\n\r\n\r\n  if( windows[ 'instrumentMain' ].webContents.isLoading() ) {\r\n\r\n    windows[ 'instrumentMain' ].webContents.once(\"dom-ready\", () => {  \r\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: instrumentConfig, db: config.database } );  \r\n    });\r\n    \r\n  } else {\r\n\r\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: instrumentConfig, db: config.database } );  \r\n  }\r\n  \r\n  windows[ 'instrumentMain' ].once(\"close\", () => {\r\n    windows[ 'instrumentMain' ] = null;\r\n  });\r\n\r\n  doMenu();\r\n  \r\n  openSocket( instrumentConfig );\r\n}\r\n\r\nfunction editInstrument( event, trackerHost ) {\r\n\r\n  let data;\r\n\r\n  config.instruments.forEach( ( instrument, index ) => {\r\n\r\n    if( instrument.trackerHost == trackerHost ) {\r\n      data = instrument;\r\n    }\r\n\r\n  } );\r\n\r\n  if( ! data ) {\r\n    throw \"Could not find the data corresponding to this instrument\";\r\n  }\r\n\r\n  openForm( null, \"instrumentform\", data, {\r\n    width: 600,\r\n    height: 800,\r\n    resizable: false\r\n\r\n  }  ).then( async ( results ) => {\r\n\r\n    Object.assign( data, results );\r\n    await saveConfig();\r\n\r\n    if( windows[ 'instrumentMain' ] ) {\r\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: data, db: config.database } ); \r\n    }\r\n    \r\n    if( windows[ 'instrumentList' ] ) {\r\n      windows[ 'instrumentList' ].webContents.send( \"instrumentUpdated\" ); \r\n    }\r\n    \r\n    reloadInstruments();\r\n\r\n  } ).catch( () => {} );\r\n}\r\n\r\n\r\n\r\n\r\nfunction editInfluxDB( event ) {\r\n\r\n  let data;\r\n  let influxConfig = config.database;\r\n\r\n  openForm( null, \"influxdbform\", influxConfig, { width: 600, height: 700, resizable: false } ).then( async ( results ) => {\r\n\r\n    config.database = results;\r\n    saveConfig();\r\n\r\n    windows[ 'form' ].webContents.send(\"uploading\", { status: 'progress', host: config.instruments.map( ( i ) => i.trackerHost ).join(', ') } );\r\n\r\n    updateInfluxDB( ).then( () => {\r\n      windows[ 'form' ].webContents.send(\"uploading\", { status: 'done' } );\r\n    } ).catch( err => {\r\n      windows[ 'form' ].webContents.send(\"uploading\", { status: 'error', error: err, host: err.options.host } );\r\n    });\r\n\r\n    if( windows[ 'instrumentMain' ] ) {\r\n      windows[ 'instrumentMain' ].webContents.send( \"reloadDB\", { db: config.database } ); \r\n    }\r\n    \r\n  } ).catch( () => {} );\r\n}\r\n\r\nfunction showAllMeasurements( instrument ) {\r\n  \r\n  openForm( null, \"showallmeasurements\", { config: instrument, configDB: config.database }, { width: 600, height: 700, resizable: false } ).then( ( results ) => {\r\n\r\n  } ).catch( () => {} );\r\n}\r\n\r\n\r\nfunction updateInfluxDB( ) {\r\n\r\n  return Promise.all( config.instruments.map( ( instrument ) => {\r\n       return request.post( { url: \"http://\" + instrument.trackerHost + \":\" + instrument.trackerPort + \"/setInfluxDB\", host: instrument.trackerHost, form: config.database, timeout: 1000 } );\r\n  }  ) );\r\n}\r\n\r\n\r\nasync function configChannel( event, data ) {\r\n\r\n  let influxConfig = config.database;\r\n\r\n  var channelConfig = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getChannelConfig?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n\r\n  var instrumentConfig = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getInstrumentConfig?instrumentId=\" + data.instrumentId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n\r\n  var channelState = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n\r\n  //var externalConnection = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getChannelConfig?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var externalConnection = false;\r\n\r\n  instrumentConfig.instrumentId = data.instrumentId;\r\n\r\n  return openForm( null, \"cellform\", { \r\n    instrumentConfig: instrumentConfig, \r\n    groupName: data.groupName,\r\n    channelConfig: channelConfig, \r\n    channelState: channelState[ data.groupName ].channels[ data.chanId ],\r\n  }, { width: 600, height: 800 } ).then( ( results ) => {\r\n    \r\n    event.sender.send( \"channelConfigured\", results );\r\n    return results;    \r\n\r\n  } ).catch( () => {} );\r\n}\r\n\r\n\r\n\r\nasync function configChannels( event, data ) {\r\n\r\n  let influxConfig = config.database;\r\n\r\n  var channelsState = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var instrumentConfig = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getInstrumentConfig?instrumentId=\" + data.instrumentId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var channelState = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanIds[ 0 ], { method: 'GET' } ).then( ( response ) => response.json() );\r\n  \r\n    instrumentConfig.instrumentId = data.instrumentId;\r\n\r\n\r\n  return openForm( null, \"cellformall\", { \r\n\r\n    channelState: channelState[ data.groupName ].channels[ data.chanIds[ 0 ] ], \r\n    channelsState: channelsState[ data.groupName ].channels, \r\n    groupName: data.groupName,\r\n    instrumentConfig: instrumentConfig,\r\n    channelIds: data.chanIds\r\n\r\n  }, { width: 600, height: 800 } ).then( ( results ) => {\r\n  \r\n    event.sender.send( \"channelsConfigured\", results );\r\n    return results;    \r\n    \r\n  } ).catch( () => {} );\r\n}\r\n\r\n\r\n\r\n\r\n\r\nlet windowForm;\r\n\r\nfunction openForm( windowName, pageName, formData, options = { width: 300, height: 420 }, onClose ) {\r\n\r\n  if( windowForm ) {\r\n    ( windowForm._rejecter && windowForm._rejecter() );\r\n    windowForm.close();\r\n  }\r\n  // Create the browser window.\r\n  windowForm = new BrowserWindow( options );\r\n\r\n  // and load the index.html of the app.\r\n  windowForm.loadURL( url.format({\r\n    pathname: path.join(__dirname, 'app/' + pageName + '.html'),\r\n    protocol: 'file:',\r\n    slashes: true\r\n  }) );\r\n\r\n  windows[ \"form\" ] = windowForm;\r\n\r\n  windowForm.once(\"closed\", () => {\r\n    windows[ \"form\" ] = null;\r\n    ( windowForm && windowForm._rejecter && windowForm._rejecter() );\r\n    windowForm = null;\r\n\r\n    if( typeof onClose == \"function\" ) {\r\n      onClose();\r\n    }\r\n\r\n  })\r\n  return new Promise( ( resolver, rejecter ) => {\r\n    \r\n    ipcMain.once(\"validateForm\", ( event, data ) => {\r\n\r\n      resolver( data );\r\n    });\r\n\r\n    ipcMain.once(\"closeForm\", ( event, data ) => {\r\n\r\n      if( windowForm ) {\r\n        windowForm.close();\r\n        windowForm = null;\r\n      }\r\n    });\r\n\r\n    windowForm.webContents.once(\"dom-ready\", () => {\r\n      windowForm.webContents.send(\"loadForm\", formData );\r\n    });\r\n     \r\n\r\n    windowForm._rejecter = rejecter;\r\n  });\r\n}\r\n"],"names":["require","Menu","ipcMain","dialog","app","electron","BrowserWindow","path","url","fs","request","fix","fetch","WebSocket","environment","join","__dirname","replace","JSON","parse","readFileSync","configPath","windows","on","addInstrument","editInstrument","removeInstrument","loadInstrument","editInfluxDB","updateInfluxDB","downloadData","htmlReport","configChannel","configChannels","openMPPT","openBugReport","openCalibratePD","openCalibratePyranometer","openScheduleLight","reportError","label","submenu","click","currentInstrument","showAllMeasurements","type","accelerator","selector","config","instruments","map","instrument","trackerName","checked","trackerHost","event","instrumentConfig","trackerPortWS","ws","console","log","setTimeout","openSocket","error","code","wsIncoming","isAlive","setInterval","terminate","readyState","CLOSED","clearInterval","interval","ping","data","instrumentId","chanId","webContents","send","groupName","time","Date","now","ageing","template","push","makeInstrumentMenu","unshift","getName","role","buildFromTemplate","setApplicationMenu","menu","resolver","rejecter","writeFile","stringify","width","height","resizable","once","database","loadURL","format","pathname","protocol","slashes","doMenu","createMainWindow","platform","quit","tracker","measurementName","trackerPort","method","then","response","json","catch","openForm","db","cellInfo","result","reloadInstruments","listenerSavePDF","listenerConfig","showSaveDialog","message","cellName","defaultPath","fileName","printToPDF","marginsType","pageSize","landscape","err","x","y","center","removeListener","listener","showMessageBox","cancelId","defaultId","title","buttons","forEach","index","splice","e","toString","host","mode","close","isLoading","Object","assign","results","influxConfig","saveConfig","status","i","options","configDB","all","post","form","timeout","channelState","channelConfig","channels","sender","chanIds","channelsState","channelIds","windowName","pageName","formData","onClose","windowForm","_rejecter"],"mappings":"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"}
>>>>>>> 6b3c53b12ecad40a04542c8aab8a60b12845e0eb
