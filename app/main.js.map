{"version":3,"file":null,"sources":["/Users/normanpellet/Documents/Candlelight/code/app_public/source/main.js"],"sourcesContent":["const electron = require('electron');\nconst { Menu, ipcMain, dialog } = require('electron');\n// Module to control application life.\nconst app = electron.app;\n// Module to create native browser window.\nconst BrowserWindow = electron.BrowserWindow;\n\nconst path = require('path');\nconst url = require('url');\nconst fs = require('fs');\nconst request = require('request-promise-native');\nconst fix = require('fix-path');\nconst fetch = require('node-fetch');\nconst WebSocket = require('ws');\nconst environment = require('./environment.json');\n\nfix();\n\nlet currentInstrument;\n\nconst configPath = path.join(\n  __dirname.replace('app.asar', 'app.asar.unpacked'),\n  '/config.json'\n);\nlet config = JSON.parse(fs.readFileSync(configPath));\n\nlet windows = {};\n\nipcMain.on('addInstrument', addInstrument);\nipcMain.on('editInstrument', editInstrument);\nipcMain.on('removeInstrument', removeInstrument);\nipcMain.on('loadInstrument', loadInstrument);\n\nipcMain.on('editInfluxDB', editInfluxDB);\nipcMain.on('updateInfluxDB', updateInfluxDB);\nipcMain.on('downloadData', downloadData);\nipcMain.on('htmlReport', htmlReport);\n\nipcMain.on('configChannel', configChannel);\nipcMain.on('configChannels', configChannels);\nipcMain.on('mppt', openMPPT);\nipcMain.on('bugReport', openBugReport);\nipcMain.on('calibratePD', openCalibratePD);\nipcMain.on('calibratePyranometer', openCalibratePyranometer);\nipcMain.on('scheduleLight', openScheduleLight);\n\nipcMain.on('reportError', reportError);\n\nfunction makeInstrumentMenu() {\n  return {\n    label: 'Instrument',\n    submenu: [\n      {\n        label: 'Add a new instrument',\n        click() {\n          addInstrument();\n        }\n      },\n      {\n        label: 'Edit instrument',\n        click() {\n          editInstrument(currentInstrument);\n        }\n      },\n      {\n        label: 'Edit database config',\n        click() {\n          editInfluxDB();\n        }\n      },\n      {\n        label: 'Show all measurements',\n        click() {\n          showAllMeasurements(currentInstrument);\n        }\n      },\n      { type: 'separator' },\n      { label: 'Cut', accelerator: 'CmdOrCtrl+X', selector: 'cut:' },\n      { label: 'Copy', accelerator: 'CmdOrCtrl+C', selector: 'copy:' },\n      { label: 'Paste', accelerator: 'CmdOrCtrl+V', selector: 'paste:' },\n\n      ...config.instruments.map(instrument => {\n        return {\n          label: instrument.trackerName,\n          checked: currentInstrument == instrument.trackerHost,\n          click(event) {\n            loadInstrument(event, instrument.trackerHost);\n          }\n        };\n      })\n    ]\n  };\n}\n\nfunction openSocket(instrumentConfig) {\n  const ws = new WebSocket(\n    'ws://' +\n      instrumentConfig.trackerHost +\n      ':' +\n      instrumentConfig.trackerPortWS\n  );\n\n  ws.on('open', function open() {\n    console.log('Socket is open');\n  });\n\n  ws.on('close', function open() {\n    console.log('Socket is closed');\n    setTimeout(() => openSocket(instrumentConfig), 1000);\n  });\n\n  ws.on('error', function error(err) {\n    console.log('Socket is in error state: ' + error.code);\n  });\n\n  ws.removeAllListeners('message');\n  ws.on('message', wsIncoming);\n\n  ws.isAlive = true;\n  ws.on('pong', () => (ws.isAlive = true));\n\n  var socketTimeout = () => {\n    let interval = setInterval(() => {\n      if (!ws.isAlive) {\n        ws.terminate();\n      }\n\n      if (ws.readyState == WebSocket.CLOSED) {\n        clearInterval(interval);\n      }\n\n      ws.isAlive = false;\n      ws.ping(() => {});\n    }, 30000);\n  };\n\n  socketTimeout();\n}\n\nfunction wsIncoming(data) {\n  data = JSON.parse(data);\n  \n  if (data.instrumentId && windows['instrumentMain']) {\n    if (data.chanId) {\n      windows['instrumentMain'].webContents.send(\n        `channel.update.${data.instrumentId}.${data.chanId}`,\n        data\n      );\n    }\n\n    if (data.groupName) {\n      windows['instrumentMain'].webContents.send(\n        `group.update.${data.instrumentId}.${data.groupName}`,\n        data\n      );\n    }\n\n    if (data.log) {\n      data.log.time = Date.now();\n      windows['instrumentMain'].webContents.send(\n        `instrument.log.${data.instrumentId}`,\n        data.log\n      );\n    }\n  }\n}\n\nfunction doMenu() {\n  //require(\"./menu\");\n  const template = [];\n\n  if (environment.ageing) {\n    template.push(makeInstrumentMenu());\n  }\n\n  //if (process.platform === 'darwin') {\n  template.unshift({\n    label: app.getName(),\n    submenu: [\n      { role: 'about' },\n      { type: 'separator' },\n      { role: 'services', submenu: [] },\n      { type: 'separator' },\n      { role: 'hide' },\n      { role: 'hideothers' },\n      { role: 'unhide' },\n      { type: 'separator' },\n      { role: 'quit' }\n    ]\n  });\n\n  if (process.env.NODE_ENV == 'development') {\n    template[0].submenu.push({ role: 'toggledevtools' });\n  }\n  //}\n\n  const menu = Menu.buildFromTemplate(template);\n  Menu.setApplicationMenu(menu);\n}\n\nfunction saveConfig() {\n  return new Promise((resolver, rejecter) => {\n    fs.writeFile(configPath, JSON.stringify(config, undefined, '\\t'), error => {\n      if (error) {\n        reportError(error);\n        rejecter(error);\n      } else {\n        config = JSON.parse(fs.readFileSync(configPath));\n        resolver();\n      }\n    });\n  });\n}\n\n// Keep a global reference of the window object, if you don't, the window will\n// be closed automatically when the JavaScript object is garbage collected.\n\nfunction createMainWindow() {\n  // Create the browser window.\n  windows['instrumentList'] = new BrowserWindow({\n    width: 800,\n    height: 700,\n    resizable: false\n  });\n\n  windows['instrumentList'].webContents.once('dom-ready', () => {\n    windows['instrumentList'].webContents.send(\n      'dbInformation',\n      config.database\n    );\n  });\n\n  // and load the index.html of the app.\n  windows['instrumentList'].loadURL(\n    url.format({\n      pathname: path.join(__dirname, 'app/instrumentlist.html'),\n      protocol: 'file:',\n      slashes: true\n    })\n  );\n\n  // Open the DevTools.\n  // windows[ 'instrumentList' ].webContents.openDevTools()\n\n  // Emitted when the window is closed.\n  windows['instrumentList'].on('closed', function() {\n    // Dereference the window object, usually you would store windows\n    // in an array if your app supports multi windows, this is the time\n    // when you should delete the corresponding element.\n    windows['instrumentList'] = null;\n  });\n\n  doMenu();\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', createMainWindow);\n\n// Quit when all windows are closed.\napp.on('window-all-closed', function() {\n  // On OS X it is common for applications and their menu bar\n  // to stay active until the user quits explicitly with Cmd + Q\n  if (process.platform !== 'darwin') {\n    app.quit();\n  }\n});\n\napp.on('activate', function() {\n  // On OS X it's common to re-create a window in the app when the\n  // dock icon is clicked and there are no other windows open.\n  if (windows['instrumentList'] === null) {\n    createMainWindow();\n  }\n});\n\nasync function downloadData(\n  event,\n  tracker,\n  measurementName,\n  chanId,\n  instrumentId\n) {\n  let json = await fetch(\n    `http://${tracker.trackerHost}:${\n      tracker.trackerPort\n    }/getMeasurement?measurementName=${measurementName}`,\n    {\n      method: 'GET'\n    }\n  )\n    .then(response => response.json())\n    .catch(() => {\n      throw new Error(\n        `Error while connecting to the instrument. Check that you are online and that the instrument is available on your network.`\n      );\n    });\n\n  openForm(\n    null,\n    'downloadform',\n    {\n      measurementName: measurementName,\n      db: config.database,\n      cellInfo: json.cellInfo,\n      chanId: chanId,\n      instrumentId: instrumentId\n    },\n    {\n      width: 850,\n      height: 800,\n      resizable: false\n    }\n  )\n    .then(async result => {\n      config.instruments.push(result);\n      await saveConfig();\n      reloadInstruments();\n    })\n    .catch(() => {});\n}\n\nfunction htmlReport(event, cellInfo, chanId, measurementName, instrumentId) {\n  let listenerConfig, listenerSavePDF /*, listenerPrintPDF*/;\n\n  ipcMain.on(\n    'htmlReport.config',\n    (listenerConfig = (event, data) => {\n      if (!windows['htmlReport']) {\n        return;\n      }\n\n      windows['htmlReport'].webContents.send('config', data);\n    })\n  );\n\n  ipcMain.on(\n    'htmlReport.savePDF',\n    (listenerSavePDF = (event, data) => {\n      if (!windows['htmlReport']) {\n        return;\n      }\n\n      dialog.showSaveDialog(\n        {\n          message: 'Save the report for device ' + data.cellName,\n          defaultPath: '~/' + data.cellName + '.pdf'\n        },\n        fileName => {\n          if (!fileName) {\n            return;\n          }\n\n          windows['htmlReport'].webContents.printToPDF(\n            {\n              marginsType: 1,\n              pageSize: 'A4',\n              landscape: true\n            },\n            (err, data) => {\n              fs.writeFile(fileName, data, error => {\n                console.log(err);\n              });\n            }\n          );\n        }\n      );\n\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\n    })\n  );\n\n  /*\n\n    ipcMain.on(\"htmlReport.printPDF\", ( listenerPrintPDF = ( event, data ) => {\n\n      if( ! windows[ 'htmlReport' ] ) {\n        return;\n      }\n\n        windows[ 'htmlReport' ].webContents.print( {\n          marginsType: 1,\n          pageSize: 'A4',\n          landscape: true\n        }, ( err, data ) => {\n\n          fs.writeFile( fileName, data, ( error ) => {\n            console.log( err );\n          } );\n        } );\n\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\n    } ) );\n*/\n  openForm(\n    null,\n    'htmlreport_control',\n    {\n      measurementName: measurementName,\n      db: config.database,\n      cellInfo: cellInfo,\n      chanId: chanId\n    },\n    {\n      width: 400,\n      height: 595,\n      x: 50,\n      y: 100,\n      center: false,\n      resizable: false\n    },\n    () => {\n      ipcMain.removeListener('htmlReport.config', listenerConfig);\n      ipcMain.removeListener('htmlReport.savePDF', listenerSavePDF);\n      //     ipcMain.removeListener( \"htmlReport.printPDF\", listenerPrintPDF );\n    }\n  );\n\n  windows['htmlReport'] = new BrowserWindow({\n    width: 1122,\n    height: 795,\n    x: 500,\n    y: 100,\n    center: false,\n    resizable: false\n  });\n\n  windows['htmlReport'].webContents.once('dom-ready', () => {\n    windows['htmlReport'].webContents.send('loadData', {\n      measurementName: measurementName,\n      db: config.database,\n      cellInfo: cellInfo,\n      chanId: chanId,\n      instrumentId: instrumentId\n    });\n  });\n  // and load the index.html of the app.\n  windows['htmlReport'].loadURL(\n    url.format({\n      pathname: path.join(__dirname, 'app/htmlreport.html'),\n      protocol: 'file:',\n      slashes: true\n    })\n  );\n}\n\nfunction openBugReport(event) {\n  openForm(\n    null,\n    'bugreport',\n    {},\n    {\n      width: 540,\n      height: 600,\n      resizable: false\n    }\n  );\n}\n\nfunction openMPPT(keithleyModel) {\n  windows['mppt'] = new BrowserWindow({\n    width: 1400,\n    height: 1024,\n    center: true,\n    resizable: false\n  });\n  // and load the index.html of the app.\n  windows['mppt'].loadURL(\n    url.format({\n      pathname: path.join(__dirname, 'app/mppt.html'),\n      protocol: 'file:',\n      slashes: true\n    })\n  );\n}\n\nasync function openCalibratePD(event, data) {\n  openForm(\n    null,\n    'calibratepd',\n    {\n      instrumentId: data.instrumentId,\n      groupName: data.groupName,\n      config: data.config\n    },\n    {\n      width: 800,\n      height: 600,\n      resizable: false\n    },\n    async () => {\n      var channelConfig = await fetch(\n        'http://' +\n          data.config.trackerHost +\n          ':' +\n          data.config.trackerPort +\n          '/resetAllChannels?instrumentId=' +\n          data.instrumentId +\n          '&groupName=' +\n          data.groupName,\n        { method: 'GET' }\n      ).then(response => response.json());\n    }\n  );\n}\n\nasync function openCalibratePyranometer(event, data) {\n  openForm(\n    null,\n    'calibratepyranometer',\n    {\n      instrumentId: data.instrumentId,\n      groupName: data.groupName,\n      config: data.config\n    },\n    {\n      width: 800,\n      height: 600,\n      resizable: false\n    },\n    async () => {\n      //var channelConfig = await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/resetAllChannels?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\n    }\n  );\n}\n\nasync function openScheduleLight(event, data) {\n  //await fetch( \"http://\" + data.config.trackerHost + \":\" +   data.config.trackerPort + \"/light.pause?instrumentId=\" + data.instrumentId, { method: 'GET' } );\n\n  // Once the light has been updated, send the information to the main window for update\n  let listener;\n  ipcMain.on(\n    'light.updated',\n    (listener = () => {\n      windows['instrumentMain'].webContents.send('light.updated');\n    })\n  );\n\n  openForm(\n    null,\n    'scheduleLight',\n    {\n      instrumentId: data.instrumentId,\n      groupName: data.groupName,\n      config: data.config\n    },\n    {\n      width: 800,\n      height: 600,\n      resizable: false\n    },\n    function() {\n      // After the window is closed, remove the listener\n      ipcMain.removeListener('light.updated', listener);\n      //  await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/light.resume?instrumentId=\" + data.instrumentId, { method: 'GET' } );\n    }\n  );\n}\n\n// In this file you can include the rest of your app's specific main process\n// code. You can also put them in separate files and require them here.\n\nfunction removeInstrument(event, trackerHost) {\n  dialog.showMessageBox(\n    {\n      type: 'question',\n      message: 'Are you sure that you want to remove this instrument ?',\n      cancelId: 0,\n      defaultId: 0,\n      title: 'Remove the instrument',\n      buttons: ['Cancel', 'Yes']\n    },\n    async index => {\n      if (index == 1) {\n        config.instruments.forEach((instrument, index) => {\n          if (instrument.trackerHost == trackerHost) {\n            config.instruments.splice(index, 1);\n          }\n        });\n\n        await saveConfig();\n        reloadInstruments();\n      }\n    }\n  );\n}\n\nfunction reportError(e) {\n  console.log('Error reporting !');\n  dialog.showMessageBox(\n    {\n      type: 'error',\n      message: 'An error has happened: ' + e.toString(),\n      cancelId: 0,\n      defaultId: 0,\n      title: 'Error',\n      buttons: ['Ok']\n    },\n    index => {}\n  );\n}\n\nfunction reloadInstruments() {\n  windows['instrumentList'].webContents.send('reloadInstruments');\n  doMenu();\n}\n\nfunction addInstrument() {\n  openForm(\n    null,\n    'instrumentform',\n    {},\n    {\n      width: 850,\n      height: 800,\n      resizable: false\n    }\n  )\n    .then(async result => {\n      try {\n        config.instruments.push(result);\n        await saveConfig();\n        reloadInstruments();\n      } catch (e) {\n        reportError(e);\n      }\n    })\n    .catch(() => {});\n}\n\nfunction loadInstrument(event, tracker) {\n  const trackerHost = tracker.host;\n  const mode = tracker.mode;\n\n  if (!windows['instrumentMain']) {\n    // Create the browser window.\n    windows['instrumentMain'] = new BrowserWindow({\n      width: 1400,\n      height: 1024,\n      center: true,\n      resizable: true\n    });\n  }\n\n  switch (mode) {\n    case 'ageing':\n      windows['instrumentMain'].loadURL(\n        url.format({\n          pathname: path.join(__dirname, 'app/instrument.html'),\n          protocol: 'file:',\n          slashes: true\n        })\n      );\n      break;\n\n    case 'measurement':\n      windows['instrumentMain'].loadURL(\n        url.format({\n          pathname: path.join(__dirname, 'app/ivmeasurements/index.html'),\n          protocol: 'file:',\n          slashes: true\n        })\n      );\n\n      break;\n  }\n\n  if (windows['instrumentList']) {\n    windows['instrumentList'].close();\n  }\n\n  let instrumentConfig;\n\n  config.instruments.forEach((instrument, index) => {\n    if (instrument.trackerHost == trackerHost) {\n      instrumentConfig = instrument;\n      currentInstrument = instrument;\n    }\n  });\n\n  // Global\n\n  if (windows['instrumentMain'].webContents.isLoading()) {\n    windows['instrumentMain'].webContents.once('dom-ready', () => {\n      windows['instrumentMain'].webContents.send('loadInstrument', {\n        tracker: instrumentConfig,\n        db: config.database\n      });\n    });\n  } else {\n    windows['instrumentMain'].webContents.send('loadInstrument', {\n      tracker: instrumentConfig,\n      db: config.database\n    });\n  }\n\n  windows['instrumentMain'].once('close', () => {\n    windows['instrumentMain'] = null;\n  });\n\n  doMenu();\n\n  openSocket(instrumentConfig);\n}\n\nfunction editInstrument(event, trackerHost) {\n  let data;\n\n  config.instruments.forEach((instrument, index) => {\n    if (instrument.trackerHost == trackerHost) {\n      data = instrument;\n    }\n  });\n\n  if (!data) {\n    throw 'Could not find the data corresponding to this instrument';\n  }\n\n  openForm(null, 'instrumentform', data, {\n    width: 600,\n    height: 800,\n    resizable: false\n  })\n    .then(async results => {\n      Object.assign(data, results);\n      await saveConfig();\n\n      if (windows['instrumentMain']) {\n        windows['instrumentMain'].webContents.send('loadInstrument', {\n          tracker: data,\n          db: config.database\n        });\n      }\n\n      if (windows['instrumentList']) {\n        windows['instrumentList'].webContents.send('instrumentUpdated');\n      }\n\n      reloadInstruments();\n    })\n    .catch(() => {});\n}\n\nfunction editInfluxDB(event) {\n  let data;\n  let influxConfig = config.database;\n\n  openForm(null, 'influxdbform', influxConfig, {\n    width: 600,\n    height: 700,\n    resizable: false\n  })\n    .then(async results => {\n      config.database = results;\n      saveConfig();\n\n      windows['form'].webContents.send('uploading', {\n        status: 'progress',\n        host: config.instruments.map(i => i.trackerHost).join(', ')\n      });\n\n      updateInfluxDB()\n        .then(() => {\n          windows['form'].webContents.send('uploading', { status: 'done' });\n        })\n        .catch(err => {\n          windows['form'].webContents.send('uploading', {\n            status: 'error',\n            error: err,\n            host: err.options.host\n          });\n        });\n\n      if (windows['instrumentMain']) {\n        windows['instrumentMain'].webContents.send('reloadDB', {\n          db: config.database\n        });\n      }\n    })\n    .catch(() => {});\n}\n\nfunction showAllMeasurements(instrument) {\n  console.log(instrument);\n  openForm(\n    null,\n    'showallmeasurements',\n    { config: instrument, configDB: config.database },\n    { width: 600, height: 700, resizable: false }\n  )\n    .then(results => {})\n    .catch(() => {});\n}\n\nfunction updateInfluxDB() {\n  return Promise.all(\n    config.instruments.map(instrument => {\n      return request.post({\n        url:\n          'http://' +\n          instrument.trackerHost +\n          ':' +\n          instrument.trackerPort +\n          '/setInfluxDB',\n        host: instrument.trackerHost,\n        form: config.database,\n        timeout: 1000\n      });\n    })\n  );\n}\n\nasync function configChannel(event, data) {\n  let influxConfig = config.database;\n\n  var channelConfig = await fetch(\n    'http://' +\n      data.trackerHost +\n      ':' +\n      data.trackerPort +\n      '/getChannelConfig?instrumentId=' +\n      data.instrumentId +\n      '&chanId=' +\n      data.chanId,\n    { method: 'GET' }\n  ).then(response => response.json());\n\n  var instrumentConfig = await fetch(\n    'http://' +\n      data.trackerHost +\n      ':' +\n      data.trackerPort +\n      '/getInstrumentConfig?instrumentId=' +\n      data.instrumentId,\n    { method: 'GET' }\n  ).then(response => response.json());\n\n  var channelState = await fetch(\n    'http://' +\n      data.trackerHost +\n      ':' +\n      data.trackerPort +\n      '/getStatus?instrumentId=' +\n      data.instrumentId +\n      '&chanId=' +\n      data.chanId,\n    { method: 'GET' }\n  ).then(response => response.json());\n\n  //var externalConnection = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getChannelConfig?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\n  var externalConnection = false;\n\n  instrumentConfig.instrumentId = data.instrumentId;\n\n  return openForm(\n    null,\n    'cellform',\n    {\n      instrumentConfig: instrumentConfig,\n      groupName: data.groupName,\n      channelConfig: channelConfig,\n      channelState: channelState[data.groupName].channels[data.chanId]\n    },\n    { width: 600, height: 800 }\n  )\n    .then(results => {\n      event.sender.send('channelConfigured', results);\n      return results;\n    })\n    .catch(() => {});\n}\n\nasync function configChannels(event, data) {\n  let influxConfig = config.database;\n\n  var channelsState = await fetch(\n    'http://' +\n      data.trackerHost +\n      ':' +\n      data.trackerPort +\n      '/getStatus?instrumentId=' +\n      data.instrumentId +\n      '&groupName=' +\n      data.groupName,\n    { method: 'GET' }\n  ).then(response => response.json());\n  var instrumentConfig = await fetch(\n    'http://' +\n      data.trackerHost +\n      ':' +\n      data.trackerPort +\n      '/getInstrumentConfig?instrumentId=' +\n      data.instrumentId,\n    { method: 'GET' }\n  ).then(response => response.json());\n  var channelState = await fetch(\n    'http://' +\n      data.trackerHost +\n      ':' +\n      data.trackerPort +\n      '/getStatus?instrumentId=' +\n      data.instrumentId +\n      '&chanId=' +\n      data.chanIds[0],\n    { method: 'GET' }\n  ).then(response => response.json());\n\n  instrumentConfig.instrumentId = data.instrumentId;\n\n  return openForm(\n    null,\n    'cellformall',\n    {\n      channelState: channelState[data.groupName].channels[data.chanIds[0]],\n      channelsState: channelsState[data.groupName].channels,\n      groupName: data.groupName,\n      instrumentConfig: instrumentConfig,\n      channelIds: data.chanIds\n    },\n    { width: 600, height: 800 }\n  )\n    .then(results => {\n      event.sender.send('channelsConfigured', results);\n      return results;\n    })\n    .catch(() => {});\n}\n\nlet windowForm;\n\nfunction openForm(\n  windowName,\n  pageName,\n  formData,\n  options = { width: 300, height: 420 },\n  onClose\n) {\n  if (windowForm) {\n    windowForm._rejecter && windowForm._rejecter();\n    windowForm.close();\n  }\n  // Create the browser window.\n  windowForm = new BrowserWindow(options);\n\n  // and load the index.html of the app.\n  windowForm.loadURL(\n    url.format({\n      pathname: path.join(__dirname, 'app/' + pageName + '.html'),\n      protocol: 'file:',\n      slashes: true\n    })\n  );\n\n  windows['form'] = windowForm;\n\n  windowForm.once('closed', () => {\n    windows['form'] = null;\n    windowForm && windowForm._rejecter && windowForm._rejecter();\n    windowForm = null;\n\n    if (typeof onClose == 'function') {\n      onClose();\n    }\n  });\n  return new Promise((resolver, rejecter) => {\n    ipcMain.once('validateForm', (event, data) => {\n      resolver(data);\n    });\n\n    ipcMain.once('closeForm', (event, data) => {\n      if (windowForm) {\n        windowForm.close();\n        windowForm = null;\n      }\n    });\n\n    windowForm.webContents.once('dom-ready', () => {\n      windowForm.webContents.send('loadForm', formData);\n    });\n\n    windowForm._rejecter = rejecter;\n  });\n}\n"],"names":["require","Menu","ipcMain","dialog","app","electron","BrowserWindow","path","url","fs","request","fix","fetch","WebSocket","environment","join","__dirname","replace","JSON","parse","readFileSync","configPath","windows","on","addInstrument","editInstrument","removeInstrument","loadInstrument","editInfluxDB","updateInfluxDB","downloadData","htmlReport","configChannel","configChannels","openMPPT","openBugReport","openCalibratePD","openCalibratePyranometer","openScheduleLight","reportError","label","submenu","click","currentInstrument","showAllMeasurements","type","accelerator","selector","config","instruments","map","instrument","trackerName","checked","trackerHost","event","instrumentConfig","trackerPortWS","ws","console","log","setTimeout","openSocket","error","code","removeAllListeners","wsIncoming","isAlive","setInterval","terminate","readyState","CLOSED","clearInterval","interval","ping","data","instrumentId","chanId","webContents","send","groupName","time","Date","now","ageing","template","push","makeInstrumentMenu","unshift","getName","role","buildFromTemplate","setApplicationMenu","menu","resolver","rejecter","writeFile","stringify","width","height","resizable","once","database","loadURL","format","pathname","protocol","slashes","doMenu","createMainWindow","platform","quit","tracker","measurementName","trackerPort","method","then","response","json","catch","openForm","db","cellInfo","result","reloadInstruments","listenerSavePDF","listenerConfig","showSaveDialog","message","cellName","defaultPath","fileName","printToPDF","marginsType","pageSize","landscape","err","x","y","center","removeListener","listener","showMessageBox","cancelId","defaultId","title","buttons","forEach","index","splice","e","toString","host","mode","close","isLoading","Object","assign","results","influxConfig","saveConfig","status","i","options","configDB","all","post","form","timeout","channelState","channelConfig","channels","sender","chanIds","channelsState","channelIds","windowName","pageName","formData","onClose","windowForm","_rejecter"],"mappings":"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"}