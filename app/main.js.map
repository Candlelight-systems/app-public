{"version":3,"sources":["../source/main.js"],"names":["electron","require","Menu","ipcMain","dialog","app","BrowserWindow","path","url","fs","request","fix","fetch","environment","currentInstrument","configPath","join","__dirname","replace","config","JSON","parse","readFileSync","windows","on","addInstrument","editInstrument","removeInstrument","loadInstrument","editInfluxDB","updateInfluxDB","downloadData","htmlReport","configChannel","configChannels","openMPPT","openBugReport","openCalibratePD","openScheduleLight","makeInstrumentMenu","label","submenu","click","showAllMeasurements","type","accelerator","selector","instruments","map","instrument","trackerName","checked","trackerHost","event","doMenu","template","ageing","push","unshift","getName","role","menu","buildFromTemplate","setApplicationMenu","saveConfig","writeFile","stringify","error","reportError","createMainWindow","width","height","resizable","loadURL","format","pathname","protocol","slashes","platform","quit","cellInfo","chanId","measurementName","openForm","db","database","then","result","reloadInstruments","catch","listenerConfig","listenerSavePDF","data","webContents","send","showSaveDialog","message","cellName","defaultPath","fileName","printToPDF","marginsType","pageSize","landscape","err","console","log","x","y","center","removeListener","once","instrumentId","groupName","listener","showMessageBox","cancelId","defaultId","title","buttons","index","forEach","splice","e","toString","close","instrumentConfig","isLoading","tracker","results","Object","assign","influxConfig","post","trackerPort","form","channelConfig","method","response","json","channelState","channels","sender","channelsState","chanIds","channelIds","windowForm","windowName","pageName","formData","options","onClose","_rejecter","Promise","resolver","rejecter"],"mappings":"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","file":"main.js","sourcesContent":["const electron = require('electron')\r\nconst {Menu,ipcMain,dialog} = require('electron')\r\n// Module to control application life.\r\nconst app = electron.app\r\n// Module to create native browser window.\r\nconst BrowserWindow = electron.BrowserWindow\r\n\r\nconst path = require('path')\r\nconst url = require('url')\r\nconst fs = require('fs');\r\nconst request = require('request');\r\nconst fix = require( 'fix-path' );\r\nconst fetch = require( 'node-fetch' );\r\nconst environment = require(\"./environment.json\");\r\n\r\nfix();\r\n\r\nlet currentInstrument;\r\n\r\nconst configPath = path.join( __dirname.replace(\"app.asar\", \"app.asar.unpacked\" ), '/config.json' );\r\nlet config = JSON.parse( fs.readFileSync( configPath ) );\r\n\r\nlet windows = {};\r\n\r\nipcMain.on(\"addInstrument\", addInstrument );\r\nipcMain.on(\"editInstrument\", editInstrument );\r\nipcMain.on(\"removeInstrument\", removeInstrument );\r\nipcMain.on(\"loadInstrument\", loadInstrument );\r\n\r\nipcMain.on(\"editInfluxDB\", editInfluxDB );\r\nipcMain.on(\"updateInfluxDB\", updateInfluxDB );\r\nipcMain.on(\"downloadData\", downloadData );\r\nipcMain.on(\"htmlReport\", htmlReport );\r\n\r\nipcMain.on(\"configChannel\", configChannel );\r\nipcMain.on(\"configChannels\", configChannels );\r\nipcMain.on(\"mppt\", openMPPT );\r\nipcMain.on(\"bugReport\", openBugReport );\r\nipcMain.on(\"calibratePD\", openCalibratePD );\r\nipcMain.on(\"scheduleLight\", openScheduleLight );\r\n\r\n\r\n\r\n\r\nfunction makeInstrumentMenu() {\r\n  return {\r\n    label: 'Instrument',\r\n    submenu: [\r\n      { label: 'Add a new instrument', click() { addInstrument(); } },\r\n      { label: 'Edit instrument', click() { editInstrument( currentInstrument ); } },\r\n      { label: 'Edit database config', click() { editInfluxDB( ); } },\r\n      { label: 'Show all measurements', click() { showAllMeasurements( currentInstrument ); } },\r\n      { type: 'separator' },\r\n      { label: \"Cut\", accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" },\r\n      { label: \"Copy\", accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" },\r\n      { label: \"Paste\", accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" },\r\n\r\n      ...config.instruments.map( (instrument) => {\r\n        return { label: instrument.trackerName, checked: currentInstrument == instrument.trackerHost, click( event ) { loadInstrument( event, instrument.trackerHost ) } }\r\n      } )\r\n    ]\r\n  };\r\n}\r\n\r\n\r\n\r\nfunction doMenu() {\r\n  //require(\"./menu\");\r\n  const template = [\r\n  ];\r\n\r\n  if( environment.ageing ) {\r\n    template.push( makeInstrumentMenu() );\r\n  }\r\n\r\n  //if (process.platform === 'darwin') {\r\n    template.unshift({\r\n      label: app.getName(),\r\n      submenu: [\r\n        {role: 'about'},\r\n        {type: 'separator'},\r\n        {role: 'services', submenu: []},\r\n        {type: 'separator'},\r\n        {role: 'hide'},\r\n        {role: 'hideothers'},\r\n        {role: 'unhide'},\r\n        {type: 'separator'},\r\n        {role: 'quit'},\r\n      ]\r\n    });\r\n\r\n    if( process.env.NODE_ENV == 'development' ) {\r\n      template[ 0 ].submenu.push( {role: 'toggledevtools'} )\r\n    }\r\n  //}\r\n\r\n  const menu = Menu.buildFromTemplate(template);\r\n  Menu.setApplicationMenu(menu);\r\n}\r\n\r\n\r\n\r\nfunction saveConfig( ) {\r\n  fs.writeFile( configPath, JSON.stringify( config, undefined, \"\\t\" ), ( error ) => {\r\n\r\n    if( error ) {\r\n      reportError( error );\r\n    } else {\r\n      config = JSON.parse( fs.readFileSync( configPath ) );    \r\n    }\r\n    \r\n  }); \r\n  \r\n}\r\n\r\n// Keep a global reference of the window object, if you don't, the window will\r\n// be closed automatically when the JavaScript object is garbage collected.\r\n\r\nfunction createMainWindow() {\r\n  // Create the browser window.\r\n  windows[ 'instrumentList' ] = new BrowserWindow({ width: 800, height: 700, resizable: false })\r\n\r\n  // and load the index.html of the app.\r\n  windows[ 'instrumentList' ].loadURL(url.format({\r\n    pathname: path.join(__dirname, 'app/instrumentlist.html'),\r\n    protocol: 'file:',\r\n    slashes: true\r\n  }))\r\n\r\n  // Open the DevTools.\r\n  // windows[ 'instrumentList' ].webContents.openDevTools()\r\n\r\n  // Emitted when the window is closed.\r\n  windows[ 'instrumentList' ].on('closed', function () {\r\n    // Dereference the window object, usually you would store windows\r\n    // in an array if your app supports multi windows, this is the time\r\n    // when you should delete the corresponding element.\r\n    windows[ 'instrumentList' ] = null\r\n  });\r\n\r\n  doMenu();\r\n}\r\n\r\n// This method will be called when Electron has finished\r\n// initialization and is ready to create browser windows.\r\n// Some APIs can only be used after this event occurs.\r\napp.on('ready', createMainWindow )\r\n\r\n// Quit when all windows are closed.\r\napp.on('window-all-closed', function () {\r\n  // On OS X it is common for applications and their menu bar\r\n  // to stay active until the user quits explicitly with Cmd + Q\r\n  if (process.platform !== 'darwin') {\r\n    app.quit()\r\n  }\r\n})\r\n\r\napp.on('activate', function () {\r\n  // On OS X it's common to re-create a window in the app when the\r\n  // dock icon is clicked and there are no other windows open.\r\n  if (windows[ 'instrumentList' ] === null) {\r\n    createMainWindow()\r\n  }\r\n})\r\n\r\nfunction downloadData( event, cellInfo, chanId, measurementName ) {\r\n\r\n    openForm( null, \"downloadform\", { \r\n      measurementName: measurementName, \r\n      db: config.database, \r\n      cellInfo: cellInfo, \r\n      chanId: chanId \r\n      }, {\r\n        width: 850,\r\n        height: 800,\r\n        resizable: false\r\n\r\n      } ).then( ( result ) => {\r\n      \r\n        config.instruments.push( result );\r\n        saveConfig();\r\n        reloadInstruments();\r\n\r\n      } ).catch( () => {} );\r\n}\r\n\r\n\r\n\r\nfunction htmlReport( event, cellInfo, chanId, measurementName ) {\r\n\r\n    let listenerConfig, listenerSavePDF/*, listenerPrintPDF*/;\r\n\r\n    ipcMain.on(\"htmlReport.config\", ( listenerConfig = ( event, data ) => {\r\n      \r\n      if( ! windows[ 'htmlReport' ] ) {\r\n        return;\r\n      }\r\n\r\n      windows[ \"htmlReport\"].webContents.send( \"config\", data );\r\n    } ) );\r\n\r\n    ipcMain.on(\"htmlReport.savePDF\", ( listenerSavePDF = ( event, data ) => {\r\n      \r\n      if( ! windows[ 'htmlReport' ] ) {\r\n        return;\r\n      }\r\n\r\n\r\n      dialog.showSaveDialog( {\r\n\r\n        message: \"Save the report for device \" + data.cellName,\r\n        defaultPath: \"~/\" + data.cellName + \".pdf\"\r\n\r\n      }, ( fileName ) => {\r\n\r\n        windows[ 'htmlReport' ].webContents.printToPDF( {\r\n          marginsType: 1,\r\n          pageSize: 'A4',\r\n          landscape: true\r\n        }, ( err, data ) => {\r\n\r\n          fs.writeFile( fileName, data, ( error ) => {\r\n            console.log( err );  \r\n          } );\r\n        } );\r\n\r\n      } );\r\n        \r\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\r\n    } ) );\r\n\r\n/*\r\n\r\n    ipcMain.on(\"htmlReport.printPDF\", ( listenerPrintPDF = ( event, data ) => {\r\n      \r\n      if( ! windows[ 'htmlReport' ] ) {\r\n        return;\r\n      }\r\n\r\n        windows[ 'htmlReport' ].webContents.print( {\r\n          marginsType: 1,\r\n          pageSize: 'A4',\r\n          landscape: true\r\n        }, ( err, data ) => {\r\n\r\n          fs.writeFile( fileName, data, ( error ) => {\r\n            console.log( err );  \r\n          } );\r\n        } );\r\n        \r\n      //windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\r\n    } ) );\r\n*/\r\n    openForm( null, \"htmlreport_control\", { \r\n      measurementName: measurementName, \r\n      db: config.database, \r\n      cellInfo: cellInfo, \r\n      chanId: chanId \r\n    },   {\r\n      \r\n      width: 400,\r\n      height: 595,\r\n      x: 50,\r\n      y: 100,\r\n      center: false,\r\n      resizable: false\r\n\r\n    }, () => {\r\n\r\n        ipcMain.removeListener( \"htmlReport.config\", listenerConfig );\r\n        ipcMain.removeListener( \"htmlReport.savePDF\", listenerSavePDF );\r\n   //     ipcMain.removeListener( \"htmlReport.printPDF\", listenerPrintPDF );\r\n    } );\r\n\r\n    windows[ 'htmlReport' ] = new BrowserWindow( {\r\n      width: 1122, \r\n      height: 795, \r\n      x: 500, \r\n      y: 100, \r\n      center: false,\r\n      resizable: false\r\n    } )\r\n  \r\n\r\n    windows[ 'htmlReport' ].webContents.once(\"dom-ready\", () => {\r\n      windows[ 'htmlReport' ].webContents.send(\"loadData\", { measurementName: measurementName, db: config.database, cellInfo: cellInfo, chanId: chanId } );\r\n    });     \r\n      // and load the index.html of the app.\r\n    windows[ 'htmlReport' ].loadURL( url.format({\r\n      pathname: path.join(__dirname, 'app/htmlreport.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    }) );\r\n}\r\n\r\n\r\n\r\n\r\n\r\nfunction openBugReport( event ) {\r\n\r\n    openForm( null, \"bugreport\", {  },   {\r\n      width: 540,\r\n      height: 600,\r\n      resizable: false\r\n\r\n    } );\r\n}\r\n\r\n\r\nfunction openMPPT( keithleyModel ) {\r\n\r\n    windows[ 'mppt' ] = new BrowserWindow({width: 1400, height: 1024, center: true, resizable: false })\r\n\r\n      // and load the index.html of the app.\r\n    windows[ 'mppt' ].loadURL(url.format({\r\n      pathname: path.join(__dirname, 'app/mppt.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    }));\r\n}\r\n\r\n\r\nasync function openCalibratePD( event, data ) {\r\n\r\n\r\n  //await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/light.pause?instrumentId=\" + data.instrumentId, { method: 'GET' } );\r\n  \r\n  openForm( null, \"calibratepd\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\r\n    width: 800,\r\n    height: 600,\r\n    resizable: false\r\n  });\r\n}\r\n\r\n\r\n\r\n\r\nasync function openScheduleLight( event, data ) {\r\n\r\n\r\n  //await fetch( \"http://\" + data.config.trackerHost + \":\" +   data.config.trackerPort + \"/light.pause?instrumentId=\" + data.instrumentId, { method: 'GET' } );\r\n  \r\n\r\n  // Once the light has been updated, send the information to the main window for update\r\n  let listener;\r\n  ipcMain.on(\"light.updated\", (  listener = () => {\r\n    windows[ \"instrumentMain\"].webContents.send( \"light.updated\" );\r\n  } ) );\r\n\r\n  openForm( null, \"scheduleLight\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\r\n    width: 800,\r\n    height: 600,\r\n    resizable: false\r\n  }, function() {\r\n\r\n    // After the window is closed, remove the listener\r\n    ipcMain.removeListener( \"light.updated\", listener );\r\n//  await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/light.resume?instrumentId=\" + data.instrumentId, { method: 'GET' } );\r\n\r\n  } );\r\n}\r\n\r\n\r\n\r\n\r\n// In this file you can include the rest of your app's specific main process\r\n// code. You can also put them in separate files and require them here.\r\n\r\nfunction removeInstrument( event, trackerHost ) {\r\n\r\n  dialog.showMessageBox( {\r\n    type: 'question',\r\n    message: 'Are you sure that you want to remove this instrument ?',\r\n    cancelId: 0,\r\n    defaultId: 0,\r\n    title: \"Remove the instrument\",\r\n    buttons: [ \"Cancel\", \"Yes\" ]    \r\n  }, ( index ) => {\r\n\r\n    if( index == 1 ) {\r\n\r\n      config.instruments.forEach( ( instrument, index ) => {\r\n\r\n        if( instrument.trackerHost == trackerHost ) {\r\n          config.instruments.splice( index, 1 );\r\n        }\r\n\r\n      } );\r\n\r\n      saveConfig();\r\n      reloadInstruments();\r\n    }\r\n\r\n  } );\r\n}\r\n\r\nfunction reportError( e ) {\r\n\r\n\r\n  dialog.showMessageBox( {\r\n    type: 'error',\r\n    message: 'An error has happened: ' + e.toString(),\r\n    cancelId: 0,\r\n    defaultId: 0,\r\n    title: \"Error\",\r\n    buttons: [ \"Ok\" ]    \r\n  }, ( index ) => {\r\n\r\n  } );\r\n}\r\n\r\nfunction reloadInstruments() {\r\n  windows[ 'instrumentList' ].webContents.send(\"reloadInstruments\");\r\n  doMenu();\r\n}\r\n\r\nfunction addInstrument() {\r\n\r\n  openForm( null, \"instrumentform\", {},   {\r\n    width: 850,\r\n    height: 800,\r\n    resizable: false\r\n\r\n  } ).then( ( result ) => {\r\n    \r\n    try {\r\n      config.instruments.push( result );\r\n      saveConfig();\r\n      reloadInstruments();\r\n    } catch( e ) {\r\n      reportError( e );\r\n    }\r\n\r\n\r\n  }).catch( () => {} );\r\n\r\n}\r\n\r\nfunction loadInstrument( event, trackerHost ) {\r\n\r\n  if( ! windows[ 'instrumentMain' ] ) {\r\n    // Create the browser window.\r\n    windows[ 'instrumentMain' ] = new BrowserWindow({width: 1400, height: 1024, center: true, resizable: false})\r\n\r\n      // and load the index.html of the app.\r\n    windows[ 'instrumentMain' ].loadURL(url.format({\r\n      pathname: path.join(__dirname, 'app/instrument.html'),\r\n      protocol: 'file:',\r\n      slashes: true\r\n    }));\r\n  }\r\n  \r\n  if( windows[ 'instrumentList' ] ) {\r\n    windows[ 'instrumentList' ].close();\r\n  }\r\n\r\n  let instrumentConfig;\r\n\r\n  config.instruments.forEach( ( instrument, index ) => {\r\n\r\n    if( instrument.trackerHost == trackerHost ) {\r\n      instrumentConfig = instrument;\r\n      currentInstrument = instrument;\r\n    }\r\n  });\r\n\r\n  // Global\r\n  \r\n\r\n\r\n  if( windows[ 'instrumentMain' ].webContents.isLoading() ) {\r\n\r\n    windows[ 'instrumentMain' ].webContents.once(\"dom-ready\", () => {  \r\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: instrumentConfig, db: config.database } );  \r\n    });\r\n    \r\n  } else {\r\n\r\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: instrumentConfig, db: config.database } );  \r\n  }\r\n  \r\n\r\n  windows[ 'instrumentMain' ].once(\"close\", () => {\r\n    windows[ 'instrumentMain' ] = null;\r\n  })\r\n\r\n}\r\n\r\nfunction editInstrument( event, trackerHost ) {\r\n\r\n  let data;\r\n\r\n  config.instruments.forEach( ( instrument, index ) => {\r\n\r\n    if( instrument.trackerHost == trackerHost ) {\r\n      data = instrument;\r\n    }\r\n\r\n  } );\r\n\r\n  if( ! data ) {\r\n    throw \"Could not find the data corresponding to this instrument\";\r\n  }\r\n\r\n  openForm( null, \"instrumentform\", data, {\r\n    width: 850,\r\n    height: 800,\r\n    resizable: false\r\n\r\n  }  ).then( ( results ) => {\r\n\r\n    Object.assign( data, results );\r\n    saveConfig();\r\n\r\n    if( windows[ 'instrumentMain' ] ) {\r\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: data, db: config.database } ); \r\n    }\r\n    \r\n    reloadInstruments();\r\n\r\n  } ).catch( () => {} );\r\n}\r\n\r\n\r\n\r\n\r\nfunction editInfluxDB( event ) {\r\n\r\n  let data;\r\n  let influxConfig = config.database;\r\n\r\n  openForm( null, \"influxdbform\", influxConfig, { width: 600, height: 700, resizable: false } ).then( ( results ) => {\r\n\r\n    config.database = results;\r\n    saveConfig();\r\n\r\n    updateInfluxDB();\r\n\r\n    if( windows[ 'instrumentMain' ] ) {\r\n      windows[ 'instrumentMain' ].webContents.send( \"reloadDB\", { db: config.database } ); \r\n    }\r\n    \r\n  } ).catch( () => {} );\r\n}\r\n\r\n\r\n\r\n\r\nfunction showAllMeasurements( instrument ) {\r\n  \r\n  openForm( null, \"showallmeasurements\", { config: instrument }, { width: 600, height: 700, resizable: false } ).then( ( results ) => {\r\n\r\n  } ).catch( () => {} );\r\n}\r\n\r\n\r\nfunction updateInfluxDB() {\r\n\r\n  config.instruments.forEach( ( instrument ) => {\r\n\r\n    request.post( {\r\n       url: \"http://\" + instrument.trackerHost + \":\" + instrument.trackerPort + \"/setInfluxDB\", \r\n       form: config.database }, function() {\r\n\r\n       } );\r\n  });\r\n}\r\n\r\n\r\nasync function configChannel( event, data ) {\r\n\r\n  let influxConfig = config.database;\r\n\r\n  var channelConfig = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getChannelConfig?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var instrumentConfig = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getInstrumentConfig?instrumentId=\" + data.instrumentId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var channelState = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  \r\n  //var externalConnection = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getChannelConfig?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var externalConnection = false;\r\n\r\n  return openForm( null, \"cellform\", { \r\n    instrumentConfig: instrumentConfig, \r\n    channelConfig: channelConfig, \r\n    channelState: channelState[ data.groupName ].channels[ data.chanId ],\r\n  }, { width: 600, height: 800 } ).then( ( results ) => {\r\n    console.log( results );\r\n    event.sender.send( \"channelConfigured\", results );\r\n    return results;    \r\n\r\n  } ).catch( () => {} );\r\n}\r\n\r\n\r\n\r\nasync function configChannels( event, data ) {\r\n\r\n  let influxConfig = config.database;\r\n\r\n  var channelsState = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var instrumentConfig = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getInstrumentConfig?instrumentId=\" + data.instrumentId, { method: 'GET' } ).then( ( response ) => response.json() );\r\n  var channelState = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanIds[ 0 ], { method: 'GET' } ).then( ( response ) => response.json() );\r\n  \r\n  return openForm( null, \"cellformall\", { \r\n\r\n    channelState: channelState[ data.groupName ].channels[ data.chanId ], \r\n    channelsState: channelsState[ data.groupName ].channels, \r\n    instrumentConfig: instrumentConfig,\r\n    channelIds: data.chanIds\r\n\r\n  }, { width: 600, height: 800 } ).then( ( results ) => {\r\n  \r\n    event.sender.send( \"channelsConfigured\", results );\r\n    return results;    \r\n    \r\n  } ).catch( () => {} );\r\n}\r\n\r\n\r\n\r\n\r\n\r\nlet windowForm;\r\n\r\nfunction openForm( windowName, pageName, formData, options = { width: 300, height: 420 }, onClose ) {\r\n\r\n  if( windowForm ) {\r\n    ( windowForm._rejecter && windowForm._rejecter() );\r\n    windowForm.close();\r\n  }\r\n  // Create the browser window.\r\n  windowForm = new BrowserWindow( options );\r\n\r\n  // and load the index.html of the app.\r\n  windowForm.loadURL( url.format({\r\n    pathname: path.join(__dirname, 'app/' + pageName + '.html'),\r\n    protocol: 'file:',\r\n    slashes: true\r\n  }) );\r\n\r\n  windows[ \"form\" ] = windowForm;\r\n\r\n  windowForm.once(\"closed\", () => {\r\n    windows[ \"form\" ] = null;\r\n    ( windowForm && windowForm._rejecter && windowForm._rejecter() );\r\n    windowForm = null;\r\n\r\n    if( typeof onClose == \"function\" ) {\r\n      onClose();\r\n    }\r\n\r\n  })\r\n  return new Promise( ( resolver, rejecter ) => {\r\n    \r\n    ipcMain.once(\"validateForm\", ( event, data ) => {\r\n\r\n      resolver( data );\r\n    });\r\n\r\n    ipcMain.once(\"closeForm\", ( event, data ) => {\r\n\r\n      if( windowForm ) {\r\n        windowForm.close();\r\n        windowForm = null;\r\n      }\r\n    });\r\n\r\n    windowForm.webContents.once(\"dom-ready\", () => {\r\n      windowForm.webContents.send(\"loadForm\", formData );\r\n    });\r\n     \r\n\r\n    windowForm._rejecter = rejecter;\r\n  });\r\n}\r\n"]}