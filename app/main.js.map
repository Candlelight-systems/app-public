{"version":3,"sources":["../source/main.js"],"names":["electron","require","Menu","ipcMain","dialog","app","BrowserWindow","path","url","fs","request","fix","fetch","environment","currentInstrument","configPath","join","__dirname","replace","config","JSON","parse","readFileSync","windows","on","addInstrument","editInstrument","removeInstrument","loadInstrument","editInfluxDB","updateInfluxDB","downloadData","htmlReport","editChannel","editChannels","openMPPT","openBugReport","openCalibratePD","openScheduleLight","makeInstrumentMenu","label","submenu","click","type","accelerator","selector","instruments","map","trackerName","checked","trackerHost","doMenu","ageing","push","unshift","getName","role","buildFromTemplate","setApplicationMenu","saveConfig","writeFileSync","stringify","createMainWindow","width","height","resizable","loadURL","format","pathname","protocol","slashes","platform","quit","openForm","measurementName","db","database","cellInfo","instrumentId","chanId","then","reloadInstruments","catch","webContents","send","x","y","center","removeListener","once","groupName","showMessageBox","message","cancelId","defaultId","title","buttons","forEach","splice","close","isLoading","tracker","Object","assign","post","trackerPort","form","method","json","cellData","channels","photodiodeRefs","sender","chanIds","allStatuses","channelIds","windowForm","_rejecter","Promise"],"mappings":"AAAA,KAAMA,UAAWC,QAAQ,UAAR,CAAjB,CACM,CAACC,IAAD,CAAMC,OAAN,CAAcC,MAAd,EAAwBH,QAAQ,UAAR,CAD9B,CAGMI,IAAML,SAASK,GAHrB,CAKMC,cAAgBN,SAASM,aAL/B,CAOMC,KAAON,QAAQ,MAAR,CAPb,CAQMO,IAAMP,QAAQ,KAAR,CARZ,CASMQ,GAAKR,QAAQ,IAAR,CATX,CAUMS,QAAUT,QAAQ,SAAR,CAVhB,CAWMU,IAAMV,QAAS,UAAT,CAXZ,CAYMW,MAAQX,QAAS,YAAT,CAZd,CAaMY,YAAcZ,QAAQ,oBAAR,CAbpB,CAeAU,K,CAEA,GAAIG,kBAAJ,CAEA,KAAMC,YAAaR,KAAKS,IAAL,CAAWC,UAAUC,OAAV,CAAkB,UAAlB,CAA8B,mBAA9B,CAAX,CAAgE,cAAhE,CAAnB,CACA,GAAIC,QAASC,KAAKC,KAAL,CAAYZ,GAAGa,YAAH,CAAiBP,UAAjB,CAAZ,CAAb,CAEIQ,UAFJ,CAIApB,QAAQqB,EAAR,CAAW,eAAX,CAA4BC,aAA5B,C,CACAtB,QAAQqB,EAAR,CAAW,gBAAX,CAA6BE,cAA7B,C,CACAvB,QAAQqB,EAAR,CAAW,kBAAX,CAA+BG,gBAA/B,C,CACAxB,QAAQqB,EAAR,CAAW,gBAAX,CAA6BI,cAA7B,C,CAEAzB,QAAQqB,EAAR,CAAW,cAAX,CAA2BK,YAA3B,C,CACA1B,QAAQqB,EAAR,CAAW,gBAAX,CAA6BM,cAA7B,C,CACA3B,QAAQqB,EAAR,CAAW,cAAX,CAA2BO,YAA3B,C,CACA5B,QAAQqB,EAAR,CAAW,YAAX,CAAyBQ,UAAzB,C,CAEA7B,QAAQqB,EAAR,CAAW,eAAX,CAA4BS,WAA5B,C,CACA9B,QAAQqB,EAAR,CAAW,gBAAX,CAA6BU,YAA7B,C,CACA/B,QAAQqB,EAAR,CAAW,MAAX,CAAmBW,QAAnB,C,CACAhC,QAAQqB,EAAR,CAAW,WAAX,CAAwBY,aAAxB,C,CACAjC,QAAQqB,EAAR,CAAW,aAAX,CAA0Ba,eAA1B,C,CACAlC,QAAQqB,EAAR,CAAW,eAAX,CAA4Bc,iBAA5B,C,CAKA,QAASC,mBAAT,EAA8B,CAC5B,MAAO,CACLC,MAAO,YADF,CAELC,QAAS,CACP,CAAED,MAAO,sBAAT,CAAiCE,OAAQ,CAAEjB,eAAkB,CAA7D,CADO,CAEP,CAAEe,MAAO,iBAAT,CAA4BE,OAAQ,CAAEhB,eAAgBZ,iBAAhB,CAAsC,CAA5E,CAFO,CAGP,CAAE0B,MAAO,sBAAT,CAAiCE,OAAQ,CAAEb,cAAkB,CAA7D,CAHO,CAIP,CAAEc,KAAM,WAAR,CAJO,CAKP,CAAEH,MAAO,KAAT,CAAgBI,YAAa,aAA7B,CAA4CC,SAAU,MAAtD,CALO,CAMP,CAAEL,MAAO,MAAT,CAAiBI,YAAa,aAA9B,CAA6CC,SAAU,OAAvD,CANO,CAOP,CAAEL,MAAO,OAAT,CAAkBI,YAAa,aAA/B,CAA8CC,SAAU,QAAxD,CAPO,CASP,GAAG1B,OAAO2B,WAAP,CAAmBC,GAAnB,CAAwB,KAAgB,CACzC,MAAO,CAAEP,MAAO,EAAWQ,WAApB,CAAiCC,QAASnC,mBAAqB,EAAWoC,WAA1E,CAAuFR,QAAe,CAAEd,iBAAuB,EAAWsB,WAAlC,CAAiD,CAAzJ,CACR,CAFE,CATI,CAFJ,CAgBR,CAID,QAASC,OAAT,EAAkB,CAEhB,KAAM,KAAN,CAGItC,YAAYuC,MALA,EAMd,EAASC,IAAT,CAAed,oBAAf,CANc,CAUd,EAASe,OAAT,CAAiB,CACfd,MAAOnC,IAAIkD,OAAJ,EADQ,CAEfd,QAAS,CACP,CAACe,KAAM,OAAP,CADO,CAEP,CAACb,KAAM,WAAP,CAFO,CAGP,CAACa,KAAM,UAAP,CAAmBf,UAAnB,CAHO,CAIP,CAACE,KAAM,WAAP,CAJO,CAKP,CAACa,KAAM,MAAP,CALO,CAMP,CAACA,KAAM,YAAP,CANO,CAOP,CAACA,KAAM,QAAP,CAPO,CAQP,CAACb,KAAM,WAAP,CARO,CASP,CAACa,KAAM,MAAP,CATO,CAFM,CAAjB,CAVc,CA0BZ,EAAU,CAAV,EAAcf,OAAd,CAAsBY,IAAtB,CAA4B,CAACG,KAAM,gBAAP,CAA5B,CA1BY,CA8BhB,KAAM,GAAOtD,KAAKuD,iBAAL,GAAb,CACAvD,KAAKwD,kBAAL,GACD,CAID,QAASC,WAAT,EAAuB,CACrBlD,GAAGmD,aAAH,CAAkB7C,UAAlB,CAA8BK,KAAKyC,SAAL,CAAgB1C,MAAhB,QAAmC,IAAnC,CAA9B,CACD,CAKD,QAAS2C,iBAAT,EAA4B,CAE1BvC,uBAA8B,GAAIjB,cAAJ,CAAkB,CAAEyD,MAAO,GAAT,CAAcC,OAAQ,GAAtB,CAA2BC,YAA3B,CAAlB,CAFJ,CAK1B1C,uBAA4B2C,OAA5B,CAAoC1D,IAAI2D,MAAJ,CAAW,CAC7CC,SAAU7D,KAAKS,IAAL,CAAUC,SAAV,CAAqB,yBAArB,CADmC,CAE7CoD,SAAU,OAFmC,CAG7CC,UAH6C,CAAX,CAApC,CAL0B,CAe1B/C,uBAA4BC,EAA5B,CAA+B,QAA/B,CAAyC,UAAY,CAInDD,uBAA8B,IAC/B,CALD,CAf0B,CAsB1B4B,QACD,CAKD9C,IAAImB,EAAJ,CAAO,OAAP,CAAgBsC,gBAAhB,C,CAGAzD,IAAImB,EAAJ,CAAO,mBAAP,CAA4B,UAAY,CAGb,QAArB,WAAQ+C,QAH0B,EAIpClE,IAAImE,IAAJ,EAEH,CAND,C,CAQAnE,IAAImB,EAAJ,CAAO,UAAP,CAAmB,UAAY,CAGO,IAAhC,yBAHyB,EAI3BsC,kBAEH,CAND,C,CAQA,QAAS/B,aAAT,WAAgF,CAE5E0C,SAAU,IAAV,CAAgB,cAAhB,CAAgC,CAAEC,iBAAF,CAAoCC,GAAIxD,OAAOyD,QAA/C,CAAyDC,UAAzD,CAA6EC,cAA7E,CAAyGC,QAAzG,CAAhC,CAA6J,CAC3JhB,MAAO,GADoJ,CAE3JC,OAAQ,GAFmJ,CAG3JC,YAH2J,CAA7J,EAKIe,IALJ,CAKU,KAAc,CAEtB7D,OAAO2B,WAAP,CAAmBO,IAAnB,GAFsB,CAGtBM,YAHsB,CAItBsB,mBAED,CAXD,EAWGC,KAXH,CAWU,IAAM,CAAE,CAXlB,CAYH,CAID,QAASlD,WAAT,WAA8E,CAE1E,GAAI,EAAJ,CAAoB,CAApB,CAEA7B,QAAQqB,EAAR,CAAW,mBAAX,CAAkC,EAAiB,OAAmB,CAE9DD,kBAF8D,EAMpEA,mBAAuB4D,WAAvB,CAAmCC,IAAnC,CAAyC,QAAzC,GACD,CAPD,CAJ0E,CAa1EjF,QAAQqB,EAAR,CAAW,oBAAX,CAAmC,EAAkB,OAAmB,CAEhED,kBAFgE,EAMtEA,mBAAuB4D,WAAvB,CAAmCC,IAAnC,CAAyC,SAAzC,GACD,CAPD,CAb0E,CAsB1EX,SAAU,IAAV,CAAgB,oBAAhB,CAAsC,CAAEC,iBAAF,CAAoCC,GAAIxD,OAAOyD,QAA/C,CAAyDC,UAAzD,CAA6EC,cAA7E,CAAyGC,QAAzG,CAAtC,CAAmK,CACjKhB,MAAO,GAD0J,CAEjKC,OAAQ,GAFyJ,CAGjKqB,EAAG,EAH8J,CAIjKC,EAAG,GAJ8J,CAKjKC,SALiK,CAMjKtB,YANiK,CAAnK,CAOG,IAAM,CAEL9D,QAAQqF,cAAR,CAAwB,mBAAxB,GAFK,CAGLrF,QAAQqF,cAAR,CAAwB,oBAAxB,GACH,CAXD,CAtB0E,CAmC1EjE,mBAA0B,GAAIjB,cAAJ,CAAmB,CAC3CyD,MAAO,GADoC,CAE3CC,OAAQ,GAFmC,CAG3CqB,EAAG,GAHwC,CAI3CC,EAAG,GAJwC,CAK3CC,SAL2C,CAM3CtB,YAN2C,CAAnB,CAnCgD,CA6C1E1C,mBAAwB4D,WAAxB,CAAoCM,IAApC,CAAyC,WAAzC,CAAsD,IAAM,CAC1DlE,mBAAwB4D,WAAxB,CAAoCC,IAApC,CAAyC,UAAzC,CAAqD,CAAEV,iBAAF,CAAoCC,GAAIxD,OAAOyD,QAA/C,CAAyDC,UAAzD,CAA6EC,cAA7E,CAAyGC,QAAzG,CAArD,CACD,CAFD,CA7C0E,CAiD1ExD,mBAAwB2C,OAAxB,CAAiC1D,IAAI2D,MAAJ,CAAW,CAC1CC,SAAU7D,KAAKS,IAAL,CAAUC,SAAV,CAAqB,qBAArB,CADgC,CAE1CoD,SAAU,OAFgC,CAG1CC,UAH0C,CAAX,CAAjC,CAKH,CAMD,QAASlC,cAAT,EAAgC,CAE5BqC,SAAU,IAAV,CAAgB,WAAhB,IAAqC,CACnCV,MAAO,GAD4B,CAEnCC,OAAQ,GAF2B,CAGnCC,YAHmC,CAArC,CAMH,CAGD,QAAS9B,SAAT,EAAmC,CAE/BZ,aAAoB,GAAIjB,cAAJ,CAAkB,CAACyD,MAAO,IAAR,CAAcC,OAAQ,IAAtB,CAA4BuB,SAA5B,CAA0CtB,YAA1C,CAAlB,CAFW,CAK/B1C,aAAkB2C,OAAlB,CAA0B1D,IAAI2D,MAAJ,CAAW,CACnCC,SAAU7D,KAAKS,IAAL,CAAUC,SAAV,CAAqB,eAArB,CADyB,CAEnCoD,SAAU,OAFyB,CAGnCC,UAHmC,CAAX,CAA1B,CAKH,CAGD,cAAejC,gBAAf,KAA8C,CAK5CoC,SAAU,IAAV,CAAgB,aAAhB,CAA+B,CAAEK,aAAc,EAAKA,YAArB,CAAmCY,UAAW,EAAKA,SAAnD,CAA8DvE,OAAQ,EAAKA,MAA3E,CAA/B,CAAoH,CAClH4C,MAAO,GAD2G,CAElHC,OAAQ,GAF0G,CAGlHC,YAHkH,CAApH,CAKD,CAKD,cAAe3B,kBAAf,KAAgD,CAO9C,GAAI,EAAJ,CACAnC,QAAQqB,EAAR,CAAW,eAAX,CAA+B,EAAW,IAAM,CAC9CD,uBAA2B4D,WAA3B,CAAuCC,IAAvC,CAA6C,eAA7C,CACD,CAFD,CAR8C,CAY9CX,SAAU,IAAV,CAAgB,eAAhB,CAAiC,CAAEK,aAAc,EAAKA,YAArB,CAAmCY,UAAW,EAAKA,SAAnD,CAA8DvE,OAAQ,EAAKA,MAA3E,CAAjC,CAAsH,CACpH4C,MAAO,GAD6G,CAEpHC,OAAQ,GAF4G,CAGpHC,YAHoH,CAAtH,CAIG,UAAW,CAGZ9D,QAAQqF,cAAR,CAAwB,eAAxB,GAGD,CAVD,CAWD,CAQD,QAAS7D,iBAAT,KAAgD,CAE9CvB,OAAOuF,cAAP,CAAuB,CACrBhD,KAAM,UADe,CAErBiD,QAAS,wDAFY,CAGrBC,SAAU,CAHW,CAIrBC,UAAW,CAJU,CAKrBC,MAAO,uBALc,CAMrBC,wBANqB,CAAvB,CAOG,KAAa,CAED,CAAT,GAFU,GAIZ7E,OAAO2B,WAAP,CAAmBmD,OAAnB,CAA4B,OAAyB,CAE/C,EAAW/C,WAAX,GAF+C,EAGjD/B,OAAO2B,WAAP,CAAmBoD,MAAnB,GAAkC,CAAlC,CAGH,CAND,CAJY,CAYZvC,YAZY,CAaZsB,mBAbY,CAgBf,CAvBD,CAwBD,CAED,QAASA,kBAAT,EAA6B,CAC3B1D,uBAA4B4D,WAA5B,CAAwCC,IAAxC,CAA6C,mBAA7C,CAD2B,CAE3BjC,QACD,CAED,QAAS1B,cAAT,EAAyB,CAEvBgD,SAAU,IAAV,CAAgB,gBAAhB,IAAwC,CACtCV,MAAO,GAD+B,CAEtCC,OAAQ,GAF8B,CAGtCC,YAHsC,CAAxC,EAKIe,IALJ,CAKU,KAAc,CAEtB7D,OAAO2B,WAAP,CAAmBO,IAAnB,GAFsB,CAGtBM,YAHsB,CAItBsB,mBACD,CAVD,EAUGC,KAVH,CAUU,IAAM,CAAE,CAVlB,CAYD,CAED,QAAStD,eAAT,KAA8C,CAEtCL,sBAFsC,GAI1CA,uBAA8B,GAAIjB,cAAJ,CAAkB,CAACyD,MAAO,IAAR,CAAcC,OAAQ,IAAtB,CAA4BuB,SAA5B,CAA0CtB,YAA1C,CAAlB,CAJY,CAO1C1C,uBAA4B2C,OAA5B,CAAoC1D,IAAI2D,MAAJ,CAAW,CAC7CC,SAAU7D,KAAKS,IAAL,CAAUC,SAAV,CAAqB,qBAArB,CADmC,CAE7CoD,SAAU,OAFmC,CAG7CC,UAH6C,CAAX,CAApC,CAP0C,EAcxC/C,sBAdwC,EAe1CA,uBAA4B4E,KAA5B,EAf0C,CAkB5C,GAAI,EAAJ,CAEAhF,OAAO2B,WAAP,CAAmBmD,OAAnB,CAA4B,KAAyB,CAE/C,EAAW/C,WAAX,GAF+C,GAGjD,GAHiD,CAIjDpC,mBAJiD,CAMpD,CAND,CApB4C,CAgCxCS,uBAA4B4D,WAA5B,CAAwCiB,SAAxC,EAhCwC,CAkC1C7E,uBAA4B4D,WAA5B,CAAwCM,IAAxC,CAA6C,WAA7C,CAA0D,IAAM,CAC9DlE,uBAA4B4D,WAA5B,CAAwCC,IAAxC,CAA8C,gBAA9C,CAAgE,CAAEiB,SAAF,CAA6B1B,GAAIxD,OAAOyD,QAAxC,CAAhE,CACD,CAFD,CAlC0C,CAwCxCrD,uBAA4B4D,WAA5B,CAAwCC,IAAxC,CAA8C,gBAA9C,CAAgE,CAAEiB,SAAF,CAA6B1B,GAAIxD,OAAOyD,QAAxC,CAAhE,CAxCwC,CA4C5CrD,uBAA4BkE,IAA5B,CAAiC,OAAjC,CAA0C,IAAM,CAC9ClE,uBAA8B,IAC/B,CAFD,CAID,CAED,QAASG,eAAT,KAA8C,CAE5C,GAAI,EAAJ,CAUA,GARAP,OAAO2B,WAAP,CAAmBmD,OAAnB,CAA4B,KAAyB,CAE/C,EAAW/C,WAAX,GAF+C,GAGjD,GAHiD,CAMpD,CAND,CAQA,CAAI,EAAJ,CACE,KAAM,0DAAN,CAGFuB,SAAU,IAAV,CAAgB,gBAAhB,GAAwC,CACtCV,MAAO,GAD+B,CAEtCC,OAAQ,GAF8B,CAGtCC,YAHsC,CAAxC,EAKKe,IALL,CAKW,KAAe,CAExBsB,OAAOC,MAAP,KAFwB,CAGxB5C,YAHwB,CAKpBpC,sBALoB,EAMtBA,uBAA4B4D,WAA5B,CAAwCC,IAAxC,CAA8C,gBAA9C,CAAgE,CAAEiB,SAAF,CAAiB1B,GAAIxD,OAAOyD,QAA5B,CAAhE,CANsB,CASxBK,mBAED,CAhBD,EAgBIC,KAhBJ,CAgBW,IAAM,CAAE,CAhBnB,CAiBD,CAKD,QAASrD,aAAT,EAA+B,CAE7B,GACI,GAAeV,OAAOyD,QAD1B,CAGAH,SAAU,IAAV,CAAgB,cAAhB,GAA8C,CAAEV,MAAO,GAAT,CAAcC,OAAQ,GAAtB,CAA2BC,YAA3B,CAA9C,EAA8Fe,IAA9F,CAAoG,KAAe,CAEjH7D,OAAOyD,QAAP,EAFiH,CAGjHjB,YAHiH,CAKjH7B,gBALiH,CAO7GP,sBAP6G,EAQ/GA,uBAA4B4D,WAA5B,CAAwCC,IAAxC,CAA8C,UAA9C,CAA0D,CAAET,GAAIxD,OAAOyD,QAAb,CAA1D,CAGH,CAXD,EAWIM,KAXJ,CAWW,IAAM,CAAE,CAXnB,CAYD,CAGD,QAASpD,eAAT,EAA0B,CAExBX,OAAO2B,WAAP,CAAmBmD,OAAnB,CAA4B,KAAkB,CAE5CvF,QAAQ8F,IAAR,CAAc,CACXhG,IAAK,UAAY,EAAW0C,WAAvB,CAAqC,GAArC,CAA2C,EAAWuD,WAAtD,CAAoE,cAD9D,CAEXC,KAAMvF,OAAOyD,QAFF,CAAd,CAE4B,UAAW,CAEnC,CAJJ,CAKD,CAPD,CAQD,CAGD,cAAe3C,YAAf,KAA2C,CAEtBd,OAAOyD,QAFe,CAIzC,GAAI,GAAW,KAAMhE,OAAO,UAAY,EAAKsC,WAAjB,CAA+B,GAA/B,CAAqC,EAAKuD,WAA1C,CAAwD,0BAAxD,CAAqF,EAAK3B,YAA1F,CAAyG,UAAzG,CAAsH,EAAKC,MAAlI,CAA0I,CAAE4B,OAAQ,KAAV,CAA1I,EAA8J3B,IAA9J,CAAoK,KAAgB,EAAS4B,IAAT,EAApL,CAArB,CACI,EAAiB,KAAMhG,OAAO,UAAY,EAAKsC,WAAjB,CAA+B,GAA/B,CAAqC,EAAKuD,WAA1C,CAAwD,6BAAxD,CAAwF,EAAK3B,YAA7F,CAA4G,aAA5G,CAA4H,EAAKY,SAAxI,CAAmJ,CAAEiB,OAAQ,KAAV,CAAnJ,EAAuK3B,IAAvK,CAA6K,KAAgB,EAAS4B,IAAT,EAA7L,CAD3B,CAGA,MAAOnC,UAAU,IAAV,CAAgB,UAAhB,CAA4B,CAAEoC,SAAU,EAAU,EAAKnB,SAAf,EAA2BoB,QAA3B,CAAqC,EAAK/B,MAA1C,CAAZ,CAAgEgC,gBAAhE,CAA5B,CAA8H,CAAEhD,MAAO,GAAT,CAAcC,OAAQ,GAAtB,CAA9H,EAA4JgB,IAA5J,CAAkK,KAAe,CAItL,MAFA,GAAMgC,MAAN,CAAa5B,IAAb,CAAmB,mBAAnB,GAEA,EACD,CALM,EAKHF,KALG,CAKI,IAAM,CAAE,CALZ,CAMR,CAID,cAAehD,aAAf,KAA2C,CAEtBf,OAAOyD,QAFe,CAIzC,GAAI,GAAW,KAAMhE,OAAO,UAAY,EAAKsC,WAAjB,CAA+B,GAA/B,CAAqC,EAAKuD,WAA1C,CAAwD,0BAAxD,CAAqF,EAAK3B,YAA1F,CAAyG,UAAzG,CAAsH,EAAKmC,OAAL,CAAc,CAAd,CAA7H,CAAgJ,CAAEN,OAAQ,KAAV,CAAhJ,EAAoK3B,IAApK,CAA0K,KAAgB,EAAS4B,IAAT,EAA1L,EAA4M5B,IAA5M,CAAkN,KAAU,CAAE,MAAO,GAAI,EAAKU,SAAT,EAAqBoB,QAArB,CAA+B,EAAKG,OAAL,CAAc,CAAd,CAA/B,CAAoD,CAAzR,CAArB,CACI,EAAe,KAAMrG,OAAO,UAAY,EAAKsC,WAAjB,CAA+B,GAA/B,CAAqC,EAAKuD,WAA1C,CAAwD,0BAAxD,CAAqF,EAAK3B,YAA1F,CAAyG,aAAzG,CAAyH,EAAKY,SAArI,CAAgJ,CAAEiB,OAAQ,KAAV,CAAhJ,EAAoK3B,IAApK,CAA0K,KAAgB,EAAS4B,IAAT,EAA1L,CADzB,CAEI,EAAiB,KAAMhG,OAAO,UAAY,EAAKsC,WAAjB,CAA+B,GAA/B,CAAqC,EAAKuD,WAA1C,CAAwD,6BAAxD,CAAwF,EAAK3B,YAA7F,CAA4G,aAA5G,CAA4H,EAAKY,SAAxI,CAAmJ,CAAEiB,OAAQ,KAAV,CAAnJ,EAAuK3B,IAAvK,CAA6K,KAAgB,EAAS4B,IAAT,EAA7L,CAF3B,CAIA,MAAOnC,UAAU,IAAV,CAAgB,aAAhB,CAA+B,CAEpCoC,UAFoC,CAGpCK,YAAa,EAAc,EAAKxB,SAAnB,EAA+BoB,QAHR,CAIpCC,gBAJoC,CAKpCI,WAAY,EAAKF,OALmB,CAA/B,CAOJ,CAAElD,MAAO,GAAT,CAAcC,OAAQ,GAAtB,CAPI,EAO0BgB,IAP1B,CAOgC,KAAe,CAGpD,MADA,GAAMgC,MAAN,CAAa5B,IAAb,CAAmB,oBAAnB,GACA,EAED,CAZM,EAYHF,KAZG,CAYI,IAAM,CAAE,CAZZ,CAaR,CAID,GAAIkC,WAAJ,CAEA,QAAS3C,SAAT,OAAmD,EAAU,CAAEV,MAAO,GAAT,CAAcC,OAAQ,GAAtB,CAA7D,GAAoG,CA4BlG,MA1BIoD,WA0BJ,GAzBIA,WAAWC,SAAX,EAAwBD,WAAWC,SAAX,EAyB5B,CAxBED,WAAWjB,KAAX,EAwBF,EArBAiB,WAAa,GAAI9G,cAAJ,GAqBb,CAlBA8G,WAAWlD,OAAX,CAAoB1D,IAAI2D,MAAJ,CAAW,CAC7BC,SAAU7D,KAAKS,IAAL,CAAUC,SAAV,CAAqB,SAAoB,OAAzC,CADmB,CAE7BoD,SAAU,OAFmB,CAG7BC,UAH6B,CAAX,CAApB,CAkBA,CAZA/C,aAAoB6F,UAYpB,CAVAA,WAAW3B,IAAX,CAAgB,QAAhB,CAA0B,IAAM,CAC9BlE,aAAoB,IADU,CAE5B6F,YAAcA,WAAWC,SAAzB,EAAsCD,WAAWC,SAAX,EAFV,CAG9BD,WAAa,IAHiB,CAKR,UAAlB,UAL0B,EAM5B,GAGH,CATD,CAUA,CAAO,GAAIE,QAAJ,CAAa,OAA0B,CAE5CnH,QAAQsF,IAAR,CAAa,cAAb,CAA6B,OAAmB,CAE9C,IACD,CAHD,CAF4C,CAO5CtF,QAAQsF,IAAR,CAAa,WAAb,CAA0B,IAAmB,CAEvC2B,UAFuC,GAGzCA,WAAWjB,KAAX,EAHyC,CAIzCiB,WAAa,IAJ4B,CAM5C,CAND,CAP4C,CAe5CA,WAAWjC,WAAX,CAAuBM,IAAvB,CAA4B,WAA5B,CAAyC,IAAM,CAC7C2B,WAAWjC,WAAX,CAAuBC,IAAvB,CAA4B,UAA5B,GACD,CAFD,CAf4C,CAoB5CgC,WAAWC,SAAX,EACD,CArBM,CAsBR","file":"main.js","sourcesContent":["const electron = require('electron')\nconst {Menu,ipcMain,dialog} = require('electron')\n// Module to control application life.\nconst app = electron.app\n// Module to create native browser window.\nconst BrowserWindow = electron.BrowserWindow\n\nconst path = require('path')\nconst url = require('url')\nconst fs = require('fs');\nconst request = require('request');\nconst fix = require( 'fix-path' );\nconst fetch = require( 'node-fetch' );\nconst environment = require(\"./environment.json\");\n\nfix();\n\nlet currentInstrument;\n\nconst configPath = path.join( __dirname.replace(\"app.asar\", \"app.asar.unpacked\" ), '/config.json' );\nlet config = JSON.parse( fs.readFileSync( configPath ) );\n\nlet windows = {};\n\nipcMain.on(\"addInstrument\", addInstrument );\nipcMain.on(\"editInstrument\", editInstrument );\nipcMain.on(\"removeInstrument\", removeInstrument );\nipcMain.on(\"loadInstrument\", loadInstrument );\n\nipcMain.on(\"editInfluxDB\", editInfluxDB );\nipcMain.on(\"updateInfluxDB\", updateInfluxDB );\nipcMain.on(\"downloadData\", downloadData );\nipcMain.on(\"htmlReport\", htmlReport );\n\nipcMain.on(\"configChannel\", editChannel );\nipcMain.on(\"configChannels\", editChannels );\nipcMain.on(\"mppt\", openMPPT );\nipcMain.on(\"bugReport\", openBugReport );\nipcMain.on(\"calibratePD\", openCalibratePD );\nipcMain.on(\"scheduleLight\", openScheduleLight );\n\n\n\n\nfunction makeInstrumentMenu() {\n  return {\n    label: 'Instrument',\n    submenu: [\n      { label: 'Add a new instrument', click() { addInstrument(); } },\n      { label: 'Edit instrument', click() { editInstrument( currentInstrument ); } },\n      { label: 'Edit database config', click() { editInfluxDB( ); } },\n      { type: 'separator' },\n      { label: \"Cut\", accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" },\n      { label: \"Copy\", accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" },\n      { label: \"Paste\", accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" },\n\n      ...config.instruments.map( (instrument) => {\n        return { label: instrument.trackerName, checked: currentInstrument == instrument.trackerHost, click( event ) { loadInstrument( event, instrument.trackerHost ) } }\n      } )\n    ]\n  };\n}\n\n\n\nfunction doMenu() {\n  //require(\"./menu\");\n  const template = [\n  ];\n\n  if( environment.ageing ) {\n    template.push( makeInstrumentMenu() );\n  }\n\n  //if (process.platform === 'darwin') {\n    template.unshift({\n      label: app.getName(),\n      submenu: [\n        {role: 'about'},\n        {type: 'separator'},\n        {role: 'services', submenu: []},\n        {type: 'separator'},\n        {role: 'hide'},\n        {role: 'hideothers'},\n        {role: 'unhide'},\n        {type: 'separator'},\n        {role: 'quit'},\n      ]\n    });\n\n    if( process.env.NODE_ENV == 'development' ) {\n      template[ 0 ].submenu.push( {role: 'toggledevtools'} )\n    }\n  //}\n\n  const menu = Menu.buildFromTemplate(template);\n  Menu.setApplicationMenu(menu);\n}\n\n\n\nfunction saveConfig( ) {\n  fs.writeFileSync( configPath, JSON.stringify( config, undefined, \"\\t\" ) ); \n}\n\n// Keep a global reference of the window object, if you don't, the window will\n// be closed automatically when the JavaScript object is garbage collected.\n\nfunction createMainWindow() {\n  // Create the browser window.\n  windows[ 'instrumentList' ] = new BrowserWindow({ width: 800, height: 700, resizable: false })\n\n  // and load the index.html of the app.\n  windows[ 'instrumentList' ].loadURL(url.format({\n    pathname: path.join(__dirname, 'app/instrumentlist.html'),\n    protocol: 'file:',\n    slashes: true\n  }))\n\n  // Open the DevTools.\n  // windows[ 'instrumentList' ].webContents.openDevTools()\n\n  // Emitted when the window is closed.\n  windows[ 'instrumentList' ].on('closed', function () {\n    // Dereference the window object, usually you would store windows\n    // in an array if your app supports multi windows, this is the time\n    // when you should delete the corresponding element.\n    windows[ 'instrumentList' ] = null\n  });\n\n  doMenu();\n}\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', createMainWindow )\n\n// Quit when all windows are closed.\napp.on('window-all-closed', function () {\n  // On OS X it is common for applications and their menu bar\n  // to stay active until the user quits explicitly with Cmd + Q\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n\napp.on('activate', function () {\n  // On OS X it's common to re-create a window in the app when the\n  // dock icon is clicked and there are no other windows open.\n  if (windows[ 'instrumentList' ] === null) {\n    createMainWindow()\n  }\n})\n\nfunction downloadData( event, cellInfo, instrumentId, chanId, measurementName ) {\n\n    openForm( null, \"downloadform\", { measurementName: measurementName, db: config.database, cellInfo: cellInfo, instrumentId: instrumentId, chanId: chanId },   {\n      width: 850,\n      height: 800,\n      resizable: false\n\n    } ).then( ( result ) => {\n    \n      config.instruments.push( result );\n      saveConfig();\n      reloadInstruments();\n\n    }).catch( () => {} );\n}\n\n\n\nfunction htmlReport( event, cellInfo, instrumentId, chanId, measurementName ) {\n\n    let listenerConfig, listenerSavePDF;\n\n    ipcMain.on(\"htmlReport.config\", ( listenerConfig = ( event, data ) => {\n      \n      if( ! windows[ 'htmlReport' ] ) {\n        return;\n      }\n\n      windows[ \"htmlReport\"].webContents.send( \"config\", data );\n    } ) );\n\n    ipcMain.on(\"htmlReport.savePDF\", ( listenerSavePDF = ( event, data ) => {\n      \n      if( ! windows[ 'htmlReport' ] ) {\n        return;\n      }\n\n      windows[ \"htmlReport\"].webContents.send( \"savePDF\", data );\n    } ) );\n\n    openForm( null, \"htmlreport_control\", { measurementName: measurementName, db: config.database, cellInfo: cellInfo, instrumentId: instrumentId, chanId: chanId },   {\n      width: 400,\n      height: 595,\n      x: 50,\n      y: 100,\n      center: false,\n      resizable: false\n    }, () => {\n\n        ipcMain.removeListener( \"htmlReport.config\", listenerConfig );\n        ipcMain.removeListener( \"htmlReport.savePDF\", listenerSavePDF );\n    } );\n\n    windows[ 'htmlReport' ] = new BrowserWindow( {\n      width: 822, \n      height: 595, \n      x: 500, \n      y: 100, \n      center: false,\n      resizable: false\n    } )\n  \n\n    windows[ 'htmlReport' ].webContents.once(\"dom-ready\", () => {\n      windows[ 'htmlReport' ].webContents.send(\"loadData\", { measurementName: measurementName, db: config.database, cellInfo: cellInfo, instrumentId: instrumentId, chanId: chanId } );\n    });     \n      // and load the index.html of the app.\n    windows[ 'htmlReport' ].loadURL( url.format({\n      pathname: path.join(__dirname, 'app/htmlreport.html'),\n      protocol: 'file:',\n      slashes: true\n    }) );\n}\n\n\n\n\n\nfunction openBugReport( event ) {\n\n    openForm( null, \"bugreport\", {  },   {\n      width: 540,\n      height: 600,\n      resizable: false\n\n    } );\n}\n\n\nfunction openMPPT( keithleyModel ) {\n\n    windows[ 'mppt' ] = new BrowserWindow({width: 1400, height: 1024, center: true, resizable: false })\n\n      // and load the index.html of the app.\n    windows[ 'mppt' ].loadURL(url.format({\n      pathname: path.join(__dirname, 'app/mppt.html'),\n      protocol: 'file:',\n      slashes: true\n    }));\n}\n\n\nasync function openCalibratePD( event, data ) {\n\n\n  //await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/light.pause?instrumentId=\" + data.instrumentId, { method: 'GET' } );\n  \n  openForm( null, \"calibratePD\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\n    width: 800,\n    height: 600,\n    resizable: false\n  });\n}\n\n\n\n\nasync function openScheduleLight( event, data ) {\n\n\n  //await fetch( \"http://\" + data.config.trackerHost + \":\" +   data.config.trackerPort + \"/light.pause?instrumentId=\" + data.instrumentId, { method: 'GET' } );\n  \n\n  // Once the light has been updated, send the information to the main window for update\n  let listener;\n  ipcMain.on(\"light.updated\", (  listener = () => {\n    windows[ \"instrumentMain\"].webContents.send( \"light.updated\" );\n  } ) );\n\n  openForm( null, \"scheduleLight\", { instrumentId: data.instrumentId, groupName: data.groupName, config: data.config }, {\n    width: 800,\n    height: 600,\n    resizable: false\n  }, function() {\n\n    // After the window is closed, remove the listener\n    ipcMain.removeListener( \"light.updated\", listener );\n//  await fetch( \"http://\" + data.config.trackerHost + \":\" + data.config.trackerPort + \"/light.resume?instrumentId=\" + data.instrumentId, { method: 'GET' } );\n\n  } );\n}\n\n\n\n\n// In this file you can include the rest of your app's specific main process\n// code. You can also put them in separate files and require them here.\n\nfunction removeInstrument( event, trackerHost ) {\n\n  dialog.showMessageBox( {\n    type: 'question',\n    message: 'Are you sure that you want to remove this instrument ?',\n    cancelId: 0,\n    defaultId: 0,\n    title: \"Remove the instrument\",\n    buttons: [ \"Cancel\", \"Yes\" ]    \n  }, ( index ) => {\n\n    if( index == 1 ) {\n\n      config.instruments.forEach( ( instrument, index ) => {\n\n        if( instrument.trackerHost == trackerHost ) {\n          config.instruments.splice( index, 1 );\n        }\n\n      } );\n\n      saveConfig();\n      reloadInstruments();\n    }\n\n  } );\n}\n\nfunction reloadInstruments() {\n  windows[ 'instrumentList' ].webContents.send(\"reloadInstruments\");\n  doMenu();\n}\n\nfunction addInstrument() {\n\n  openForm( null, \"instrumentform\", {},   {\n    width: 850,\n    height: 800,\n    resizable: false\n\n  } ).then( ( result ) => {\n  \n    config.instruments.push( result );\n    saveConfig();\n    reloadInstruments();\n  }).catch( () => {} );\n\n}\n\nfunction loadInstrument( event, trackerHost ) {\n\n  if( ! windows[ 'instrumentMain' ] ) {\n    // Create the browser window.\n    windows[ 'instrumentMain' ] = new BrowserWindow({width: 1400, height: 1024, center: true, resizable: false})\n\n      // and load the index.html of the app.\n    windows[ 'instrumentMain' ].loadURL(url.format({\n      pathname: path.join(__dirname, 'app/instrument.html'),\n      protocol: 'file:',\n      slashes: true\n    }));\n  }\n  \n  if( windows[ 'instrumentList' ] ) {\n    windows[ 'instrumentList' ].close();\n  }\n\n  let instrumentConfig;\n\n  config.instruments.forEach( ( instrument, index ) => {\n\n    if( instrument.trackerHost == trackerHost ) {\n      instrumentConfig = instrument;\n      currentInstrument = instrument;\n    }\n  });\n\n  // Global\n  \n\n\n  if( windows[ 'instrumentMain' ].webContents.isLoading() ) {\n\n    windows[ 'instrumentMain' ].webContents.once(\"dom-ready\", () => {  \n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: instrumentConfig, db: config.database } );  \n    });\n    \n  } else {\n\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: instrumentConfig, db: config.database } );  \n  }\n  \n\n  windows[ 'instrumentMain' ].once(\"close\", () => {\n    windows[ 'instrumentMain' ] = null;\n  })\n\n}\n\nfunction editInstrument( event, trackerHost ) {\n\n  let data;\n\n  config.instruments.forEach( ( instrument, index ) => {\n\n    if( instrument.trackerHost == trackerHost ) {\n      data = instrument;\n    }\n\n  } );\n\n  if( ! data ) {\n    throw \"Could not find the data corresponding to this instrument\";\n  }\n\n  openForm( null, \"instrumentform\", data, {\n    width: 850,\n    height: 800,\n    resizable: false\n\n  }  ).then( ( results ) => {\n\n    Object.assign( data, results );\n    saveConfig();\n\n    if( windows[ 'instrumentMain' ] ) {\n      windows[ 'instrumentMain' ].webContents.send( \"loadInstrument\", { tracker: data, db: config.database } ); \n    }\n    \n    reloadInstruments();\n\n  } ).catch( () => {} );\n}\n\n\n\n\nfunction editInfluxDB( event ) {\n\n  let data;\n  let influxConfig = config.database;\n\n  openForm( null, \"influxdbform\", influxConfig, { width: 600, height: 700, resizable: false } ).then( ( results ) => {\n\n    config.database = results;\n    saveConfig();\n\n    updateInfluxDB();\n\n    if( windows[ 'instrumentMain' ] ) {\n      windows[ 'instrumentMain' ].webContents.send( \"reloadDB\", { db: config.database } ); \n    }\n    \n  } ).catch( () => {} );\n}\n\n\nfunction updateInfluxDB() {\n\n  config.instruments.forEach( ( instrument ) => {\n\n    request.post( {\n       url: \"http://\" + instrument.trackerHost + \":\" + instrument.trackerPort + \"/setInfluxDB\", \n       form: config.database }, function() {\n\n       } );\n  });\n}\n\n\nasync function editChannel ( event, data ) {\n\n  let influxConfig = config.database;\n\n  var cellData = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanId, { method: 'GET' } ).then( ( response ) => response.json() );\n  var photodiodeRefs = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getPDOptions?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\n\n  return openForm( null, \"cellform\", { cellData: cellData[ data.groupName ].channels[ data.chanId ], photodiodeRefs: photodiodeRefs }, { width: 600, height: 800 } ).then( ( results ) => {\n  \n    event.sender.send( \"channelConfigured\", results );\n\n    return results;    \n  } ).catch( () => {} );\n}\n\n\n\nasync function editChannels( event, data ) {\n\n  let influxConfig = config.database;\n\n  var cellData = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&chanId=\" + data.chanIds[ 0 ], { method: 'GET' } ).then( ( response ) => response.json() ).then( ( el ) => { return el[ data.groupName ].channels[ data.chanIds[ 0 ] ] } );\n  var cellStatuses = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getStatus?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\n  var photodiodeRefs = await fetch( \"http://\" + data.trackerHost + \":\" + data.trackerPort + \"/getPDOptions?instrumentId=\" + data.instrumentId + \"&groupName=\" + data.groupName, { method: 'GET' } ).then( ( response ) => response.json() );\n\n  return openForm( null, \"cellformall\", { \n\n    cellData: cellData, \n    allStatuses: cellStatuses[ data.groupName ].channels, \n    photodiodeRefs: photodiodeRefs,\n    channelIds: data.chanIds\n\n  }, { width: 600, height: 800 } ).then( ( results ) => {\n  \n    event.sender.send( \"channelsConfigured\", results );\n    return results;    \n    \n  } ).catch( () => {} );\n}\n\n\n\nlet windowForm;\n\nfunction openForm( windowName, pageName, formData, options = { width: 300, height: 420 }, onClose ) {\n\n  if( windowForm ) {\n    ( windowForm._rejecter && windowForm._rejecter() );\n    windowForm.close();\n  }\n  // Create the browser window.\n  windowForm = new BrowserWindow( options );\n\n  // and load the index.html of the app.\n  windowForm.loadURL( url.format({\n    pathname: path.join(__dirname, 'app/' + pageName + '.html'),\n    protocol: 'file:',\n    slashes: true\n  }) );\n\n  windows[ \"form\" ] = windowForm;\n\n  windowForm.once(\"closed\", () => {\n    windows[ \"form\" ] = null;\n    ( windowForm && windowForm._rejecter && windowForm._rejecter() );\n    windowForm = null;\n\n    if( typeof onClose == \"function\" ) {\n      onClose();\n    }\n\n  })\n  return new Promise( ( resolver, rejecter ) => {\n    \n    ipcMain.once(\"validateForm\", ( event, data ) => {\n\n      resolver( data );\n    });\n\n    ipcMain.once(\"closeForm\", ( event, data ) => {\n\n      if( windowForm ) {\n        windowForm.close();\n        windowForm = null;\n      }\n    });\n\n    windowForm.webContents.once(\"dom-ready\", () => {\n      windowForm.webContents.send(\"loadForm\", formData );\n    });\n     \n\n    windowForm._rejecter = rejecter;\n  });\n}\n"]}